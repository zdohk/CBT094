//ZT15DAF JOB (SZTECH),'DAF',                                           JOB01448
//             CLASS=U,MSGCLASS=X,NOTIFY=ZT15
//JESDS OUTPUT PAGEDEF=LDUP,FORMDEF=LDUP,JESDS=ALL,FORMS=3H25
//*            DSN's of SYS1.xxxxxxxx map into SMPE DDDEFs of xxxxxxxx
//ASM     EXEC PGM=ASMA90,PARM='NODECK,OBJ,RENT'
//STEPLIB   DD DISP=SHR,DSN=SYS1.SASMMOD1,                <=== HLASM
//  VOL=SER=SR1001,UNIT=SYSDA
//SYSLIB    DD DISP=SHR,DSN=SYS1.MACLIB,                   <=== z/OS
//  VOL=SER=SR1001,UNIT=SYSDA
//          DD DISP=SHR,DSN=SYS1.MODGEN,                   <=== z/OS
//  VOL=SER=SR1001,UNIT=SYSDA
//          DD DISP=SHR,DSN=SYS1.SBDTMAC,                   <=== BDT
//  VOL=SER=SR1001,UNIT=SYSDA
//          DD DISP=SHR,DSN=SYS1.NFSMAC,                    <=== NFS
//  VOL=SER=SR1001,UNIT=SYSDA
//          DD DISP=SHR,DSN=SYS1.SEZACMAC,                <=== TCPIP
//  VOL=SER=SR1001,UNIT=SYSDA
//          DD DISP=SHR,DSN=SYS1.SICEUSER,               <=== DFSORT
//  VOL=SER=SR1001,UNIT=SYSDA
//*         DD DISP=SHR,DSN=SYS1.SASFPMAC,           <=== SMARTBATCH
//* VOL=SER=SR1001,UNIT=SYSDA
//          DD DISP=SHR,DSN=ZTGP01.MJCUTIL.MACLIB       <=== $COMMON
//SYSUT1    DD UNIT=SYSDA,SPACE=(CYL,(9,9)),
//             DCB=BUFNO=25
//SYSPRINT  DD SYSOUT=*,OUTPUT=*.JESDS
//SYSLIN    DD DISP=(NEW,PASS),DSN=&&OBJECT,
//             UNIT=SYSDA,SPACE=(CYL,(9,9)),
//             DCB=(BLKSIZE=4080,LRECL=80,RECFM=FB,BUFNO=25)
//SYSIN     DD *
         TITLE 'Dataset Audit Facility (DAF)'
DAF      START 0
**********************************************************************
*                                                                    *
* Name:            Dataset Audit Facility (DAF)                      *
*                                                                    *
* Description:     SMF post processor for dataset activity           *
*                                                                    *
* Function:        Reads standard IBM SMF records, and based upon    *
*                  user supplied selection criteria, generates       *
*                  detailed dataset audit trail reports              *
*                                                                    *
* Contact:         Michael J. Cleary                                 *
*                  Technical Services                                *
*                  AmerisourceBergen                                 *
*                  4000 Metropolitan Drive                           *
*                  Orange, California 92868                          *
*                  United States of America                          *
*                  714.385.4052 (voice)                              *
*                  714.385.8888 (fax)                                *
*                  mailto:michaeljosephcleary@yahoo.com              *
*                  http://www.geocities.com/michaeljosephcleary/     *
*                                                                    *
* Installation:                                                      *
* 1) DAF PDS contains the following.                                 *
*                                                                    *
*    Member    Type      Contents                                    *
*    ======    ====      ========                                    *
*    $COMMON   ASM/MACRO Common Macros                               *
*    DAF       ASM/JCL   DAF                                         *
*                                                                    *
* 2) The following IBM APARs should be applied to ensure full        *
* functionality of DAF.                                              *
*                                                                    *
*    OW47627 Assembly error in CSFSMF82                              *
*            ASMA043E Previously defined symbol - SMF82RKL           *
*    OW53524 Assembly error in IGWSMF                                *
*            &SMF42_0K and &SMF42_0L not defined                     *
*    OW51179 not generating SMF Record Type 42                       *
*            SMF42 subtypes 15 through 19 not generated              *
*    OA02569 Invalid SMF Record Type 60                              *
*            DEFINE USERCATALG request, SMF60ENM contains garbage    *
*    OA02792 Assembly error in CSFSMF82                              *
*            ASMA043E Previously defined symbol - SMF82CPH           *
*            ASMA043E Previously defined symbol - SMF82CPV           *
*    OA05526 Invalid SMF Record Type 66                              *
*            SMF66 SMF66ENM contains hexadecimal zeroes              *
*    OA06712 Assembly error in ERBSMF78                              *
*            ASMA044E Undefined symbol - VSDGAT                      *
*            ASMA080E Statement is unresolvable                      *
*    OA08693 Invalid SMF Record Type 42                              *
*            SMF42 subtype 21 fields are incorrect                   *
*                                                                    *
*    Current open PMR with IBM on macro GFSAUSMF                     *
*                                                                    *
*    Until final resolution, you have two options                    *
*    when assemblying DAF:                                           *
*                                                                    *
*    A) Do not process SMF Record 42 Subtype 7                       *
*                                                                    *
*       ST_DFSMS07' NE 'NO'                                          *
*                                                                    *
*    B) Process SMF Record 42 Subtype 7                              *
*                                                                    *
*       Comment out the SYS1.NFSMAC reference in the assembly JCL    *
*                                                                    *
*       Create a copy of SYS1.NFSMAC(GFSAUSMF) in                    *
*       ZTGP01.MJCUTIL.MACLIB and delete lines                       *
*                                                                    *
*       SMF42    DSECT                                               *
*                                                                    *
*       through                                                      *
*                                                                    *
*       SMF42PLN EQU   *-SMF42PRD                                    *
*                                                                    *
* 3) Set the RT_ and ST_ variables to the                            *
* correct SMF record type or 000 to indicate not                     *
* available.  DAF ships trying to report on all                      *
* supported SMF records that have preset SMF                         *
* record types by IBM.  The following products                       *
* need to be customized to set their SMF record                      *
* types.                                                             *
*                                                                    *
* HSM - Add the following to SYS1.PARMLIB(ARCCMDxx)                  *
*       Add SETSYS SMF(xxx)                                          *
*       Then set RT_HSMFSR to xxx+1                                  *
*                                                                    *
* RMM - Add the following to SYS1.PARMLIB(EDGRMMxx)                  *
*       OPTION SMFAUD(yyy) and SMFSEC(zzz)                           *
*       Then set RT_RMMAUD to yyy                                    *
*       Then set RT_RMMSEC to zzz                                    *
*                                                                    *
* 4) Assemble and link-edit DAF.                                     *
* The assembly and linkedit/bind must both get a                     *
* return code of zero.  Incorrect settings of                        *
* the &RT_ variables can cause the assembly to                       *
* fail because it is trying to use SMF record                        *
* mapping macros that do not exist on your                           *
* system.  Ensure that all of the &RT_ variables                     *
* are set to correctly match your installed                          *
* products.  If you are using SmartBatch, uncomment                  *
* the SYS1.SASFPMAC in the JCL.                                      *
*                                                                    *
* If you get UNDEFINED KEYWORD PARAMETER on IGWSMF                   *
* then set the &ST_DFSMSxx to NO to not generate                     *
* the mapping and the code to process these                          *
* subtypes that are not available on your system.                    *
*                                                                    *
* 5) To activate certain record types:                               *
* DFSORT - Add SMF=FULL to ICEAM1/2/3/4                              *
* RMF - Add CHAN to RMF parms                                        *
* RMF - Add DEVICE(DASD) to RMF parms                                *
* RMF - Add ENQ(DETAIL) to RMF parms                                 *
* RMF - Add PAGESP to RMF parms                                      *
* RMF - Add RECORD to RMF parms                                      *
* SMF - Add ACTIVE to SMF parms                                      *
* SMF - Add REC(PERM) to SMF parms                                   *
* SMF - Record all record types supported by DAF                     *
* TCPIP - Add SMF STD to the FTPD parms                              *
* TCPIP - Add the following to TCPIP parms                           *
*         SMFCONFIG FTPCLIENT TYPE119 FTPCLIENT                      *
*                                                                    *
* Notes:           QSAM read/write access to a member will have      *
*                  DSN and member name in the SMF record 14/15.      *
*                                                                    *
*                  BPAM read/write access to a member only has       *
*                  the DSN in the SMF record 14/15.                  *
*                                                                    *
*                  BPAM member deletes have the DSN and member       *
*                  names in the SMF record 42.                       *
*                                                                    *
*                  DAFOUT is perfect to point to the held output.    *
*                  In SDSF, do an SE on the DD and exclude, find     *
*                  and delete to your hearts content.  If this does  *
*                  not sound beneficial, merely DD DUMMY DAFOUT.     *
*                                                                    *
* Abend codes:     U0800 - Control Statement Problem                 *
*                  U0801 - System Macro Problem                      *
*                                                                    *
* Addressing mode: 31                                                *
*                                                                    *
* ASC mode:        Primary                                           *
*                                                                    *
* To Do:                                                             *
*            - Enhance SMF Record Type 42 subtype 6                  *
*            - Enhance SMF Record Type 42 subtype 7                  *
*            - Enhance SMF Record Type 42 subtype 21                 *
*            - Enhance SMF Record Type 14/15                         *
*            - Enhance SMF Record Type 88                            *
*            - Enhance SMF Record HSMFSR                             *
*            - Enhance SMF Record RMMAUD                             *
*            - Enhance SMF Record RMMSEC                             *
*            - Enhance SMF Record TCPIPX                             *
*            - Expand DWA to two base registers                      *
*                                                                    *
* Change Log:                                                        *
* 2005-02-21 - Correct RMMAUD changed volume blank dsn logic         *
* 2005-02-21 - Correct HSMFSR full volume dump hex zeroes dsn logic  *
* 2005-02-19 - Version 1 Release 4 Modification 3                    *
* 2005-02-19 - Add SMF Record Type 2 & 3 support for DAFLOG/DAFSTAT  *
* 2005-02-18 - Add LOGSTREAM and RECFM keywords                      *
* 2005-02-15 - Add SMF Record Type 88 support                        *
* 2005-02-11 - Enhance SMF Record SNAP processing                    *
* 2005-02-06 - Add SMF Record Type 79 support                        *
* 2005-02-06 - Add DATACLASS, MGMTCLAS & STORCLASS keywords          *
* 2005-02-05 - Add SMF Record Type 42 subtype 7 support              *
* 2005-02-05 - Add DSORG keyword                                     *
* 2005-01-20 - Add SMF Record Type 42 subtype 16 support             *
* 2005-01-20 - Correct DAF090 defined attribute references           *
* 2005-01-20 - Correct DAF042 Subtype 3 SMF42EAC compare logic       *
* 2004-09-03 - Version 1 Release 4 Modification 2                    *
* 2004-08-14 - Add DAFOUT - No headers, one dataset per record       *
* 2004-08-14 - Convert source/object dates to ISO 8601 (yyyy-mm-dd)  *
* 2004-08-14 - Add SMF Record Type 91 Subtype 21 support             *
* 2004-06-01 - Version 1 Release 4 Modification 1                    *
* 2004-06-01 - Add SMF Record Type 92 Subtype 7 support              *
* 2004-06-01 - Add SMF Record Type 78 support                        *
* 2004-06-01 - Add SMF Record Type 119 support                       *
* 2004-05-26 - Version 1 Release 4 Modification 0                    *
* 2004-05-26 - Correct DAF059 processing                             *
* 2003-11-14 - Version 1 Release 3 Modification 1                    *
* 2003-11-05 - Correct DAFPV to only process unique volume serials   *
* 2003-11-01 - Add SMF Record Type 118 rename support                *
* 2003-10-02 - Add SMF Record Type 59 support                        *
* 2003-10-01 - Invoke IGWSMF differently depending on &ST_DFSMSxx    *
* 2003-09-25 - Correct DAFTERM only CLOSE DAFTRACE if OPEN           *
* 2003-09-24 - Correct DAFPP format header record                    *
* 2003-09-24 - BUFNO=10, except DAFRPT,SORTIN,SORTOUT=25, DAFSMF=50  *
* 2003-09-10 - Correct DAF always call DAFSS and DAFGR               *
* 2003-09-09 - Enhance DAFLOG                                        *
* 2003-09-02 - BUFNO=10, except DAFRPT,DAFSMF,SORTIN,SORTOUT are 50  *
* 2003-03-31 - IBM APAR OA02569 for Invalid SMF Record Type 66       *
* 2003-03-31 - IBM APAR OW53524 for assembly error in IGWSMF         *
* 2003-03-31 - IBM APAR OA02792 for assembly error in CSFSMF82       *
* 2003-03-31 - Correct DAF064 extent processing                      *
* 2003-03-31 - Changed DAFSMF to BUFNO=255                           *
* 2003-03-31 - Add SMF Record Type 42 subtypes 10, 20 & 21 support   *
* 2003-03-31 - Abend S0Cx when volumes greater than 10               *
* 2003-03-31 - Abend S0Cx when processing DAFSMF as VSAM             *
* 2002-12-31 - Removed CA-Sort, File-Aid, SRS, STOPX37, SyncSort     *
* 2002-02-21 - Removed hardcoded SMF record mapping for FILEAID      *
* 2002-02-21 - Removed hardcoded SMF record mapping for CASORT       *
* 2001-02-01 - IBM APAR OW47627 for assembly error in CSFSMF82       *
* 2000-12-29 - Add customization for SMF Record Type 82              *
* 2000-12-29 - Abend S0C4 when SMF Record Type 14/15 JFCBNVOL > 5    *
* 2000-12-27 - Restructure Return Codes - No DAFSMF Records Provided *
* 2000-12-22 - Abend S0C4 when DAFSMF is VSAM                        *
* 2000-12-21 - Version 2 Release 9 Modification 0                    *
* 2000-12-21 - BUFNO=10, except DAFRPT,DAFSMF,SORTIN,SORTOUT are 50  *
* 2000-12-21 - Add customization for SMF Record Type 42              *
* 2000-08-10 - Bypass validity check for Defrag Special DSN (DAFCC)  *
* 2000-08-10 - Add H entry for HFS to TFTPDT table                   *
* 2000-08-10 - Add lowercase and / to TBLDSN table                   *
* 1999-09-24 - Add SMF Record Type 42 subtypes 6 & 9 support         *
* 1999-05-12 - Only resolve mask on character keywords (DAFCC)       *
* 1999-05-06 - Special DEFRAG DSN (DAF017)                           *
* 1999-04-30 - Update the Major Enqueue Table ($COMMON)              *
* 1999-04-29 - Update the Major Enqueue Table ($COMMON)              *
* 1999-04-29 - Move Major Enqueue Tabble to $COMMON                  *
* 1999-04-23 - Only SNAP first 5 invalids of each type (DAFCC)       *
* 1999-04-20 - Version 2 Release 6 Modification 0                    *
*                                                                    *
* Copyright:       Michael J. Cleary                                 *
*                                                                    *
* Control blocks:  Numerous                                          *
*                                                                    *
* CSECTs:          Numerous                                          *
*                                                                    *
* Dependencies:    None                                              *
*                                                                    *
* Disclaimer:      AmerisourceBergen neither expresses nor implies   *
*                  any warranty as to the fitness of these           *
*                  computer programs for any function.  The use      *
*                  of these programs or the results therefrom is     *
*                  entirely at the risk of the user.                 *
*                  Consequently, the user may modify these           *
*                  programs in any way they thinks fit.  These       *
*                  programs are Freeware and may be freely           *
*                  copied.  They may be freely distributed to any    *
*                  other party on condition that no inducement       *
*                  beyond reasonable handling costs is offered or    *
*                  accepted by either side for such distribution.    *
*                                                                    *
* DSECTs:          Numerous                                          *
*                                                                    *
* Entry points:    DAF                                               *
*                                                                    *
* Environment:     Any level of MVS, OS/390, z/OS.e or z/OS          *
*                                                                    *
* Execution JCL:                                                     *
*                                                                    *
* //ZT15$DAF JOB (DAF),'DAF',CLASS=U,                                *
* // MSGCLASS=X,MSGLEVEL=(1,1),NOTIFY=ZT15                           *
* //JESDS OUTPUT PAGEDEF=LDUP,FORMDEF=LDUP,JESDS=ALL,FORMS=3H25      *
* //DAF    EXEC PGM=DAF                                              *
* //STEPLIB  DD DISP=SHR,DSN=ZTGP01.MJCUTIL.LINKLIB                  *
* //CAOESTOP DD DUMMY                               Turn off Symdump *
* //ABNLIGNR DD DUMMY                              Turn off AbendAid *
* //DAFSMF   DD DISP=SHR,DSN=ZTGP01.DAF.IVP                          *
* //DAFLOG   DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //DAFOUT   DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //DAFRPT   DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //DAFSNAP  DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //DAFSTAT  DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //DAFTRACE DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //SYSPRINT DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //SYSUDUMP DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //SYSOUT   DD SYSOUT=*,OUTPUT=*.JESDS                              *
* //SORTIN   DD UNIT=SYSDA,SPACE=(CYL,(555,55))                      *
* //SORTOUT  DD UNIT=SYSDA,SPACE=(CYL,(555,55))                      *
* //DAFCS    DD *                                                    *
*   (control statements go here)                                     *
* keyword operator value                                             *
*                                                                    *
* Keyword   ML  Description                Alias1            Alias2  *
* =======   ==  ===========                ======            ======  *
* CATALOG   44  Catalog name               CAT                       *
* DATACLAS  08  Data class name            DATACLASS                 *
* DATE      07  Date - yyyyddd                                       *
* DDNAME    08  Data definition name       DDN               DD      *
* DSNAME    44  Dataset name               DATASET           DSN     *
* DSORG     03  Dataset organization                                 *
* DUP       16  Number of updates                                    *
* EXCP      16  Execute Channel Program                              *
* GROUP     08  Group identification                                 *
* JOBNAME   08  Job name                   JOB                       *
* LOGSTREAM 26  Logstream name                                       *
* LRECL     05  Logical record length                                *
* MAJOR     08  Major enqueue name                                   *
* MGMTCLAS  08  Management class name      MANAGEMENTCLASS           *
* MEMBER    08  Member name                MEM                       *
* MINOR     44  Minor enqueue name                                   *
* NUP       16  Number of updates                                    *
* RECFM     05  Record format                                        *
* RECORD    03  SMF Record type            REC                       *
* SUBTYPE   03  SMF Record subtype         STY                       *
* STORCLAS  08  Storage class name         STORAGECLASS              *
* SYSTEM    04  System identification      SYSID                     *
* TIME      11  Time - hh.mm.ss.hh                                   *
* USERID    08  User identification        USER                      *
* VOLUME    06  Volume serial              VOL               VOLSER  *
* VVDS      44  VSAM volume dataset name                             *
* WTX       04  Wait Time Max                                        *
*                                                                    *
* Operator      Description                                          *
* ========      ===========                                          *
* EQ            Equal to                                             *
* GE            Greater than or equal to                             *
* GT            Greater than                                         *
* LE            Less than or equal to                                *
* LT            Less than                                            *
* NE            Not equal to                                         *
*                                                                    *
* Examples:                                                          *
*                                                                    *
* To find all dataset accesses by all D72 prefixed jobs              *
* DSN EQ SYS1                                                        *
* JOB EQ D72                                                         *
*                                                                    *
* Input:           Control statements on DD "DAFCS"                  *
*                  SMF records on DD "DAFSMF" (QSAM or VSAM)         *
*                                                                    *
* Key:             8                                                 *
*                                                                    *
* Language:        MVS 370 assembler                                 *
*                                                                    *
* Linkage:         Standard linkage for entry/exit                   *
*                                                                    *
* Location:        Private Area                                      *
*                                                                    *
* Macros:          Numerous                                          *
*                                                                    *
* Messages:        DAF5xxt - Informational                           *
*                  DAF6xxt - Trace                                   *
*                  DAF7xxt - Return Code                             *
*                  DAF8xxt - Errors (User Abend)                     *
*                  DAF9xxt - System Error                            *
*                                                                    *
*                  Where t is: I - Informational                     *
*                              W - Warning                           *
*                              E - Error                             *
*                              S - Sevre                             *
*                              T - Terminal                          *
*                                                                    *
* Mode:            Task                                              *
*                                                                    *
* Module type:     Procedure                                         *
*                                                                    *
* Output:          Log on DD "DAFLOG"                                *
*                  Output on DD "DAFOUT"                             *
*                  Report on DD "DAFRPT"                             *
*                  Invalid SMF records on DD "DAFSNAP"               *
*                  Statistics on DD "DAFSTAT"                        *
*                  Trace on DD "DAFTRACE"                            *
*                                                                    *
* Parameter list:  Pointed to by R1                                  *
*                  . 00(R1) - Parameter Length                       *
*                  . 02(R1) - Parameter                              *
*                                                                    *
* Patch label:     None                                              *
*                                                                    *
* Reason codes:    None                                              *
*                                                                    *
* Recovery:        None                                              *
*                                                                    *
* Reentrancy:      Reentrant                                         *
*                                                                    *
* Registers:       Saved:         0-12,14-15 via SAVE(14,12)         *
*                  Restored:      0-12,14 via RETURN(14,12),RC=(15)  *
*                  Base:          11/12                              *
*                  Dynamic work:  10                                 *
*                  Static work:   9                                  *
*                                                                    *
*  Multiple Report Records:                                          *
*  16 - Input DSN / SORTOUT DSN / OUTFIL DSN                         *
*  18 - DSN Before Rename / DSN After Rename                         *
*  36 - Catalog DSN / Portable DSN                                   *
*  42 - ACDS DSN / SCDS DSN                                          *
*  59 - Origin DSN / Destination DSN                                 *
*  66 - DSN Before Rename / DSN After Rename                         *
*  68 - DSN Before Rename / DSN After Rename                         *
*  81 - UADS DSN / Active_RACF DSN / Backup_RACF DSN                 *
*  82 - DSN Before Refresh / DSN After Refresh                       *
*  90 - SMF DSN Before Switch / SMF DSN After Switch                 *
* 118 - TCPIP Statistics - FTP DSN Before Rename / DSN After Rename  *
* 119 - TCPIP Statistics - FTP DSN Before Rename / DSN After Rename  *
*                                                                    *
* Return codes:    00 - Normal                                       *
*                  04 - No DAFSMF Records Selected                   *
*                  08 - No DAFSMF Records Provided                   *
*                  12 - Control Statement Problem                    *
*                                                                    *
* Residence mode:  24                                                *
*                                                                    *
* Savearea:        Dynamically obtained storage                      *
*                                                                    *
* Serialization:   None                                              *
*                                                                    *
* Size:            Approximately 120KB                               *
*                                                                    *
* Supported SMF Records:                                             *
*                                                                    *
*   002 - Dump Header                                                *
*   003 - Dump Trailer                                               *
*   007 - Data Lost                                                  *
*   014 - INPUT or RDBACK Data Set Activity                          *
*   015 - OUTPUT UPDAT INOUT or OUTIN Data Set Activity              *
*   016 - DFSORT Statistics                                          *
*   017 - Scratch Data Set Status                                    *
*   018 - Rename Non-VSAM Data Set Status                            *
*   022 - Configuration                                              *
*   024 - JES2 Spool Offload                                         *
*   036 - Integrated Catalog Facility Catalog                        *
*   042 - DFSMS Statistics and Configuration                         *
*   059 - MVS/BDT File-to-File Transmission                          *
*   060 - VSAM Volume Data Set Updated                               *
*   061 - Integrated Catalog Facility Define Activity                *
*   062 - VSAM Component or Cluster Opened                           *
*   063 - VSAM Catalog Entry Defined                                 *
*   064 - VSAM Component or Cluster Status                           *
*   065 - Integrated Catalog Facility Delete Activity                *
*   066 - Integrated Catalog Facility Alter Activity                 *
*   067 - VSAM Catalog Entry Deleted                                 *
*   068 - VSAM Catalog Entry Renamed                                 *
*   069 - VSAM Data Space Defined, Extended or Deleted               *
*   073 - RMF Channel Path Activity                                  *
*   074 - RMF Activity of Several Resources                          *
*   075 - RMF Page Data Set Activity                                 *
*   077 - RMF Enqueue Activity                                       *
*   078 - RMF Virtual Storage and I/O Queuing Activity               *
*   079 - RMF Monitor II Activity                                    *
*   080 - Security Product Processing                                *
*   081 - RACF Initialization                                        *
*   082 - ICSF Record                                                *
*   083 - RACF Audit Record for Data Sets                            *
*   088 - System Logger Data                                         *
*   090 - System Status                                              *
*   091 - BatchPipes/MVS Statistics                                  *
*   092 - OpenMVS File System Activity                               *
*   118 - TCP/IP Statistics                                          *
*   119 - TCP/IP Statistics                                          *
*   xxx - DFSMSrmm SMF Audit Record                                  *
*   yyy - DFSMSrmm SMF Security Record                               *
*   zzz - DFSMShsm SMF FSR Record                                    *
*                                                                    *
* State:           Problem                                           *
*                                                                    *
* Status:          Version 1 Release 4 Modification 3                *
*                                                                    *
* Tables:          Numerous                                          *
*                                                                    *
* User Exits:      None                                              *
*                                                                    *
* Virtual Storage: Minimal                                           *
*                                                                    *
* Wait states:     None                                              *
*                                                                    *
* X-memory mode:   HASID=PASID=SASID                                 *
*                                                                    *
**********************************************************************
         TITLE 'Declare Globals'
*
**       Declare Globals
*
         GBLA  &GCOMPCTR           Compare Counter
         GBLA  &GMODCTR            Module count
         GBLA  &GMODULE            Module
         GBLA  &GOPCTR             Operator counter
         GBLC  &GCOMPTXT(250)      Compare Text
         GBLC  &GCOMPVAL(250)      Compare Value
         GBLC  &GMODNAM(99)        Module Name
         GBLC  &GTRACE             Trace (YES/NO)
         GBLC  &GTRACEDD           Trace DDNAME (DDNAME)
         GBLC  &RT_BDT             BDT Record Type (nnn/000)
         GBLC  &RT_DFSMS           DFSMS Record Type (nnn/000)
         GBLC  &RT_DFSORT          DFSORT Record Type (nnn/000)
         GBLC  &RT_HSMFSR          HSM FSR Record Type (nnn/000)
         GBLC  &RT_ICSF            ICSF Record Type (nnn/000)
         GBLC  &RT_RACFAUDIT       RACF Audit Record Type (nnn/000)
         GBLC  &RT_RACFINIT        RACF Init Record Type (nnn/000)
         GBLC  &RT_RACFPROC        RACF Process Record Type (nnn/000)
         GBLC  &RT_RMF             RMF Record Type (nnn/000)
         GBLC  &RT_RMMAUD          RMM Audit Record Type (nnn/000)
         GBLC  &RT_RMMSEC          RMM Security Record Type (nnn/000)
         GBLC  &RT_SMARTBATCH      SmartBatch Record Type (nnn/000)
         GBLC  &RT_TCPIP           TCPIP Record Type (nnn/000)
         GBLC  &RT_TCPIPX          TCPIP Record Type (nnn/000)
         GBLC  &RT_USS             USS Record Type (nnn/000)
         GBLC  &ST_DFSMS03         DFSMS Sub Type 03 (YES/NO)
         GBLC  &ST_DFSMS06         DFSMS Sub Type 06 (YES/NO)
         GBLC  &ST_DFSMS07         DFSMS Sub Type 07 (YES/NO)
         GBLC  &ST_DFSMS09         DFSMS Sub Type 09 (YES/NO)
         GBLC  &ST_DFSMS10         DFSMS Sub Type 10 (YES/NO)
         GBLC  &ST_DFSMS16         DFSMS Sub Type 16 (YES/NO)
         GBLC  &ST_DFSMS20         DFSMS Sub Type 20 (YES/NO)
         GBLC  &ST_DFSMS21         DFSMS Sub Type 21 (YES/NO)
         GBLC  &ST_FTP             FTP Sub Type (nnn/000)
         TITLE 'Installation Customization'
*
**       Installation Customization
*
&GTRACE        SETC 'NO ' Trace (YES/NO)
&GTRACEDD      SETC 'DAFTRACE' Trace DDNAME (DDNAME)
&RT_BDT        SETC '059' BDT Record Type (nnn/000)
&RT_DFSMS      SETC '042' DFSMS Record Type (nnn/000)
&RT_DFSORT     SETC '016' DFSORT Record Type (nnn/000)
&RT_HSMFSR     SETC '241' HSM FSR Record Type (nnn/000)
&RT_ICSF       SETC '082' ICSF Record Type (nnn/000)
&RT_RACFAUDIT  SETC '083' RACF Audit Record Type (nnn/000)
&RT_RACFINIT   SETC '081' RACF Init Record Type (nnn/000)
&RT_RACFPROC   SETC '080' RACF Process Record Type (nnn/000)
&RT_RMF        SETC '073' RMF Record Type (nnn/000)
&RT_RMMAUD     SETC '242' RMM Audit Record Type (nnn/000)
&RT_RMMSEC     SETC '243' RMM Security Record Type (nnn/000)
&RT_SMARTBATCH SETC '091' SmartBatch Record Type (nnn/000)
&RT_TCPIP      SETC '118' TCPIP Record Type (nnn/000)
&RT_TCPIPX     SETC '119' TCPIP Record Type (nnn/000)
&RT_USS        SETC '092' USS Record Type (nnn/000)
&ST_DFSMS03    SETC 'YES' DFSMS Sub Type 03 (YES/NO) new in ESA 5.1
&ST_DFSMS06    SETC 'YES' DFSMS Sub Type 06 (YES/NO) new in ESA 5.1
&ST_DFSMS07    SETC 'YES' DFSMS Sub Type 07 (YES/NO) new in DFSMS 1.2
&ST_DFSMS09    SETC 'YES' DFSMS Sub Type 09 (YES/NO) new in OS/390 2.4
&ST_DFSMS10    SETC 'YES' DFSMS Sub Type 10 (YES/NO) new in z/OS 1.3
&ST_DFSMS16    SETC 'YES' DFSMS Sub Type 16 (YES/NO) new in ESA 5.2.2
&ST_DFSMS20    SETC 'YES' DFSMS Sub Type 20 (YES/NO) new in z/OS 1.3
&ST_DFSMS21    SETC 'YES' DFSMS Sub Type 21 (YES/NO) new in z/OS 1.3
&ST_FTP        SETC '076' FTP Sub Type (nnn/000)
         TITLE '$COMMON - Common Macros'
         PRINT OFF                 Stop source and object printing
         COPY  $COMMON             Common Macros
         PRINT ON                  Resume source and object printing
         MACRO
*
**       $COMP - Compare Table Definition
*
         $COMP &V,                 Compare Value                       X
               &T,                 Compare Text                        X
               &LABEL=,            Compare Label                       X
               &LENGTH=,           Compare Length                      X
               &TYPE=ADD           INIT/ADD/BUILD
         GBLA  &GCOMPCTR           Compare Counter
         GBLC  &GCOMPTXT(250)      Compare Text
         GBLC  &GCOMPVAL(250)      Compare Value
         LCLA  &TMPCTR             Local variable - Temporary Counter
         LCLA  &TMPLEN             Local variable - Temporary Length
         LCLC  &TMPVAL             Local variable - Temporary Value
         LCLC  &TMPTXT             Local variable - Temporary Text
         AIF   ('&TYPE' EQ 'INIT').INIT,                               X
               ('&TYPE' EQ 'ADD').ADD,                                 X
               ('&TYPE' EQ 'BUILD').BUILD
         MNOTE 8,'Invalid TYPE=&TYPE - Use INIT, ADD or BUILD'
         MEXIT
.INIT          ANOP
&GCOMPCTR SETA 0
         MEXIT
.ADD           ANOP
&GCOMPCTR SETA &GCOMPCTR+1
&GCOMPVAL(&GCOMPCTR) SETC '&V'
&GCOMPTXT(&GCOMPCTR) SETC '&T'
         MEXIT
.BUILD         ANOP
&TMPLEN  SETA  46-&LENGTH
         DC    F'&LENGTH'          Compare Length
         DC    F'&GCOMPCTR'        Compare Count
         DC    C'&LABEL='          Compare Label
&TMPCTR  SETA  1
.NEXTCOMP      ANOP
         AIF   (&TMPCTR GT &GCOMPCTR).ENDCOMP
&TMPVAL  SETC  '&GCOMPVAL(&TMPCTR)'
&TMPTXT  SETC  '&GCOMPTXT(&TMPCTR)'
         DC    &TMPVAL             Compare Value
         DC    CL&TMPLEN&TMPTXT    Compare Text
&TMPCTR  SETA  &TMPCTR+1
         AGO   .NEXTCOMP
.ENDCOMP       ANOP
         MEND
         MACRO
*
**       $KWD - Keyword Table Definition
*
&LABEL   $KWD &V,&T=,&LENGTH=,                                         X
               &O1=,&O2=0,&O3=0,&O4=0,&O5=0,&O6=0,&O7=0,               X
               &O8=0,&O9=0,&OA=0,&OB=0,&OC=0,&OD=0,&OE=0,&OF=0,&D=0,   X
               &C=100,                                                 X
               &FORMAT=,                                               X
               &ALIAS1=,&ALIAS2=,&ALIAS3=,&ALIAS4=,&ALIAS5=,           X
               &DSECT=NO           DSECT
         LCLA  &OMC,&VGL
         AIF   ('&DSECT' EQ 'YES').DSECT
         AIF   ('&FORMAT' EQ 'C').FORMATOK,                            X
               ('&FORMAT' EQ 'F').FORMATOK
         MNOTE 8,'Invalid FORMAT=&FORMAT ... Must be C,F'
         MEXIT
.FORMATOK      ANOP
&OMC     SETA  &C+1
&VGL     SETA  (&LENGTH+5)*&C
         DC    6F'0'               Value getmain address
         DC    6F'0'               Operator value count
         DC    AL4(&O1)            Operand check offset 1
         DC    AL4(&O2)            Operand check offset 2
         DC    AL4(&O3)            Operand check offset 3
         DC    AL4(&O4)            Operand check offset 4
         DC    AL4(&O5)            Operand check offset 5
         DC    AL4(&O6)            Operand check offset 6
         DC    AL4(&O7)            Operand check offset 7
         DC    AL4(&O8)            Operand check offset 8
         DC    AL4(&O9)            Operand check offset 9
         DC    AL4(&OA)            Operand check offset A
         DC    F'0'                Operand check offset end
         DC    H'0'                Operand count
         DC    H'&LENGTH'          Operand max length
         DC    H'&OMC'             Operand max count plus one
         DC    H'&VGL'             Value getmain length
         AIF   ('&T' EQ 'DATASET').TYPE,                               X
               ('&T' EQ 'ENQUEUE').TYPE,                               X
               ('&T' EQ 'GENERAL').TYPE
         MNOTE 8,'Invalid T=&T ... Must be DATASET,ENQUEUE or GENERAL'
         MEXIT
.TYPE          ANOP
         DC    CL007'&T'           Keyword type
         DC    CL010'&V'           Keyword text
         DC    CL025&D             Keyword description
         DC    CL016'&ALIAS1 '     Keyword alias 1
         DC    CL016'&ALIAS2 '     Keyword alias 2
         DC    CL016'&ALIAS3 '     Keyword alias 3
         DC    CL016'&ALIAS4 '     Keyword alias 4
         DC    CL016'&ALIAS5 '     Keyword alias 5
         DC    CL001'&FORMAT'      Keyword mode (C,F)
         CNOP  0,4                 Fullword alignment
         MEXIT
.DSECT         ANOP
*
**       Keyword Table
*
D_TBLKWD DSECT                     Keyword table entry
D_KWDVGA DS    6F                  Value getmain address
D_KWDOVC DS    6F                  Operator value count
D_KWDOF1 DS    AL4                 Operand offset 1
D_KWDOF2 DS    AL4                 Operand offset 2
D_KWDOF3 DS    AL4                 Operand offset 3
D_KWDOF4 DS    AL4                 Operand offset 4
D_KWDOF5 DS    AL4                 Operand offset 5
D_KWDOF6 DS    AL4                 Operand offset 6
D_KWDOF7 DS    AL4                 Operand offset 7
D_KWDOF8 DS    AL4                 Operand offset 8
D_KWDOF9 DS    AL4                 Operand offset 9
D_KWDOFA DS    AL4                 Operand offset A
D_KWDOFF DS    F                   Operand offset end
D_KWDKVC DS    H                   Keyword value count
D_KWDOML DS    H                   Operand maximum length
D_KWDOMC DS    H                   Operand maximum count
D_KWDVGL DS    H                   Value getmain length
D_KWDTYP DS    CL007               Keyword type
D_KWDTXT DS    CL010               Keyword text
D_KWDDES DS    CL025               Keyword description
D_KWDAL1 DS    CL016               Keyword alias 1
D_KWDAL2 DS    CL016               Keyword alias 2
D_KWDAL3 DS    CL016               Keyword alias 3
D_KWDAL4 DS    CL016               Keyword alias 4
D_KWDAL5 DS    CL016               Keyword alias 5
D_KWDFMT DS    CL001               Keyword mode (C,F)
         MEND
         MACRO
*
**       $MOD - Module Table Definition
*
&LABEL   $MOD
         GBLA  &GMODCTR            Module count
         GBLC  &GMODNAM(99)        Module Name
         LCLA  &TMPCTR             Temporary count
         LCLC  &TMPNAM             Temporary name
         DC    AL4(&GMODCTR)       Module count
&TMPCTR  SETA  1
.NEXTMOD       ANOP
         AIF   (&TMPCTR GT &GMODCTR).ENDMOD
&TMPNAM  SETC  '&GMODNAM(&TMPCTR)'
         DC    AL4(&TMPNAM)        Module address
         DC    CL008'&TMPNAM'      Module name
&TMPCTR  SETA  &TMPCTR+1
         AGO   .NEXTMOD
.ENDMOD        ANOP
         MEND
         MACRO
*
**       $MSG - Copy SYSOUT Message
*
&LABEL   $MSG  &TO,&MSGID          Copy SYSOUT Message
&LABEL   L     R14,=A(TBLMSG)      Message table address
         LA    R15,4095(,R14)      Second base register
         LA    R15,1(,R15)         Second base register
         USING TBLMSG,R14,R15      Message table reference
         MVC   &TO,&MSGID          Copy SYSOUT message
         DROP  R14,R15             Message table dereference
         MEND
         MACRO
*
**       $OP - Operator Table Definition
*
&LABEL   $OP   &O,&L=0,&E=0,&H=0,&DES=Unknown,                         X
               &DSECT=NO           DSECT
         AIF   ('&DSECT' EQ 'YES').DSECT
         GBLA  &GOPCTR             Operator counter
         LCLA  &OPOFF              Operator offset
&OPOFF   SETA  &GOPCTR*4           Determine operator offset
&LABEL   DC    F'&OPOFF'           Operator offset
         DC    X'0&L'              Low
         DC    X'0&E'              Equal
         DC    X'0&H'              High
         DC    CL005'&O'           Operator
         DC    CL032&DES           Operator description
         CNOP  0,4                 Fullword alignment
&GOPCTR  SETA  &GOPCTR+1           Increment operator counter
         MEXIT
.DSECT         ANOP
*
**       Operator Table
*
D_TBLOP  DSECT                     Operator table entry
D_OPOFF  DS    F                   Operator offset
D_OPLO   DS    X                   Low
D_OPEQ   DS    X                   Equal
D_OPHI   DS    X                   High
D_OPTXT  DS    CL005               Operator text
D_OPDES  DS    CL032               Operator description
         MEND
         MACRO
*
**       $PRINT - Print A Record
*
&LABEL   $PRINT &DCB,&RECORD       Print a Record
         LCLC  &ID
&ID      SETC  'W_&DCB'
&LABEL   CALL  DAFPP,              Print a Record                      X
               (&ID,&DCB,&RECORD),                                     X
               MF=(E,W_WRK)
         $FILL &RECORD,C' '        Blank record
         MEND
         MACRO
*
**       $SMF - SMF Table Definition
*
&LABEL   $SMF  &RECORDTYPE,        Record type                         X
               &EXTRACT,           Record extract                      X
               &DESCRIPTION,       Record description                  X
               &DSECT=NO           DSECT
         AIF   ('&DSECT' EQ 'YES').DSECT
         DC    F'0'                Record count (DAFSMF)
         DC    F'0'                Record count (DAFRPT)
         DC    F'0'                Record count - Invalid DSN
         DC    AL1(&RECORDTYPE)    SMF record type - hexadecimal
         DC    CL003'&RECORDTYPE'  SMF record type - decimal
         DC    CL003' - '          SMF record type - separator
         DC    CL058&DESCRIPTION   SMF record description
         DS    0F                  Fullword boundary
         DC    AL4(&EXTRACT)       SMF extract offset
         MEXIT
.DSECT         ANOP
*
**       SMF Table
*
D_TBLSMF DSECT                     SMF table entry
D_SMFSMF DS    F                   Record count (DAFSMF)
D_SMFRPT DS    F                   Record count (DAFRPT)
D_SMFINV DS    F                   Record count - Invalid DSN
D_SMFRTY DS    BL001               SMF Record type - hexadecimal
D_SMFRTD DS    CL003               SMF Record type - decimal
         DS    CL003               SMF record type - separator
         ORG   D_SMFRTD            SMF Record type - decimal
D_SMFRNM DS    CL064               SMF record name
D_SMFEXT DS    F                   SMF extract address
L_TBLSMF EQU   *-D_TBLSMF          SMF table entry length
         MEND
         MACRO
*
**       $TM - TM Table Definition
*
&LABEL   $TM   &T
&LABEL   DC    &T                  Text value
         MEND
         TITLE 'SMF Records'
*
**       SMF Records
*
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
SMFXXLEN DS    BL002               Record Length
SMFXXSEG DS    BL002               Segment Descriptor
SMFXXFLG DS    BL001               Header Flag
SMFXXRTY DS    BL001               Record Type
SMFXXTME DS    BL004               Record Time
SMFXXDTE DS    PL004               Record Date
SMFXXSID DS    CL004               Record System identification
SMFXXSSI DS    CL004               Record Subsystem identification
SMFXXSTY DS    BL002               Record Subtype
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR   2               SMF Record Type 2
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR   3               SMF Record Type 3
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR   7               SMF Record Type 7
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  14               SMF Record Type 14/15
         AIF   ('&RT_DFSORT' EQ '000').NODFSORT9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         ICESMF                    SMF Record Type 16
.NODFSORT9     ANOP
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  17               SMF Record Type 17
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  18               SMF Record Type 18
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  22               SMF Record Type 22
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  24               SMF Record Type 24
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFI6 36               SMF Record Type 36
         AIF   ('&RT_DFSMS' EQ '000').NODFSMS9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         AIF   ('&ST_DFSMS21' NE 'YES').NODFSMS21X   new in z/OS 1.3
         IGWSMF SMF42_03=&ST_DFSMS03, SMF Record Type 42               X
               SMF42_06=&ST_DFSMS06,                                   X
               SMF42_09=&ST_DFSMS09,                                   X
               SMF42_0A=&ST_DFSMS10,                                   X
               SMF42_0G=&ST_DFSMS16,                                   X
               SMF42_0K=&ST_DFSMS20,                                   X
               SMF42_0L=&ST_DFSMS21
         AGO   .NODFSMS9
.NODFSMS21X    ANOP
         AIF   ('&ST_DFSMS20' NE 'YES').NODFSMS20X   new in z/OS 1.3
         IGWSMF SMF42_03=&ST_DFSMS03, SMF Record Type 42               X
               SMF42_06=&ST_DFSMS06,                                   X
               SMF42_09=&ST_DFSMS09,                                   X
               SMF42_0A=&ST_DFSMS10,                                   X
               SMF42_0G=&ST_DFSMS16,                                   X
               SMF42_0K=&ST_DFSMS20
         AGO   .NODFSMS9
.NODFSMS20X    ANOP
         AIF   ('&ST_DFSMS10' NE 'YES').NODFSMS10X   new in z/OS 1.3
         IGWSMF SMF42_03=&ST_DFSMS03, SMF Record Type 42               X
               SMF42_06=&ST_DFSMS06,                                   X
               SMF42_09=&ST_DFSMS09,                                   X
               SMF42_0A=&ST_DFSMS10,                                   X
               SMF42_0G=&ST_DFSMS16
         AGO   .NODFSMS9
.NODFSMS10X    ANOP
         AIF   ('&ST_DFSMS09' NE 'YES').NODFSMS09X   new in OS/390 2.4
         IGWSMF SMF42_03=&ST_DFSMS03, SMF Record Type 42               X
               SMF42_06=&ST_DFSMS06,                                   X
               SMF42_09=&ST_DFSMS09,                                   X
               SMF42_0G=&ST_DFSMS16
         AGO   .NODFSMS9
.NODFSMS09X    ANOP
         AIF   ('&ST_DFSMS16' NE 'YES').NODFSMS16X   new in ESA 5.2.2
         IGWSMF SMF42_03=&ST_DFSMS03, SMF Record Type 42               X
               SMF42_06=&ST_DFSMS06,                                   X
               SMF42_0G=&ST_DFSMS16
         AGO   .NODFSMS9
.NODFSMS16X    ANOP
         AIF   ('&ST_DFSMS06' NE 'YES').NODFSMS06X   new in ESA 5.1
         IGWSMF SMF42_03=&ST_DFSMS03, SMF Record Type 42               X
               SMF42_06=&ST_DFSMS06
         AGO   .NODFSMS9
.NODFSMS06X    ANOP
         AIF   ('&ST_DFSMS03' NE 'YES').NODFSMS03X   new in ESA 5.1
         IGWSMF SMF42_03=&ST_DFSMS03  SMF Record Type 42
         AGO   .NODFSMS9
.NODFSMS03X    ANOP
.NODFSMS9      ANOP
         AIF   ('&ST_DFSMS07' NE 'YES').NODFSMS07X   new in DFSMS 1.2
         GFSAUSMF                  SMF Record Type 42 Subtype 7
.NODFSMS07X    ANOP
         AIF   ('&RT_BDT' EQ '000').NOBDT9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  59               SMF Record Type 59
.NOBDT9        ANOP
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFI6 60               SMF Record Type 60
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFI6 61               SMF Record Type 61
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  62               SMF Record Type 62
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  63               SMF Record Type 63
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  64               SMF Record Type 64
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFI6 65               SMF Record Type 65
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFI6 66               SMF Record Type 66
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  67               SMF Record Type 67
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  68               SMF Record Type 68
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  69               SMF Record Type 69
         AIF   ('&RT_RMF' EQ '000').NORMF9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         ERBSMFR  73               SMF Record Type 73
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         ERBSMFR  74               SMF Record Type 74
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         ERBSMFR  75               SMF Record Type 75
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         ERBSMFR  77               SMF Record Type 77
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         ERBSMFR  78               SMF Record Type 78
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         ERBSMFR  79               SMF Record Type 79
.NORMF9        ANOP
         AIF   ('&RT_RACFPROC' EQ '000').NORACFPROC9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  80               SMF Record Type 80
.NORACFPROC9   ANOP
         AIF   ('&RT_RACFINIT' EQ '000').NORACFINIT9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  81               SMF Record Type 81
.NORACFINIT9   ANOP
         AIF   ('&RT_ICSF' EQ '000').NOICSF9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         CSFSMF82                  SMF Record Type 82
.NOICSF9       ANOP
         AIF   ('&RT_RACFAUDIT' EQ '000').NORACFAUDIT9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  83               SMF Record Type 83
.NORACFAUDIT9  ANOP
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  88               SMF Record Type 88
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  90               SMF Record Type 90
         AIF   ('&RT_USS' EQ '000').NOUSS9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         IFASMFR  92               SMF Record Type 92
.NOUSS9        ANOP
         AIF   ('&RT_TCPIP' EQ '000').NOTCPIP9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         EZASMF76 API=NO,          SMF Record Type 118                 X
               FTP=YES,                                                X
               FTPC=YES,                                               X
               STAT=NO,                                                X
               TELNET=NO
.NOTCPIP9      ANOP
         AIF   ('&RT_TCPIPX' EQ '000').NOTCPIPX9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         EZASMF77 API=NO,          SMF Record Type 119                 X
               FTP=YES,                                                X
               HEADER=YES,                                             X
               STAT=NO,                                                X
               TELNET=NO
.NOTCPIPX9     ANOP
         AIF   ('&RT_HSMFSR' EQ '000').NOHSMFSR9
*
**       DFSMShsm SMF FSR Record
*
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
FSR      EQU   *                   Function statistics record (FSR)
FSRHDR   DS    CL018               Standard 18-byte SMF record header
         ORG   FSR
FSRLEN   DS    BL002               Record length
FSRSEG   DS    BL002               Segment descriptor
FSRFLG   DS    BL001               System indicator
FSRRTY   DS    BL001               Record type
FSRTME   DS    BL004               Record time
FSRDTE   DS    PL004               Record date
FSRSID   DS    CL004               System identification
FSRJBN   DS    CL008               Job name
FSRRST   DS    BL004               Reader start time
FSRRSD   DS    PL004               Reader start date
FSRUID   DS    CL008               User identification
FSRTYPE  DS    BL001               Function type
FSRFLAGS DS    BL001               Flags
FSRFFSTR EQU   X'80'               From a striped data set
FSRFTSTR EQU   X'40'               To a striped data set
FSRF32K  EQU   X'20'               Dataset is greater than 32K tracks
FSRFKB   EQU   X'10'               Dataset is greater than 2GB
FSRFVER  EQU   X'08'               FSRGEN contains a version number
FSRFNONQ EQU   X'04'               No enqueue during backup
FSRFNQN1 EQU   X'02'               Data set backed up - enq failed = 1
FSRFNQN2 EQU   X'01'               Data set backed up - enq failed > 1
FSRDATA  EQU   *                   Start of function data
FSRMWE   DS    CL092               Management work element
         ORG   FSRMWE
FSRDSN   DS    CL044               Data Set Name
FSRTVOL  DS    CL006               To volume serial
FSRDEVT  DS    CL004               To device type
FSRFVOL  DS    CL006               From volume serial
         ORG   FSRFVOL
FSRCLIP  DS    CL006               Target volume serial
FSRGEN   DS    BL004               Backup copy generation number
         ORG   FSRGEN
FSRDATE  DS    BL004               Backup date
FSRRC    DS    BL004               Return code
FSRREAS  DS    BL004               Reason code
FSRABCC  DS    CL004               Abnormal end code
FSRDARC  DS    BL002               Dynamic allocation return code
FSRGRP   DS    CL008               Group name
FSRRACF  DS    BL001               RACF flags
FSRMFLGS DS    CL001               Flags from the MWE
FSRFRTRY EQU   X'80'               Backup copy made during retry
FSRF_REMOTE EQU X'40'              On a remote system
FSRFPIGB EQU   X'20'               Tape already mounted
FSRF_REMOTE_HOST_PROCESSED EQU X'10' MWE processed by remote host
FSRRQN   DS    BL004               Request number
FSRDATR  DS    PL004               Request date
FSRTIMR  DS    BL004               Request time
FSRTIMS  DS    BL004               Processing start time
         ORG   FSRTIMS
FSRTIMS1 DS    CL004               Alias name
FSRTIME  DS    BL004               Processing end time
         ORG   FSRTIME
FSRTIME2 DS    CL004               Alias name
FSRTIMA  DS    BL004               Allocation time
FSRDLU   DS    PL004               Date last used
FSRDLM   DS    PL004               Date last move/migrate/bkup/recall
FSRBYTR  DS    BL004               Bytes read
FSRBYTW  DS    BL004               Bytes written
FSRTRKR  DS    BL002               Tracks read
FSRTRKW  DS    BL002               Tracks written
FSRDORG  DS    BL002               DSORG
FSRFVSDS EQU   X'08'
FSRFLG2  DS    CL002               Flag bytes
FSRFMNT  EQU   X'80'
FSRTSO   EQU   X'40'
FSRUSER  EQU   X'20'
FSRWAIT  EQU   X'10'
FSRFDAT  EQU   X'08'
FSRFRSV  EQU   X'04'
FSRFML2  EQU   X'02'
FSRFFRV  EQU   X'01'
FSRFREP  EQU   X'80'
FSRFDSRE EQU   X'40'
FSRFAPIN EQU   X'20'
FSRFEXT  EQU   X'10'
FSRFCNVT EQU   X'08'
FSRFROG  EQU   X'04'
FSRFDSS  EQU   X'02'
FSRFT0   EQU   X'01'
FSRCPU   DS    BL004               CPU time in .01 seconds for request
FSRAGE   DS    BL002               Age
FSRRECFM DS    BL001               Record format
FSROPTCD DS    BL001               Option codes
FSR_DS_MOUNT DS BL002              Count of recalls/recovers from tape
FSR_RECALL_RETRIES DS BL001
         DS    CL001               Reserved
FSR_SRCDEVS DS CL002
FSRSCLEN DS    BL002               Storage class name length
FSRSCNAM DS    CL008               Storage class name
FSRTRKKR DS    BL004               Tracks read
FSRTRKKW DS    BL004               Tracks written
FSRMCLEN DS    BL002               Management class name length
FSRMCNAM DS    CL008               Management class name
FSRFLG3  DS    BL001               Request flags
FSRFVINI EQU   X'80'
FSRFXPL1 EQU   X'40'
FSRFXPL2 EQU   X'20'
FSRFEXBV EQU   X'10'
FSRFBKTP EQU   X'08'
FSRFEXDT EQU   X'04'
FSRRECON EQU   X'02'
         DS    CL001               Reserved
FSRTIMS2 DS    CL004               Time preprocessing completed
FSRTIMM1 DS    CL004               Time data movement started
FSRTIMM2 DS    CL004               Time data movement completed
FSRTIME1 DS    CL004               Time post-processing started
FSRNENT1 DS    BL002               Number of tape volumes
FSRNENT2 DS    BL002               Number of output recycle tapes
FSRDCOPR DS    BL002               Number of requested dump copies
FSRDCOPF DS    BL002               Number of failed dump copies
FSRDCLAS DS    CL040               Dump classes
FSRHOST  DS    CL002               Host identifier
FSR_ORGNL_HID DS CL002             Host ID that generated the request
         DS    CL008               Reserved
FSRTAPE  DS    CL012               Tape volume entry
         ORG   FSRTAPE
FSRTPVOL DS    CL006               Volume serial
FSRTFLGS DS    BL001               Flags
FSRFTKB  EQU   X'80'
FSRFALT  EQU   X'40'
         DS    CL001               Reserved
FSRTBYBK DS    BL004               Bytes read/written
.NOHSMFSR9     ANOP
         AIF   ('&RT_RMMAUD' EQ '000').NORMMAUD9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         EDGSMFAR LIST=YES         DFSMSrmm SMF Audit Record
         EDGSDREC LIST=YES         DFSMSrmm Dataset Information
         EDGSKREC LIST=YES         DFSMSrmm VRS Information
         EDGSVREC LIST=YES         DFSMSrmm Volume Information
.NORMMAUD9     ANOP
         AIF   ('&RT_RMMSEC' EQ '000').NORMMSEC9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         EDGSMFSR LIST=YES         DFSMSrmm SMF Security Record
.NORMMSEC9     ANOP
         AIF   ('&RT_SMARTBATCH' EQ '000').NOSMARTBATCH9
D_SMFREC DSECT                     SMF record dummy control section
         ORG   D_SMFREC            SMF record dummy control section
         ASFPZA91 DSECT=YES,       SMF Record Type 91                  X
               LIST=YES,                                               X
               SMFRCD91=YES,                                           X
               SMF91GD=YES
.NOSMARTBATCH9 ANOP
         TITLE 'System Data Areas'
*
**       System Data Areas
*
         CVT   DSECT=YES,          Communications Vector Table (CVT)   X
               LIST=YES
         DCBD  DSORG=PS,           Data Control Block (DCB)            X
               DEVD=DA
F1AREA   DSECT
         IECSDSL1 1              Format-1 Data Set Control Block (DSCB)
         IEESMCA                   System Management Facilities (SMF)
         IEFJESCT       Job Entry Subsystem Communication Table (JESCT)
JFCB     DSECT
         IEFJFCBN LIST=YES         Job File Control Block (JFCB)
         IEFTIOT1                  Task Input/Output Table (TIOT)
         IEFUCBOB                  Unit Control Block (UCB)
         IEFZB505 LOCEPAX=YES      SWA Manager Locate Mode EPA
         IHADFA  DSECT=YES         Data Facilities Area (DFA)
         IHAECVT LIST=YES Extended Communications Vector Table (ECVT)
         IHAPSA  LIST=YES          Prefixed Save Area (PSA)
         IHASDWA                   System Diagnostic Work Area (SDWA)
         IKJTCB                    Task Control Block (TCB)
         TITLE 'DAF - Mainline'
DAF      $ENTRY AMODE=31,RMODE=24, Entry                               X
               DWA=(DAFDWA,R10,DAFDWA#),                               X
               SABNDRY=PAGE,SALENGTH=4096,                             X
               SWA=(DAFSWA,R9)
         GBLA  &GCOMMON            Common Macros Level
         AIF   (&GCOMMON GE 9).COMMONOK
         MNOTE 8,'$COMMON Macro Mismatch:  Required=9, Used=&GCOMMON'
         AGO   .COMMONOK
.COMMONOK      ANOP
         GBLC  &GVRM               Version Release Modification (v.r.m)
         GBLC  &GOBJDAT            Object date (yyyy-mm-dd)
&GOBJDAT SETC '&SYSDATC'(1,4).'-'.'&SYSDATC'(5,2).'-'.'&SYSDATC'(7,2)
         GBLC  &GSRCDAT            Source date (yyyy-mm-dd)
&GVRM    SETC '1.4.3'              Version Release Modification
&GSRCDAT SETC '2005-02-21'         Source Date (yyyy-mm-dd)
         CALL  DAFINIT             Initialization
         CALL  DAFPS               Process control statements
         CLC   W_RC,=F'0'          Ok ?
         BNE   DAFEXIT             . No
         CALL  DAFES               Extract SMF records
         CALL  DAFSS               Sort extracted SMF records
         CALL  DAFGR               Generate report
         CALL  DAFGS               Generate statistics
DAFEXIT  EQU   *
         CALL  DAFTERM             Termination
         L     R15,W_RC            Return code
         B     DAFR                Utilize RC in R15
DAF      $EXIT                     Exit
         TITLE 'DAFDWA - Dynamic Workarea'
DAFDWA   DSECT                     Workarea dynamic
*
**       Dynamic Workarea
*
W_ACB@   DS    F                   ACB address
W_KWDTB# DS    F                   Keyword table count
W_AREA@  DS    F                   Area address
W_CL016  DS    CL016               Word
W_EXLST  DS    F                   EXLST
W_EXLST@ DS    F                   EXLST address
W_CLOSE_RC DS  F                   CLOSE Return Code
W_OPEN_RC DS   F                   OPEN Return Code
W_STG_RC DS    F                   STORAGE Return Code
W_STG_ADDR DS  F                   STORAGE Address
W_STG_LENGTH DS F                  STORAGE Length
W_JFCB   DS    0F,176C             JFCB
W_TRT    DS    XL256               Translate and test table
W_SABEND DS    CL004               System abend code
W_UABEND DS    CL005               User abend code
W_NAME   DS    CL020               Name
W_VAL1O  DS    CL044               Original value 1
W_VAL2O  DS    CL044               Original value 2
W_VAL1R  DS    CL044               Resolved value 1
W_VAL2R  DS    CL044               Resolved value 2
W_OPVAL  DS    CL044               Operand value
W_CSKWD  DS    CL010               Control statement keyword
W_CSKWD@ DS    F                   Control statement keyword length
W_CSOP   DS    CL005               Control statement operator
W_CSOP@  DS    F                   Control statement operator length
W_CSVAL  DS    CL044               Control statement value
W_CSVAL@ DS    F                   Control statement value length
W_CMT@   DS    F                   Comment address
W_STRHDR DS    AL1                 SNAP storage header length
W_CS     DS    CL133               DAFCS record / SNAP header
W_CSLEN  DS    F                   DAFCS LRECL
W_FLAG   DS    BL001               Flags
W_F$CC   EQU   X'80'               DAFCC flag
W_F$VSAM EQU   X'40'               DAFSMF VSAM flag
W_F$CS   DS    BL001               Control statement error flags
W_F$KWD  EQU   X'80'               Keyword error flag
W_F$OP   EQU   X'40'               Operator error flag
W_F$VAL  EQU   X'20'               Value error flag
W_F$TRAC DS    BL001               Trace Flags
W_F$CRI  EQU   X'40'               Criteria Trace Flag
W_F$BIT0 EQU   X'80'               Bit 0 flag
W_F$BIT1 EQU   X'40'               Bit 1 flag
W_F$BIT2 EQU   X'20'               Bit 2 flag
W_F$BIT3 EQU   X'10'               Bit 3 flag
W_F$BIT4 EQU   X'08'               Bit 4 flag
W_F$BIT5 EQU   X'04'               Bit 5 flag
W_F$BIT6 EQU   X'02'               Bit 6 flag
W_F$BIT7 EQU   X'01'               Bit 7 flag
W_F$CTRI EQU   X'3F'               JFCBCTRI insignificant bits
W_MAJDES DS    CL032               Major enqueue description
W_MOD@   DS    F                   Module address
W_RPL@   DS    F                   RPL address
W_PRTDET DS    0CL133              Print detail record
         ORG   W_PRTDET            Print detail record
W_LOG    DS    0CL133              DAFLOG record
         ORG   W_PRTDET            Print detail record
W_RPT    DS    0CL133              DAFRPT record
         ORG   W_PRTDET            Print detail record
W_RPT1   DS    0CL133              DAFRPT DSN record
W_RPT1CC DS    CL001
W_RPTDSN DS    CL(L'W_DSN1)
L_RPT1   EQU   *-W_RPT1
         ORG   W_PRTDET            Print detail record
W_RPT2   DS    0CL133              DAFRPT detail record
W_RPT2CC DS    CL001
W_RPTDTE DS    CL(L'W_DATE)
         DS    CL001
W_RPTTME DS    CL(L'W_TIME)
         DS    CL001
W_RPTSID DS    CL(L'W_SYSTEM)      System identification
         DS    CL001
W_RPTJOB DS    CL(L'W_JOB1)        Job name
         DS    CL001
W_RPTUSR DS    CL(L'W_USER)        User identification
         DS    CL001
W_RPTRTY DS    CL(L'W_RECORD)
         DS    CL001
W_RPTCMT DS    CL(L'W_SRTCM1)
L_RPT2   EQU   *-W_RPT2
         ORG   W_PRTDET            Print detail record
W_STAT   DS    0CL133              DAFSTAT Print Record
W_STATCC DS    CL001
W_STATSM DS    CL015               DAFSMF counter
         DS    CL001
W_STATRP DS    CL015               DAFRPT count
         DS    CL001
W_STATIN DS    CL015               Invalid DSN counter
         DS    CL004
W_STATNM DS    CL064
         DS    CL001
         ORG   W_PRTDET+133        Print detail record
W_DSN1   DS    CL044               Dataset 1
W_DATE   DS    CL007               Date
W_TIME   DS    CL011               Time
W_SYSTEM DS    CL004               System identification
W_JOB1   DS    CL008               Job name 1
W_USER   DS    CL008               User identification
W_RECORD DS    CL003               Record type
W_SRTCM1 DS    CL086               Comment line 1
W_SRTCM2 DS    CL086               Comment line 2
W_SRTCM3 DS    CL086               Comment line 3
W_SRTCM4 DS    CL086               Comment line 4
W_SRTCM5 DS    CL086               Comment line 5
L_SRTCMT EQU   *-W_SRTCM1          Comment area length
         ORG   W_SRTCM1
W_SRTCMT DS    0CL(L_SRTCMT)       Comment area
         ORG   *+L_SRTCMT
L_SORT   EQU   *-W_DSN1            Sort record length
         ORG   W_DSN1
W_SORT   DS    0CL(L_SORT)         SORTIN/SORTOUT record
         ORG   *+L_SORT
W_CATALOG DS   CL044               Catalog name
W_DATACLAS DS  CL008               Data class name
W_DD     DS    CL008               Data definition name
W_DSN2   DS    CL044               Dataset 2
W_DSORG  DS    CL003               DSORG
W_DUP    DS    F                   DUP
W_JOB2   DS    CL008               Job name 2
W_JOB3   DS    CL008               Job name 3
W_JOB4   DS    CL008               Job name 4
W_JOB5   DS    CL008               Job name 5
W_MAJOR  DS    CL008               Major enqueue name
W_MEMBER DS    CL008               Member name
W_MGMTCLAS DS  CL008               Management class name
W_MINOR  DS    CL044               Minor enqueue name
W_NUP    DS    F                   NUP
W_RECFM  DS    CL005               RECFM
W_EXCP   DS    F                   EXCP
W_GROUP  DS    CL008               Group
W_LOGSTREAM DS CL026               Logstream name
W_LRECL  DS    F                   LRECL
W_RTY    DS    F                   SMF record type
W_STORCLAS DS  CL008               Storage class name
W_STY    DS    F                   SMF record sub type
W_VOL1   DS    CL006               Volume serial 1
W_VOL2   DS    CL006               Volume serial 2
W_VOL3   DS    CL006               Volume serial 3
W_VOL4   DS    CL006               Volume serial 4
W_VOL5   DS    CL006               Volume serial 5
W_VOL6   DS    CL006               Volume serial 6
W_VOL7   DS    CL006               Volume serial 7
W_VOL8   DS    CL006               Volume serial 8
W_VOL9   DS    CL006               Volume serial 9
W_VOLA   DS    CL006               Volume serial 10
W_VVDS   DS    CL044               VVDS name
W_WTX    DS    CL004
L_CRIT   EQU   *-W_CATALOG         Criteria length
         ORG   W_CATALOG
W_CRIT   DS    0CL(L_CRIT)         Criteria area
         ORG   *+L_CRIT
O_CATALOG EQU  W_CATALOG-DAFDWA    Catalog name offset
O_DATACLAS EQU W_DATACLAS-DAFDWA   Data class name offset
O_DATE   EQU   W_DATE-DAFDWA       Date offset
O_DD     EQU   W_DD-DAFDWA         Data definition name offset
O_DSN1   EQU   W_DSN1-DAFDWA       Dataset 1 offset
O_DSN2   EQU   W_DSN2-DAFDWA       DSN 2 offset
O_DSORG  EQU   W_DSORG-DAFDWA      DSORG offset
O_DUP    EQU   W_DUP-DAFDWA        DUP offset
O_JOB1   EQU   W_JOB1-DAFDWA       Job name 1 offset
O_JOB2   EQU   W_JOB2-DAFDWA       JOB name 2 offset
O_JOB3   EQU   W_JOB3-DAFDWA       JOB name 3 offset
O_JOB4   EQU   W_JOB4-DAFDWA       JOB name 4 offset
O_JOB5   EQU   W_JOB5-DAFDWA       JOB name 5 offset
O_MAJOR  EQU   W_MAJOR-DAFDWA      Major enqueue name offset
O_MEMBER EQU   W_MEMBER-DAFDWA     Member name offset
O_MGMTCLAS EQU W_MGMTCLAS-DAFDWA   Management class name offset
O_MINOR  EQU   W_MINOR-DAFDWA      Minor enqueue name offset
O_NUP    EQU   W_NUP-DAFDWA        NUP offset
O_RECFM  EQU   W_RECFM-DAFDWA      RECFM offset
O_EXCP   EQU   W_EXCP-DAFDWA       EXCP offset
O_GROUP  EQU   W_GROUP-DAFDWA      Group offset
O_LOGSTREAM EQU W_LOGSTREAM-DAFDWA Logstream offset
O_LRECL  EQU   W_LRECL-DAFDWA      LRECL offset
O_RTY    EQU   W_RTY-DAFDWA        SMF record type offset
O_STY    EQU   W_STY-DAFDWA        SMF record sub type offset
O_STORCLAS EQU W_STORCLAS-DAFDWA   Storage class name offset
O_SYSTEM EQU   W_SYSTEM-DAFDWA     System identification offset
O_TIME   EQU   W_TIME-DAFDWA       Time offset
O_USER   EQU   W_USER-DAFDWA       User identification offset
O_VOLA   EQU   W_VOLA-DAFDWA       Volume serial 10 offset
O_VOL1   EQU   W_VOL1-DAFDWA       Volume serial 1 offset
O_VOL2   EQU   W_VOL2-DAFDWA       Volume serial 2 offset
O_VOL3   EQU   W_VOL3-DAFDWA       Volume serial 3 offset
O_VOL4   EQU   W_VOL4-DAFDWA       Volume serial 4 offset
O_VOL5   EQU   W_VOL5-DAFDWA       Volume serial 5 offset
O_VOL6   EQU   W_VOL6-DAFDWA       Volume serial 6 offset
O_VOL7   EQU   W_VOL7-DAFDWA       Volume serial 7 offset
O_VOL8   EQU   W_VOL8-DAFDWA       Volume serial 8 offset
O_VOL9   EQU   W_VOL9-DAFDWA       Volume serial 9 offset
O_VVDS   EQU   W_VVDS-DAFDWA       VVDS name offset
O_WTX    EQU   W_WTX-DAFDWA
W_TRACE  DS    0CL133              DAFTRACE Print Record
         ORG   W_TRACE+133         DAFTRACE Print Record
W_77EDS  DS    F                   Enqueue data section offset
W_77EDN  DS    H                   Enqueue data section count
W_77EDL  DS    H                   Enqueue data section length
W_80REL  DS    H                   Relocate section offset
W_80CNT  DS    H                   Relocate section count
W_81REL  DS    H                   Relocate section offset
W_81CNT  DS    H                   Relocate section count
W_CURDTE DS    CL005               Current Julian Date YYDDD
W_DBL    DS    2D                  2-Doubleword work area
W_DOUBLE DS    D                   Doubleword work area
W_SMFBAS DS    F                   Current SMF record base
W_SMFOF1 DS    F                   Current SMF record offset 1
W_SMFOF2 DS    F                   Current SMF record offset 2
W_SMFOF3 DS    F                   Current SMF record offset 3
W_SMFOF4 DS    F                   Current SMF record offset 4
W_SMFSNAP DS   F                   SMF SNAP address
W_SMFTAB DS    F                   Current SMF table base
W_TBLKWD DS    F                   Dynamic keyword table address
W_KWD@   DS    F                   Current keyword table address
W_OP@    DS    F                   Current operator table address
W_TBLSMF DS    F                   Dynamic SMF table address
W_DAFLOG DS    CL009               DAFLOG control
W_DAFRPT DS    CL009               DAFRPT control
W_DAFSTAT DS   CL009               DAFSTAT control
DOUBLE   DS    D                   Doubleword work area
W_FULL1  DS    F                   Fullword work area
W_FULL2  DS    F                   Fullword work area
W_DAFMB4 DS    F                   Fullword work area
W_DAFPV4 DS    F                   Fullword work area
W_HALF1  DS    H                   Halfword work area
W_HALF2  DS    H                   Halfword work area
W_BYTE1  DS    X                   Byte work area
W_TYPE   DS    CL008               Type
W_BINEDT DS    XL16
W_DAFPC  DS    CL040               DAFPC work area
W_DAFPT1 DS    CL032               DAFPT work area
W_DAFPT2 DS    CL032               DAFPT work area
W_DAFPT3 DS    CL032               DAFPT work area
W_DAFPT4 DS    CL032               DAFPT work area
W_DTE_HI DS    CL007               DAFSMF high date
W_DTE_LO DS    CL007               DAFSMF low date
W_TME_HI DS    CL011               DAFSMF high time
W_TME_LO DS    CL011               DAFSMF low time
W_TMPDTE DS    CL007               Date
W_TMPTME DS    CL011               Time
W_NTU    DS    CL008               TTR
W_RCTMSK DS    CL020               Record count mask
W_CHAR16 DS    CL016               Work
W_LSTDSN DS    CL044               Last DSN
W_EPA    DS    F                   Entry Point Address
W_SMFOTH DS    F                   DAFSMF other count
W_SMFTOT DS    F                   DAFSMF total count
W_CSTOT  DS    F                   DAFCS total count
W_CCTOT  DS    F                   Check criteria total count
W_INVTOT DS    F                   Invalid DSN total count
W_RPTTOT DS    F                   DAFRPT total count
W_RC     DS    F                   Return code
W_CMTCLR DS    CL001               Comment clear indicator
W_TM     DS    CL001               TM area
W_TXTLBL DS    CL016               Label area
W_WRK    DS    CL128               Work area
W_SAVCM1 DS    CL088               Save comment line
W_SAVDD  DS    CL008               Data definition name
W_YYDDD  DS    CL005               Working julian date
         ORG   W_YYDDD
W_YY     DS    CL002               Working julian year
W_DDD    DS    CL003               Working julian day
*
**       System Macros
*
         DS    0F                  Fullword alignment
W_ESTAE  EQU   *                   ESTAE parameter list
         ORG   *+L_ESTAE           ESTAE parameter list length
         DS    0F                  Fullword alignment
DAFCS    EQU   *                   DAFCS DCB
         ORG   *+L_DAFCS           DAFCS DCB length
         DS    0F                  Fullword alignment
W_LINK   EQU   *                   LINK parameter list
         ORG   *+L_LINK            LINK parameter list length
         DS    0F                  Fullword alignment
DAFLOG   EQU   *                   DAFLOG DCB
         ORG   *+L_DAFLOG          DAFLOG DCB length
         DS    0F                  Fullword alignment
DAFOUT   EQU   *                   DAFOUT DCB
         ORG   *+L_DAFOUT          DAFOUT DCB length
         DS    0F                  Fullword alignment
DAFRPT   EQU   *                   DAFRPT DCB
         ORG   *+L_DAFRPT          DAFRPT DCB length
         DS    0F                  Fullword alignment
DAFSMF   EQU   *                   DAFSMF DCB
         ORG   *+L_DAFSMF          DAFSMF DCB length
         DS    0F                  Fullword alignment
DAFSNAP  EQU   *                   DAFSNAP DCB
         ORG   *+L_DAFSNAP         DAFSNAP DCB length
         DS    0F                  Fullword alignment
DAFSTAT  EQU   *                   DAFSTAT DCB
         ORG   *+L_DAFSTAT         DAFSTAT DCB length
         DS    0F                  Fullword alignment
DAFTRACE EQU   *                   DAFTRACE DCB
         ORG   *+L_DAFTRACE        DAFTRACE DCB length
         DS    0F                  Fullword alignment
W_RDJFCB EQU   *                   RDJFCB parameter list
         ORG   *+L_RDJFCB          RDJFCB parameter list length
         DS    0F                  Fullword alignment
W_SNAP   EQU   *                   SNAP parameter list
         ORG   *+L_SNAP            SNAP parameter list length
         DS    0F                  Fullword alignment
SORTIN   EQU   *                   SORTIN DCB
         ORG   *+L_SORTIN          SORTIN DCB length
         DS    0F                  Fullword alignment
SORTOUT  EQU   *                   SORTOUT DCB
         ORG   *+L_SORTOU          SORTOUT DCB length
         DS    0F                  Fullword alignment
W_SWAREQ EQU   *                   SWAREQ parameter list
         ORG   *+L_SWAREQ          SWAREQ parameter list length
         DS    0F                  Fullword alignment
W_OPENI  EQU   *                   OPEN parameter list (Input)
         ORG   *+L_OPENI           OPEN parameter list length (Input)
         DS    0F                  Fullword alignment
W_OPENO  EQU   *                   OPEN parameter list (Output)
         ORG   *+L_OPENO           OPEN parameter list length (Output)
         DS    0F                  Fullword alignment
W_CLOSE  EQU   *                   CLOSE parameter list
         ORG   *+L_CLOSE           CLOSE parameter list length
         DS    0F                  Fullword alignment
W_WTO    EQU   *                   WTO parameter list
W_WTOMSG EQU   W_WTO+4,100         WTO message
         ORG   *+L_WTO             WTO parameter list length
DAFDWA#  EQU   *-DAFDWA            Work area length
         TITLE 'DAFAT - Abnormal Termination'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - SDWA  (R2)                             *
**********************************************************************
DAFAT    $ENTRY AMODE=31,RMODE=24, Entry                               X
               DWA=(DAFDWA,R10,DAFDWA#),                               X
               SWA=(DAFSWA,R9)
         C     R0,=F'12'           SDWA present ?
         BNE   SDWAOK              Yes, process abend
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF901   Copy WTO message
         WTO   MF=(E,W_WTO)        Issue WTO
         B     DAFAT0              Percolate
SDWAOK   LR    R2,R1               SDWA
         USING SDWA,R2             SDWA reference
         XR    R3,R3               Clear
         ICM   R3,B'0111',SDWACMPC Store binary data
         SLL   R3,20               Isolate user abend code
         SRL   R3,20               Isolate user abend code
         MVI   W_UABEND,C'U'       User abend indicator
         CVD   R3,W_DOUBLE         Convert user abend code to decimal
         OI    W_DOUBLE+7,X'0F'    Force sign
         UNPK  W_UABEND+1(4),W_DOUBLE+4(4) Unpack record type
ATSYSERR XR    R3,R3               Clear
         ICM   R3,B'0111',SDWACMPC Store binary data
         SRL   R3,12               Isolate system abend code
         $HEX  W_DOUBLE,(R3)
         MVI   W_SABEND,C'S'       System abend indicator
         MVC   W_SABEND+1(3),W_DOUBLE+5 System abend code
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF900   Copy WTO message
         MVC   W_WTOMSG+14(4),W_SABEND System abend code
         MVC   W_WTOMSG+19(5),W_UABEND User abend code
         CLC   SDWANAME,=CL008'DAF' Programe name DAF ?
         BNE   ATNOTDAF            No
         L     R3,=A(TBLMOD)       Set module table base
         LA    R4,4(,R3)           First module entry
         L     R3,0(R3)            Set module table count
         LTR   R3,R3               Any modules ?
         BNP   ATNOMOD             No
         L     R5,SDWAGR12         DAF base register
         S     R5,SDWAEPA          Adjust for EPA
ATMODNXT L     R6,0(R4)
         S     R6,SDWAEPA          Adjust for EPA
         CR    R5,R6               Is it in this CSECT ?
         BE    ATMODFND            No, next module
ATMODINC LA    R4,12(,R4)          Next module entry
         BCT   R3,ATMODNXT         Any more modules ?
         B     ATNOMOD             No
ATMODFND MVC   W_WTOMSG+32(8),4(R4) Module name
         L     R6,SDWAGR12         CSECT base address
         S     R6,SDWAEPA          Adjust for EPA
         XR    R7,R7               Clear
         ICM   R7,B'0111',SDWANXTA Store next instruction address
         S     R7,SDWAEPA          Adjust for EPA
         CR    R7,R6               Offset within CSECT
         BH    ATOFFOK
         MVC   W_WTOMSG+41(9),P_BLANKS Offset unknown
         B     AT900E              Issue message
ATOFFOK  SR    R7,R6               Offset within CSECT
         $HEX  W_WTOMSG+42,(R7),LEN=8 Module offset
         B     AT900E              Issue message
ATNOTDAF EQU   *
ATNOMOD  MVC   W_WTOMSG+25(25),P_BLANKS Module & offset unknown
AT900E   WTO   MF=(E,W_WTO)        Issue WTO
ATPERC   LR    R1,R2               SDWA
         SETRP RC=0
         DROP  R2                  SDWA dereference
DAFAT    $EXIT                     Exit
         TITLE 'DAFCC - Check Criteria'
**********************************************************************
*  Notes:          Invalid if DSN=X'40' (blank)                      *
*                  Invalid if DSN invalid characters                 *
**********************************************************************
DAFCC    $ENTRY AMODE=31,RMODE=24  Entry
         CLC   =CL017'SYS1.DFDSS.DEFRAG',W_DSN1 Defrag Special DSN?
         BE    CCDSNOK             Yes, skip DSN check
         CLI   W_DSN1,C' '         Dataset 1 leading blank ?
         BE    CCDSNINV            Yes, skip it
         CLC   W_RECORD,=CL003'077' Enqueue ?
         BE    CCDSNOK             Yes, skip DSN check
         L     R3,=A(TBLDSN)       Set DSN table base
         USING TBLDSN,R3           DSN table reference
         TRT   W_DSN1,TBLDSN       Valid dataset 1 ?
         BZ    CCDSNOK             Yes
         DROP  R3                  DSN table dereference
CCDSNINV L     R1,W_SMFTAB         Set SMF table base
         USING D_TBLSMF,R1         SMF table reference
         $INCR D_SMFINV,F          Increment invalid individual counter
         DROP  R1                  SMF table dereference
         $INCR W_INVTOT            Increment invalid total counter
         $MSG  W_LOG,DAF610I       Move message template
         MVC   W_LOG+17(L'W_RECORD),W_RECORD Record Type
         MVC   W_LOG+21(L'W_DATE),W_DATE Record Date
         MVC   W_LOG+29(L'W_TIME),W_TIME Record Time
         MVC   W_LOG+45(L'W_DSN1),W_DSN1 Invalid dataset 1
         MVC   W_CS,W_LOG          Populate SNAP header
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         L     R1,W_SMFTAB         Set SMF table base
         USING D_TBLSMF,R1         SMF table reference
         CLC   =F'5',D_SMFINV      SNAP limit reached ?
         BL    CCNOPUT             Yes, skip the SNAP
         DROP  R1                  SMF table dereference
         CALL  SMFSNAP             SNAP current SMF record
         B     CCNOPUT             Continue
CCDSNOK  XC    W_CCTOT,W_CCTOT     Zero off include flag
         L     R3,W_TBLKWD         Set keyword table base
         USING D_TBLKWD,R3         Keyword table reference
         LA    R15,#_TBLKWD        Keyword table count
         ST    R15,W_KWDTB#        Keyword table count
CCNXTKWD LA    R5,#_TBLOP          Operator table count
         L     R8,=A(TBLOP)        Set operator table address
         USING D_TBLOP,R8          Operator table reference
CCNXTOP  LA    R15,D_KWDOVC        Operator value count
         A     R15,D_OPOFF         Operator offset
         L     R6,0(R15)           Value count
         LTR   R6,R6               Any values ?
         BZ    CCINCOP             No, next keyword table entry
         LA    R15,D_KWDVGA        Value getmain address
         A     R15,D_OPOFF         Operator offset
         L     R4,0(R15)           Value getmain address
CCNXTVAL LA    R7,D_KWDOF1         Check address
         NI    W_FLAG,255-W_F$CC   Turn off DAFCC flag
CCNXTCHK L     R2,0(R7)            Check address
         LTR   R2,R2               Any check ?
         BZ    CCINCVAL            No, next value
         AR    R2,R10              Set operand check base
         CLI   0(R2),C' '          Is operand blank
         BE    CCINCCHK            Yes, skip it
         LH    R0,D_KWDOML         Set operand maximum length
         STH   R0,W_HALF1          Set operand maximum length
         CLI   D_KWDFMT,C'F'       Fullword ?
         BNE   CCNOFULL            . No
         $FILL W_VAL1R,C' '        Blank resolved value 1
         $FILL W_VAL2R,C' '        Blank resolved value 2
         MVC   W_VAL1R(4),5(R4)    Copy value to resolved value 1
         MVC   W_VAL2R(4),0(R2)    Copy check to resolved value 2
         B     CCFULL              Continue
CCNOFULL EQU   *
         CALL  DAFRM,              Resolve Mask                        X
               (5(R4),(R2),W_HALF1),                                   X
               MF=(E,W_WRK)
CCFULL   EQU   *
         $FIND W_VAL1R,C' '        Find first blank
         $VLC  W_VAL2R,W_VAL1R,(R15),DECREMENT=NO Operand match ?
         BL    CCVLCLO1            Low
         BE    CCVLCEQ1            Equal
         BH    CCVLCHI1            High
CCVLCLO1 TM    W_F$TRAC,W_F$CRI    Criteria Trace ?
         BNO   CCVLCLO2            No
         $MSG  W_TRACE,DAF623I     Move message template
         $HEX  W_TRACE+12,W_CSTOT,LEN=2 CS count
         $HEX  W_TRACE+18,W_CCTOT,LEN=2 CC count
         MVC   W_TRACE+21(3),=C'Low'
         PUT   DAFTRACE,W_TRACE    Print a DAFTRACE record
CCVLCLO2 CLI   0(R4),X'01'         Low ?
         BNE   CCNOMTCH            No match
         B     CCMATCH             Match
CCVLCEQ1 TM    W_F$TRAC,W_F$CRI    Criteria Trace ?
         BNO   CCVLCEQ2            No
         $MSG  W_TRACE,DAF623I     Move message template
         $HEX  W_TRACE+12,W_CSTOT,LEN=2 CS count
         $HEX  W_TRACE+18,W_CCTOT,LEN=2 CC count
         MVC   W_TRACE+21(5),=C'Equal'
         PUT   DAFTRACE,W_TRACE    Print a DAFTRACE record
CCVLCEQ2 CLI   1(R4),X'01'         Equal ?
         BNE   CCNOMTCH            No match
         B     CCMATCH             Match
CCVLCHI1 TM    W_F$TRAC,W_F$CRI    Criteria Trace ?
         BNO   CCVLCHI2            No
         $MSG  W_TRACE,DAF623I     Move message template
         $HEX  W_TRACE+12,W_CSTOT,LEN=2 CS count
         $HEX  W_TRACE+18,W_CCTOT,LEN=2 CC count
         MVC   W_TRACE+21(4),=C'High'
         PUT   DAFTRACE,W_TRACE    Print a DAFTRACE record
CCVLCHI2 CLI   2(R4),X'01'         High ?
         BNE   CCNOMTCH            No match
         B     CCMATCH             Match
CCINCCHK LA    R7,4(R7)            Increment check
         B     CCNXTCHK            Next check
CCNOMTCH CLC   D_OPTXT(2),=C'NE'   Not Equal ?
         BNE   CCINCCHK            No
         NI    W_FLAG,255-W_F$CC   Turn off DAFCC flag
         B     CCINCCHK
CCMATCH  CLC   D_OPTXT(2),=C'NE'   Not Equal ?
         BNE   CCMTHALL            No
         OI    W_FLAG,W_F$CC       Turn on DAFCC flag
         B     CCINCCHK
CCMTHALL LA    R15,D_KWDOVC        Operator value count
         A     R15,D_OPOFF         Operator offset
         L     R2,0(R15)           Value count
         L     R15,W_CCTOT
         LA    R15,0(R2,R15)
         ST    R15,W_CCTOT
         B     CCINCOP
CCINCVAL TM    W_FLAG,W_F$CC       DAFCC ?
         BNO   CCINCVL2            No
         $INCR W_CCTOT             Increment DAFCC counter
CCINCVL2 LA    R4,5(,R4)           Next operand (5 byte count)
         AH    R4,D_KWDOML         Next operand
         BCT   R6,CCNXTVAL         Next value
CCINCOP  LA    R8,L_TBLOP(,R8)     Next operator entry
         BCT   R5,CCNXTOP          Any more operators ?
         DROP  R8                  Operator table dereference
CCINCKWD LA    R3,L_TBLKWD(,R3)    Next keyword table entry
         L     R1,W_KWDTB#         Keyword table count
         $DECR W_KWDTB#            Keyword table count
         BCT   R1,CCNXTKWD         Next keyword ?
         DROP  R3                  Keyword table dereference
         TM    W_F$TRAC,W_F$CRI    Criteria Trace ?
         BNO   CCNOTRA1            No
         $MSG  W_TRACE,DAF624I     Move message template
         $HEX  W_TRACE+12,W_CSTOT,LEN=2 CS count
         $HEX  W_TRACE+18,W_CCTOT,LEN=2 CC count
         MVC   W_TRACE+24(L'W_RECORD),W_RECORD RTY
         MVC   W_TRACE+32(L'W_DSN1),W_DSN1 dataset 1
         PUT   DAFTRACE,W_TRACE    Print a DAFTRACE record
CCNOTRA1 CLC   W_CSTOT,W_CCTOT     Match ?
         BNE   CCNOPUT             No, skip it
         L     R1,W_SMFTAB         Set SMF table base
         USING D_TBLSMF,R1         SMF table reference
         $INCR D_SMFRPT,F          Increment DAFRPT individual counter
         DROP  R1                  SMF table dereference
         $INCR W_RPTTOT            Increment DAFRPT total counter
         PUT   SORTIN,W_SORT       Write next logical SORTIN record
CCNOPUT  EQU   *
         CLC   W_CMTCLR,=C'N'      Clear comment area ?
         BE    CCCMTCLR            No
         $FILL W_SRTCMT,C' '       Blank comment
         LA    R15,W_SRTCMT        Initialize comment address
         ST    R15,W_CMT@          Initialize comment address
CCCMTCLR EQU   *
         MVC   W_CMTCLR,=C'Y'      Clear comment area
DAFCC    $EXIT                     Exit
         TITLE 'DAFCD - Convert Date'
DAFCD    $ENTRY AMODE=31,RMODE=24  Entry
         L     R2,0(R1)            Input date
         L     R3,4(R1)            Output date
         MVC   W_TMPDTE,0(R2)      Copy input date to work date
         LA    R2,W_TMPDTE         Work date address
         LA    R15,CDCOUNT         Century table count
         LA    R14,CDTABLE         Century table address
CDCHECK  EQU   *
         CLC   0(1,R2),0(R14)      Century match ?
         BE    CDMATCH             Yes
         LA    R14,CDLENGTH(R14)   Next century table entry
         BCT   R15,CDCHECK         Check next century table entry
CDMATCH  EQU   *
         MVC   0(1,R2),1(R14)
         OI    3(R2),X'0F'         Remove date sign
         UNPK  0(7,R3),0(4,R2)     Unpack date
         B     DAFCD0              Exit
CDTABLE  EQU   *                   Century table
         DC    X'01',X'20'         01 = 20xx
CDLENGTH EQU   (*-CDTABLE)         Century table entry length
         DC    X'00',X'19'         00 = 19xx
         DC    X'02',X'21'         02 = 21xx
         DC    X'03',X'22'         03 = 22xx
         DC    X'04',X'23'         04 = 23xx
         DC    X'05',X'24'         05 = 24xx
         DC    X'06',X'25'         06 = 25xx
         DC    X'07',X'26'         07 = 26xx
         DC    X'08',X'27'         08 = 27xx
         DC    X'09',X'28'         09 = 28xx
CDCOUNT  EQU   (*-CDTABLE)/CDLENGTH Century table entry count
         DC    X'FF',X'99'         ?? = 99xx (if not found)
DAFCD    $EXIT                     Exit
         TITLE 'DAFCSP - Control Statement Parse'
**********************************************************************
*  Input:          Control statement image in W_CS                   *
*  Output:         R15: 00 - Process keyword, operator and value     *
*                  R15: 04 - Get next control statement              *
*  Notes:          None                                              *
**********************************************************************
DAFCSP   $ENTRY AMODE=31,RMODE=24  Entry
         CLC   W_CS(1),=C'*'       Comment ?
         BE    CSCMT               Yes
         LA    R3,W_CS             DAFCS pointer
         L     R4,W_CSLEN          DAFCS length
*
**       Locate Keyword
*
         $FILL W_TRT,X'FF'         Non-blank TRT
         MVI   W_TRT+C' ',X'00'    Non-blank TRT
         $VLTRT (R3),W_TRT,(R4)    Look for Non-blank
         BZ    CSNOBLNK            No Non-blank found
         LA    R4,1(R4)            Increment beginning address
         LR    R5,R1               Save keyword begining address
         SR    R1,R3               Determine offset
         AR    R3,R1               Adjust DAFCS address
         SR    R4,R1               Adjust DAFCS length
         $FILL W_TRT,X'00'         Blank TRT
         MVI   W_TRT+C' ',X'FF'    Blank TRT
         $VLTRT (R3),W_TRT,(R4)    Look for blank
         BZ    CSNOKWD             No keyword found - skip it
         LA    R4,1(R4)            Increment beginning address
         LR    R6,R1               Save keyword ending address
         SR    R1,R3               Determine offset
         AR    R3,R1               Adjust DAFCS address
         SR    R4,R1               Adjust DAFCS length
         SR    R6,R5               Determine keyword length
         ST    R1,W_CSKWD@         Save keyword length
         LR    R15,R1              Keyword length
         $VLM  W_CSKWD,(R5),(R15)  Move the keyword
*
**       Locate Operator
*
         $FILL W_TRT,X'FF'         Non-blank TRT
         MVI   W_TRT+C' ',X'00'    Non-blank TRT
         $VLTRT (R3),W_TRT,(R4)    Look for Non-blank
         BZ    CSNOBLNK            No Non-blank found
         LA    R4,1(R4)            Increment beginning address
         LR    R5,R1               Save operator begining address
         SR    R1,R3               Determine offset
         AR    R3,R1               Adjust DAFCS address
         SR    R4,R1               Adjust DAFCS length
         $FILL W_TRT,X'00'         Blank TRT
         MVI   W_TRT+C' ',X'FF'    Blank TRT
         $VLTRT (R3),W_TRT,(R4)    Look for blank
         BZ    CSNOOP              No operator found - skip it
         LA    R4,1(R4)            Increment beginning address
         LR    R6,R1               Save operator ending address
         SR    R1,R3               Determine offset
         AR    R3,R1               Adjust DAFCS address
         SR    R4,R1               Adjust DAFCS length
         SR    R6,R5               Determine operator length
         ST    R1,W_CSOP@          Save operator length
         LR    R15,R1              Operator length
         $VLM  W_CSOP,(R5),(R15)   Move the operator
*
**       Locate Value
*
         $FILL W_TRT,X'FF'         Non-blank TRT
         MVI   W_TRT+C' ',X'00'    Non-blank TRT
         $VLTRT (R3),W_TRT,(R4)    Look for Non-blank
         BZ    CSNOBLNK            No Non-blank found
         LA    R4,1(R4)            Increment beginning address
         LR    R5,R1               Save value begining address
         SR    R1,R3               Determine offset
         AR    R3,R1               Adjust DAFCS address
         SR    R4,R1               Adjust DAFCS length
         $FILL W_TRT,X'00'         Blank TRT
         MVI   W_TRT+C' ',X'FF'    Blank TRT
         $VLTRT (R3),W_TRT,(R4)    Look for blank
         BZ    CSNOVAL             No value found - skip it
         LA    R4,1(R4)            Increment beginning address
         LR    R6,R1               Save value ending address
         SR    R1,R3               Determine offset
         AR    R3,R1               Adjust DAFCS address
         SR    R4,R1               Adjust DAFCS length
         SR    R6,R5               Determine value length
         ST    R1,W_CSVAL@         Save value length
         LR    R15,R1              Decrement value length
         $VLM  W_CSVAL,(R5),(R15)  Move the value
         L     R3,W_TBLKWD         Set keyword table address
         USING D_TBLKWD,R3         Keyword table reference
         LA    R0,#_TBLKWD         Keyword table count
CSKWDNXT CLC   W_CSKWD,D_KWDTXT    Valid keyword text ?
         BE    CSKWDFND            Yes
         CLC   W_CSKWD,D_KWDAL1    Valid keyword alias 1 ?
         BE    CSKWDFND            Yes
         CLC   W_CSKWD,D_KWDAL2    Valid keyword alias 2 ?
         BE    CSKWDFND            Yes
         CLC   W_CSKWD,D_KWDAL3    Valid keyword alias 3 ?
         BE    CSKWDFND            Yes
         CLC   W_CSKWD,D_KWDAL4    Valid keyword alias 4 ?
         BE    CSKWDFND            Yes
         CLC   W_CSKWD,D_KWDAL5    Valid keyword alias 5 ?
         BE    CSKWDFND            Yes
         LA    R3,L_TBLKWD(,R3)    Increment keyword table entry
         BCT   R0,CSKWDNXT         Check next keyword table entry
         MVC   W_CS+53(24),=C'<--- Unknown keyword    '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$KWD      Turn on keyword error flag
         B     DAFCSP4
CSKWDFND L     R4,=A(TBLOP)        Set operator table address
         USING D_TBLOP,R4          Keyword table reference
         LA    R0,#_TBLOP          Operator table count
CSOPNEXT CLC   W_CSOP,D_OPTXT      Valid operator text ?
         BE    CSOPFND             Yes
         LA    R4,L_TBLOP(,R4)     Increment operator table entry
         BCT   R0,CSOPNEXT         Check next operator table entry
         MVC   W_CS+53(24),=C'<--- Unknown operator   '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$OP       Turn on operator error flag
         B     DAFCSP4
CSOPFND  L     R7,W_CSVAL@         Value length
         LTR   R7,R7               Value missing ?
         BNZ   CSVALOK1            No
         MVC   W_CS+53(24),=C'<--- Value Missing    '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$VAL      Turn on operator error flag
         B     DAFCSP4
CSVALOK1 CH    R7,D_KWDOML         Value too long ?
         BNH   CS$TYPE             No
         MVC   W_CS+53(24),=C'<--- Value too long     '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$VAL      Turn on value error flag
         B     DAFCSP4
CS$TYPE  CLC   D_KWDTYP,=CL008'GENERAL' General type ?
         BE    CSPOK               Yes - process it
         CLC   W_TYPE,=CL008' '    Specific types yet ?
         BE    CSMVTYPE            No - move this one
         CLC   D_KWDTYP,W_TYPE     Same specific type ?
         BE    CSPOK               Yes - process it
         MVC   W_CS+53(24),=C'<--- Inconsistent type  '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$KWD      Turn on keyword error flag
         B     DAFCSP4
CSMVTYPE MVC   W_TYPE,D_KWDTYP     Set type
         B     CSPOK
CSCMT    $PRINT DAFLOG,W_CS        Put DAFLOG record
         B     DAFCSP4
CSNOBLNK MVC   W_CS+53(24),=C'<--- Unable to parse    '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$KWD      Turn on keyword error flag
         B     DAFCSP4
CSNOKWD  MVC   W_CS+53(24),=C'<--- Missing keyword    '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$KWD      Turn on keyword error flag
         B     DAFCSP4
CSNOOP   MVC   W_CS+53(24),=C'<--- Missing operator   '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$OP       Turn on operator error flag
         B     DAFCSP4
CSNOVAL  MVC   W_CS+53(24),=C'<--- Missing value      '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$VAL      Turn on value error flag
         B     DAFCSP4
CSPOK    EQU   *
         CLI   D_KWDFMT,C'F'       Fullword ?
         BNE   CSPNOF              . No - continue
         MVC   W_CL016,=16C'0'
         LA    R5,W_CL016
         LA    R5,15(R5)
         LA    R6,W_CSVAL
         L     R7,W_CSVAL@
         SR    R5,R7
         LA    R5,1(R5)
CSPFWNXT EQU   *
         MVC   0(1,R5),0(R6)
         LA    R5,1(R5)
         LA    R6,1(R6)
         BCT   R7,CSPFWNXT
         ZAP   W_DBL,=P'0'         Zero
         PACK  W_DBL,W_CL016       Pack
         CVB   R5,W_DBL            Convert to binary
         ST    R5,W_CSVAL          Store binary value
         MVC   W_CSVAL@,=F'4'      Store binary length (4)
CSPNOF   EQU   *
         ST    R3,W_KWD@           Keyword table pointer
         ST    R4,W_OP@            Operator table pointer
         B     DAFCSP0
DAFCSP   $EXIT                     Exit
         DROP  R3                  Keyword table dereference
         DROP  R4                  Operator table dereference
         TITLE 'DAFCT - Convert Time'
DAFCT    $ENTRY AMODE=31,RMODE=24  Entry
         L     R2,0(R1)            Input Time
         L     R3,4(R1)            Output Time
         MVC   W_DBL(4),0(R2)      Move SMF record binary time
         L     R1,W_DBL            Load SMF record binary time
         SLR   R0,R0               Clear
         D     R0,=F'360000'       Determine hours
         CVD   R1,W_DBL            Convert hours
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  0(2,R3),W_DBL+6(2)  Unpack hours
         MVI   2(R3),C'.'          Move period
         SRDL  R0,32               Remaining hundredths of seconds
         D     R0,=F'6000'         Determine minutes
         CVD   R1,W_DBL            Convert minutes
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  3(2,R3),W_DBL+6(2)  Unpack minutes
         MVI   5(R3),C'.'          Move period
         SRDL  R0,32               Remaining hundredths of seconds
         D     R0,=F'100'          Determine seconds
         CVD   R1,W_DBL            Convert seconds
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  6(2,R3),W_DBL+6(2)  Unpack seconds
         MVI   8(R3),C'.'          Move period
         CVD   R0,W_DBL            Convert hundredths of seconds
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  9(2,R3),W_DBL+6(2)  Unpack hundredths of seconds
DAFCT    $EXIT                     Exit
         TITLE 'DAFDSORG - Convert DSORG bitmask to DSORG character'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - DSORG bitmask address   (R3)           *
*                  . 04(R1) - DSORG character address (R4)           *
**********************************************************************
DAFDSORG $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,0(R1)            DSORG bitmask address
         L     R4,4(R1)            DSORG character address
         MVC   0(3,R4),=CL003' '   Blank DSORG character
DAFDSORGIS EQU  *
         TM    0(R3),DS1DSGIS      Indexed sequential ?
         BNO   DAFDSORGPS          . No, check physical sequential
         MVC   0(2,R4),=CL002'IS'  . Yes
         LA    R4,2(R4)            Next character
         B     DAFDSORGU           Check unmovable
DAFDSORGPS EQU  *
         TM    0(R3),DS1DSGPS      Physical sequential ?
         BNO   DAFDSORGDA          . No, check direct organization
         MVC   0(2,R4),=CL002'PS'  . Yes
         LA    R4,2(R4)            Next character
         B     DAFDSORGU           Check unmovable
DAFDSORGDA EQU  *
         TM    0(R3),DS1DSGDA      Direct organization ?
         BNO   DAFDSORGPO          . No, check partitioned organization
         MVC   0(2,R4),=CL002'DA'  . Yes
         LA    R4,2(R4)            Next character
         B     DAFDSORGU           Check unmovable
DAFDSORGPO EQU  *
         TM    0(R3),DS1DSGPO      Partitioned organization ?
         BNO   DAFDSORGVS          . No, check VSAM
         MVC   0(2,R4),=CL002'PO'  . Yes
         LA    R4,2(R4)            Next character
         B     DAFDSORGU           Check unmovable
DAFDSORGVS EQU  *
         TM    1(R3),DS1ORGAM      VSAM ?
         BNO   DAFDSORGU           . No, check unmovable
         MVC   0(2,R4),=CL002'VS'  . Yes
         LA    R4,2(R4)            Next character
         B     DAFDSORGU           Check unmovable
DAFDSORGU EQU  *
         TM    0(R3),DS1DSGU       Unmovable ?
         BNO   DAFDSORGX           . No, exit
         MVC   0(1,R4),=CL001'U'   . Yes
         B     DAFDSORGX           Exit
DAFDSORG $EXIT                     Exit
         TITLE 'DAFES - Extract SMF Records'
DAFES    $ENTRY AMODE=31,RMODE=24  Entry
         $MSG  W_LOG,DAF520I       Move message template
         MVC   W_LOG+32(19),=CL019'Extract SMF Records'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   DAFSMF(L_DAFSMF),T_DAFSMF Copy DAFSMF DCB
         LA    R15,DAFSMF          DAFSMF
         USING IHADCB,R15          DAFSMF DCB reference
         LA    R2,W_EXLST          Point to EXLST
         STCM  R2,B'0111',DCBEXLSA Store EXLST in DCB
         DROP  R15                 DAFSMF DCB dereference
         XR    R15,R15             Clear EXLST
         LA    R15,W_JFCB          Point to JFCB
         ICM   R15,B'1000',=X'87000000' Type 07
         ST    R15,W_EXLST         Store EXLST
         MVC   W_RDJFCB(L_RDJFCB),T_RDJFCB Copy RDJFCB template
         RDJFCB (DAFSMF,INPUT),    Issue RDJFCB                        X
               MF=(E,W_RDJFCB)
         LTR   R15,R15             OK ?
         BZ    ESJFCBOK            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(13),=CL013'RDJFCB/DAFSMF' System macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
ESJFCBOK EQU   *
         LA    R4,W_JFCB           DAFSMF JFCB address
         USING JFCB,R4             DAFSMF JFCB reference
         TM    JFCDSRG2,JFCORGAM   VSAM ?
         BO    ESOPNV              Yes
         TM    JFCFLGS1,JFCBLSR    Batch LSR ?
         BO    ESOPNV              Yes
ESOPNQ   EQU   *                   DAFSMF QSAM
         $MSG  W_LOG,DAF554I       Move message template
         MVC   W_LOG+20(44),JFCBDSNM  Move DSNAME into message
         MVC   W_LOG+71(4),=CL004'QSAM' Move DSORG into message
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   DAFSMF(L_DAFSMF),T_DAFSMF Copy DAFSMF DCB template
         MVC   W_OPENI(L_OPENI),T_OPENI Copy open parameter list
         OPEN  DAFSMF,MF=(E,W_OPENI) Open DAFSMF QSAM
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFSMF' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    DAFSMF+48,X'10'     DAFSMF open ?
         BNZ   ESSMFQOK            Yes
         ABEND 801,DUMP            User abend 801 (U0801)
ESSMFQOK EQU   *                   The file is open
         B     ESOPNX              Continue
ESOPNV   EQU   *                   DAFSMF VSAM
         $MSG  W_LOG,DAF554I       Move message template
         MVC   W_LOG+20(44),JFCBDSNM  Move DSNAME into message
         MVC   W_LOG+71(4),=CL004'VSAM' Move DSORG into message
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         DROP  R4                  DAFSMF JFCB dereference
         OI    W_FLAG,W_F$VSAM     Turn on DAFSMF VSAM flag
         GENCB AM=VSAM,            Generate DAFSMF VSAM EXLST          X
               BLK=EXLST,                                              X
               EODAD=(ESEOD,A),                                        X
               MF=(G,W_WRK)
         LTR   R15,R15             OK ?
         BZ    ESGEXLOK            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(11),=CL011'GENCB/EXLST' System macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
ESGEXLOK ST    R1,W_EXLST@         DAFSMF VSAM EXLST address
         L     R2,W_EXLST@         DAFSMF VSAM EXLST address
         GENCB AM=VSAM,            Generate DAFSMF VSAM ACB            X
               BLK=ACB,                                                X
               BUFND=50,                                               X
               DDNAME=DAFSMF,                                          X
               EXLST=(R2),                                             X
               LOC=BELOW,                                              X
               MACRF=(ADR,IN,NSR,NUB,SEQ),                             X
               MF=(G,W_WRK)
         LTR   R15,R15             OK ?
         BZ    ESGACBOK            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(9),=CL009'GENCB/ACB' System macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
ESGACBOK ST    R1,W_ACB@           DAFSMF VSAM ACB address
         L     R2,W_ACB@           DAFSMF VSAM ACB address
         MVC   W_OPENI(L_OPENI),T_OPENI Copy open parameter list
         OPEN  ((R2)),MF=(E,W_OPENI) Open DAFSMF VSAM
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFSMF' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         L     R15,W_OPEN_RC       DAFSMF open ?
         LTR   R15,R15             DAFSMF open ?
         BZ    ESSMFVOK            Yes
         ABEND 801,DUMP            User abend 801 (U0801)
ESSMFVOK EQU   *                   The file is open
         MVC   W_STG_LENGTH,=F'32768' VSAM Workarea length
         STORAGE OBTAIN,LENGTH=32768,BNDRY=PAGE DAFSMF VSAM workarea
         ST    R1,W_STG_ADDR       Storage address
         ST    R15,W_STG_RC        Storage return code
         LTR   R15,R15             OK ?
         BZ    ESGMOK              Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'OBTAIN/VSAM' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
ESGMOK   EQU   *
         $MSG  W_LOG,DAF550I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(13),=CL013'VSAM_Workarea'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_AREA@,W_STG_ADDR  DAFSMF VSAM workarea address
         MVC   W_SMFBAS,W_STG_ADDR DAFSMF VSAM workarea address
         L     R2,W_ACB@           DAFSMF VSAM ACB address
         L     R3,W_AREA@          DAFSMF VSAM workarea address
         GENCB ACB=(R2),           Generate DAFSMF VSAM RPL            X
               AM=VSAM,                                                X
               AREA=(R3),                                              X
               AREALEN=32768,                                          X
               BLK=RPL,                                                X
               OPTCD=(ADR,FWD,MVE,SEQ,SYN),                            X
               LOC=BELOW,                                              X
               MF=(G,W_WRK)
         LTR   R15,R15             OK ?
         BZ    ESGRPLOK            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(9),=CL009'GENCB/RPL' System macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
ESGRPLOK ST    R1,W_RPL@           DAFSMF VSAM RPL address
         B     ESOPNX              Continue
ESOPNX   EQU   *
*
**       Open SORTIN
*
         MVC   SORTIN(L_SORTIN),P_SORTIN Copy SORTIN DCB template
         MVC   W_OPENO(L_OPENO),T_OPENO Copy open parameter list
         OPEN  SORTIN,MF=(E,W_OPENO) Open SORTIN
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'SORTIN' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    SORTIN+48,X'10'     SORTIN open ?
         BNZ   ESSIOK              Yes
         ABEND 801,DUMP            User abend 801 (U0801)
ESSIOK   EQU   *                   The file is open
         MVC   W_DTE_HI,=C'0000000' Set initial high date
         MVC   W_DTE_LO,=C'9999999' Set initial low date
         MVC   W_TME_HI,=C'00.00.00.00' Set initial high time
         MVC   W_TME_LO,=C'99.99.99.99' Set initial low time
ESNEXT   TM    W_FLAG,W_F$VSAM     DAFSMF VSAM ?
         BO    ESGETV              Yes
ESGETQ   EQU   *
         GET   DAFSMF              Read next logical DAFSMF record
         LR    R4,R1               Current record address
         ST    R4,W_SMFBAS         Current record address
         B     ESGETX              Continue
ESGETV   L     R2,W_RPL@           DAFSMF VSAM RPL address
         GET   RPL=(R2)            Read next logical DAFSMF record
         L     R4,W_AREA@          Set SMF record base
         CLC   4(10,R4),=CL010'SMFEOFMARK' Logical end of file
         BE    ESEOD               End of data
         ST    R4,W_SMFBAS         Current record address
         B     ESGETX              Continue
ESGETX   EQU   *
         USING D_SMFREC,R4         SMF record reference
         $INCR W_SMFTOT            Increment SMF total counter
         L     R5,W_TBLSMF         Set SMF table base address
         USING D_TBLSMF,R5         SMF table reference
         LA    R6,#_TBLSMF         SMF definition table count
ESSNEXT  EQU   *
         CLC   SMFXXRTY,D_SMFRTY   Match ?
         BE    ESSFOUND            Yes ..
ESSINCR  EQU   *
         LA    R5,L_TBLSMF(,R5)    Next SMF table entry
         BCT   R6,ESSNEXT          Another SMF table entry ?
         $INCR W_SMFOTH            Increment SMF other counter
         B     ESNEXT              Any more DAFSMF records ?
ESSFOUND EQU   *
         ST    R5,W_SMFTAB         Save current SMF table base
         $FILL W_SORT,C' '         Blank sort record
         $FILL W_CRIT,C' '         Blank criteria area
         LA    R15,W_SRTCMT        Initialize comment address
         ST    R15,W_CMT@          Initialize comment address
         XR    R15,R15             Clear SMF record type
         ICM   R15,B'0001',SMFXXRTY Insert SMF record type
         ST    R15,W_RTY           Insert SMF record type
         MVC   W_RECORD,D_SMFRTD   SMF record type - decimal
ESRTYOK  EQU   *
         $INCR D_SMFSMF,F          Increment DAFSMF individual counter
         CALL  DAFCD,              Convert Date                        X
               (SMFXXDTE,W_DATE),  Input/Output Dates                  X
               MF=(E,W_WRK)
         CALL  DAFCT,              Convert Time                        X
               (SMFXXTME,W_TIME),  Input/Output Times                  X
               MF=(E,W_WRK)
         CLC   W_DATE,W_DTE_HI     Date = high date ?
         BNE   ESCHKHDG            No, check > high date
         CLC   W_TIME,W_TME_HI     Time > high time ?
         BNH   ESCHKLDE            No, check = low date
         MVC   W_TME_HI,W_TIME     Set high time
         B     ESCHKLDE            Check = low date
ESCHKHDG CLC   W_DATE,W_DTE_HI     Date > high date ?
         BNH   ESCHKLDE            No, check = low date
         MVC   W_DTE_HI,W_DATE     Set high date
         MVC   W_TME_HI,W_TIME     Set high time
ESCHKLDE CLC   W_DATE,W_DTE_LO     Date = low date ?
         BNE   ESCHKLDL            No, check < low date
         CLC   W_TIME,W_TME_LO     Time < low time ?
         BNL   ESCHKLDL            No, check < low date
         MVC   W_TME_LO,W_TIME     Set low time
         B     ESSYSTEM            Go move System identification
ESCHKLDL CLC   W_DATE,W_DTE_LO     Date < low date ?
         BNL   ESSYSTEM            No, go move System identification
         MVC   W_DTE_LO,W_DATE     Set low date
         MVC   W_TME_LO,W_TIME     Set low time
ESSYSTEM MVC   W_SYSTEM,SMFXXSID   System identification
         L     R15,D_SMFEXT        Set SMF extract offset
         BALR  R14,R15             Extract it
         LTR   R15,R15             Check criteria required ?
         BNZ   ESNEXT              No, any more DAFSMF records ?
         CALL  DAFCC               Check criteria
         B     ESNEXT              Any more DAFSMF records ?
ESEOD    EQU   *
*
**       Close SORTIN
*
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE SORTIN,MF=(E,W_CLOSE) Close SORTIN
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'SORTIN' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Release VSAM Workarea
*
         TM    W_FLAG,W_F$VSAM     DAFSMF VSAM ?
         BNO   ESVWNO              . No
         L     R0,=F'32768'        VSAM Workarea length
         ST    R0,W_STG_LENGTH     VSAM Workarea length
         L     R2,W_AREA@          VSAM workarea address
         ST    R2,W_STG_ADDR       VSAM workarea address
         STORAGE RELEASE,ADDR=(2),LENGTH=(0) Release VSAM workarea
         ST    R15,W_STG_RC        Storage return code
         LTR   R15,R15             OK ?
         BZ    ESVWOK              Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'RELEASE/VSAM' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
ESVWOK   EQU     *
         $MSG  W_LOG,DAF551I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(13),=CL013'VSAM_Workarea'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
ESVWNO   EQU *
*
**       Close DAFSMF
*
         TM    W_FLAG,W_F$VSAM     DAFSMF VSAM ?
         BO    ESCLSV              Yes
         TM    DAFSMF+48,X'10'     DAFSMF open ?
         BZ    ESSMNO              . No
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE DAFSMF,MF=(E,W_CLOSE) Close DAFSMF
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFSMF' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         B     ESSMNO              Continue
ESCLSV   EQU     *
         L     R2,W_ACB@
         CLOSE  ((R2))             Close DAFSMF
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFSMF' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
ESSMNO   EQU     *
         CLC   W_SMFTOT,W_SMFOTH   Records Provided ?
         BNE   ESRECPRO            . Yes
         $MSG  W_LOG,DAF708E       Move message template
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_RC,=F'8'          . No
         B     ESRECSEL            Continue
ESRECPRO EQU   *
         CLC   W_RPTTOT,=F'0'      Records Selected ?
         BNE   ESRECSEL            . Yes
         $MSG  W_LOG,DAF704W       Move message template
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_RC,=F'4'          . No
ESRECSEL EQU   *
         $MSG  W_LOG,DAF521I       Move message template
         MVC   W_LOG+32(19),=CL019'Extract SMF Records'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         DROP  R4                  SMF record dereference
         DROP  R5                  SMF table dereference
DAFES    $EXIT                     Exit
         TITLE 'DAFGR - Generate Report'
DAFGR    $ENTRY AMODE=31,RMODE=24  Entry
         $MSG  W_LOG,DAF520I       Move message template
         MVC   W_LOG+32(15),=CL015'Generate Report'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Open SORTOUT
*
         MVC   SORTOUT(L_SORTOU),P_SORTOU Copy SORTOUT DCB template
         MVC   W_OPENI(L_OPENI),T_OPENI Copy open parameter list
         OPEN  SORTOUT,MF=(E,W_OPENI) Open SORTOUT
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'SORTOUT' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    SORTOUT+48,X'10'    SORTOUT open ?
         BNZ   GRSOOK              Yes
         ABEND 801,DUMP            User abend 801 (U0801)
GRSOOK   EQU   *                   The file is open
         $FILL W_LSTDSN,C' '       Blank out last entity
GETSORT  EQU   *
         GET   SORTOUT,W_SORT      Read next logical SORTOUT record
         PUT   DAFOUT,W_SORT       Write next logical DAFOUT record
         $FILL W_RPT1,C' '         Blank DAFRPT record
         CLC   W_LSTDSN,W_DSN1     Same entity ?
         BE    GRSKPDSN            Yes, skip DSN record
         CLI   W_LSTDSN+1,C' '     First DSN ?
         BE    GRSKPBLK            Yes, skip blank record
         $PRINT DAFRPT,P_BLANKS    Put blank DAFRPT record
GRSKPBLK EQU   *
         LA    R15,W_DAFRPT        DAFRPT control
         USING D_PRTCTL,R15        DAFRPT control reference
         CP    D_PRTLNE,=P'45'     Near bottom of page ?
         BL    GRMOVDSN            No
         ZAP   D_PRTLNE,=P'99'     Force new page
         DROP  R15                 DAFRPT control dereference
GRMOVDSN MVC   W_RPTDSN,W_DSN1     Dataset
         $PRINT DAFRPT,W_RPT       Put DAFRPT record
         $FILL W_RPT1,C' '         Blank DAFRPT record
         MVC   W_LSTDSN,W_DSN1     Set last entity
GRSKPDSN EQU   *
         LA    R15,W_DAFRPT        DAFRPT control
         USING D_PRTCTL,R15        DAFRPT control reference
         CP    D_PRTLNE,=P'50'     Near bottom of page ?
         BL    GRMOVDTE            No
         ZAP   D_PRTLNE,=P'99'     Force new page
         DROP  R15                 DAFRPT control dereference
GRMOVDTE MVC   W_RPTDTE,W_DATE     Date
         MVC   W_RPTTME,W_TIME     Time
         MVC   W_RPTSID,W_SYSTEM   System identification
         MVC   W_RPTJOB,W_JOB1     Job name
         MVC   W_RPTUSR,W_USER     User identification
         MVC   W_RPTRTY,W_RECORD   Record type
         MVC   W_RPTCMT,W_SRTCM1   Comment line 1
         $PRINT DAFRPT,W_RPT       Put DAFRPT record
         CLI   W_SRTCM2,C' '       Second comment line ?
         BE    GETSORT             Any more SORTOUT records ?
         $FILL W_RPT1,C' '         Blank DAFRPT record
         MVC   W_RPTCMT,W_SRTCM2   Comment line 2
         $PRINT DAFRPT,W_RPT       Put DAFRPT record
         CLI   W_SRTCM3,C' '       Third comment line ?
         BE    GETSORT             Any more SORTOUT records ?
         $FILL W_RPT1,C' '         Blank DAFRPT record
         MVC   W_RPTCMT,W_SRTCM3   Comment line 3
         $PRINT DAFRPT,W_RPT       Put DAFRPT record
         CLI   W_SRTCM4,C' '       Fourth comment line ?
         BE    GETSORT             Any more SORTOUT records ?
         $FILL W_RPT1,C' '         Blank DAFRPT record
         MVC   W_RPTCMT,W_SRTCM4   Comment line 4
         $PRINT DAFRPT,W_RPT       Put DAFRPT record
         CLI   W_SRTCM5,C' '       Fifth comment line ?
         BE    GETSORT             Any more SORTOUT records ?
         $FILL W_RPT1,C' '         Blank DAFRPT record
         MVC   W_RPTCMT,W_SRTCM5   Comment line 5
         $PRINT DAFRPT,W_RPT       Put DAFRPT record
         B     GETSORT             Any more SORTOUT records ?
GREOD    EQU   *
*
**       Close SORTOUT
*
         TM    SORTOUT+48,X'10'    SORTOUT open ?
         BZ    GRSONO              . No
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE SORTOUT,MF=(E,W_CLOSE) Close SORTOUT
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'SORTOUT' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
GRSONO   EQU *
         $MSG  W_LOG,DAF521I       Move message template
         MVC   W_LOG+32(15),=CL015'Generate Report'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
DAFGR    $EXIT                     Exit
         TITLE 'DAFGS - Generate Statistics'
DAFGS    $ENTRY AMODE=31,RMODE=24  Entry
         $MSG  W_LOG,DAF520I       Move message template
         MVC   W_LOG+32(19),=CL019'Generate Statistics'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         L     R3,W_TBLSMF         Set SMF table base address
         USING D_TBLSMF,R3         SMF table reference
         LA    R4,#_TBLSMF         SMF definition table count
GSNEXT   $FILL W_STAT,C' '         Blank DAFSTAT record
         MVC   W_STATNM,D_SMFRNM   Specific SMF record name
         L     R0,D_SMFSMF         Specific
         CVD   R0,W_DBL              DAFSMF
         MVC   W_RCTMSK,P_RCTMSK       Record
         EDMK  W_RCTMSK,W_DBL            Counts
         MVC   W_STATSM,W_RCTMSK+5
         L     R0,D_SMFRPT         Specific
         CVD   R0,W_DBL              DAFRPT
         MVC   W_RCTMSK,P_RCTMSK       Record
         EDMK  W_RCTMSK,W_DBL            Counts
         MVC   W_STATRP,W_RCTMSK+5
         L     R0,D_SMFINV         Specific
         CVD   R0,W_DBL              Invalid
         MVC   W_RCTMSK,P_RCTMSK       Record
         EDMK  W_RCTMSK,W_DBL            Counts
         MVC   W_STATIN,W_RCTMSK+5
         $PRINT DAFSTAT,W_STAT     Put DAFSTAT record (specific line)
         LA    R3,L_TBLSMF(,R3)    Next SMF table entry
         BCT   R4,GSNEXT           Another one ?
         $FILL W_STAT,C' '         Blank DAFSTAT record
         MVC   W_STATNM+6(58),P_OTH Other SMF record name
         L     R0,W_SMFOTH         Other
         CVD   R0,W_DBL              DAFSMF
         MVC   W_RCTMSK,P_RCTMSK       Record
         EDMK  W_RCTMSK,W_DBL            Counts
         MVC   W_STATSM,W_RCTMSK+5
         $PRINT DAFSTAT,W_STAT     Put DAFSTAT record (Other line)
         $FILL W_STAT,C' '         Blank DAFSTAT record
         MVC   W_STATNM+6(58),P_TOT Total SMF record name
         L     R0,W_SMFTOT         Total
         CVD   R0,W_DBL              DAFSMF
         MVC   W_RCTMSK,P_RCTMSK       Record
         EDMK  W_RCTMSK,W_DBL            Counts
         MVC   W_STATSM,W_RCTMSK+5
         L     R0,W_RPTTOT         Total
         CVD   R0,W_DBL              DAFRPT
         MVC   W_RCTMSK,P_RCTMSK       Record
         EDMK  W_RCTMSK,W_DBL            Counts
         MVC   W_STATRP,W_RCTMSK+5
         L     R0,W_INVTOT         Total
         CVD   R0,W_DBL              Invalid
         MVC   W_RCTMSK,P_RCTMSK       Record
         EDMK  W_RCTMSK,W_DBL            Counts
         MVC   W_STATIN,W_RCTMSK+5
         $PRINT DAFSTAT,W_STAT     Put DAFSTAT record (total line)
         $PRINT DAFSTAT,P_BLANKS   Put blank DAFSTAT record
         $FILL W_STAT,C' '         Blank DAFSTAT record
         MVC   W_STAT+01(23),=C'DAFSMF Date/Time Range:'
         $PRINT DAFSTAT,W_STAT     Put DAFSTAT record
         $FILL W_STAT,C' '         Blank DAFSTAT record
         MVC   W_STAT+01(13),=C'Low  - Date: '
         MVC   W_STAT+14(07),W_DTE_LO
         MVC   W_STAT+21(08),=C'  Time: '
         MVC   W_STAT+29(11),W_TME_LO
         $PRINT DAFSTAT,W_STAT     Put DAFSTAT record
         $FILL W_STAT,C' '         Blank DAFSTAT record
         MVC   W_STAT+01(13),=C'High - Date: '
         MVC   W_STAT+14(07),W_DTE_HI
         MVC   W_STAT+21(08),=C'  Time: '
         MVC   W_STAT+29(11),W_TME_HI
         $PRINT DAFSTAT,W_STAT     Put DAFSTAT record
         DROP  R3                  SMF table dereference
GSEXIT   EQU   *
         $MSG  W_LOG,DAF521I       Move message template
         MVC   W_LOG+32(19),=CL019'Generate Statistics'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
DAFGS    $EXIT                     Exit
         TITLE 'DAFINIT - Initialization'
DAFINIT  $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,0(R1)            Get JCL Parameter Pointer
         LH    R2,0(R1)            Get JCL Parameter Length
*
**       Establish Recovery Environment
*
         MVC   W_ESTAE(L_ESTAE),T_ESTAE Copy ESTAE parameter list
         ESTAE 0,MF=(E,W_ESTAE)    Cancel ESTAE
         MVC   W_ESTAE(L_ESTAE),T_ESTAE Copy ESTAE parameter list
         L     R4,=A(DAFAT)        Abnormal termination CSECT address
         ESTAE (R4),CT,MF=(E,W_ESTAE)
         LTR   R15,R15             OK ?
         BZ    ESTAEOK2            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(11),=CL011'ESTAE/DAFAT' System macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
ESTAEOK2 EQU   *
*
**       Open DAFLOG
*
         MVC   DAFLOG(L_DAFLOG),T_DAFLOG Copy DAFLOG DCB template
         MVC   W_OPENO(L_OPENO),T_OPENO Copy open parameter list
         OPEN  DAFLOG,MF=(E,W_OPENO) Open DAFLOG
         TM    DAFLOG+48,X'10'     DAFLOG open ?
         BNZ   INITLGOK            Yes
         ABEND 801,DUMP            User abend 801 (U0801)
INITLGOK EQU   *                   The file is open
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         LA    R15,W_DAFLOG        DAFLOG control
         USING D_PRTCTL,R15        DAFLOG control reference
         LA    R1,P_LOG            Get DAFLOG header address
         ST    R1,D_PRTHDR         Store DAFLOG header address
         ZAP   D_PRTPGE,=P'0'      Initialize page counter
         ZAP   D_PRTLNE,=P'99'     Initialize line counter
         DROP  R15                 DAFLOG control dereference
         $MSG  W_LOG,DAF520I       Move message template
         MVC   W_LOG+32(14),=CL014'Initialization'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFLOG' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Open DAFCS
*
         MVC   DAFCS(L_DAFCS),T_DAFCS Copy DAFCS DCB template
         MVC   W_OPENI(L_OPENI),T_OPENI Copy open parameter list
         OPEN  DAFCS,MF=(E,W_OPENI) Open DAFCS
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFCS'  Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    DAFCS+48,X'10'      DAFCS open ?
         BNZ   INITCSOK            Yes
         ABEND 801,DUMP            User abend 801 (U0801)
INITCSOK EQU   *                   The file is open
         LA    R15,DAFCS           DAFCS
         USING IHADCB,R15          DAFCS DCB reference
         LH    R0,DCBLRECL         DAFCS LRECL
         ST    R0,W_CSLEN          DAFCS LRECL
         DROP  R15                 DAFCS DCB dereference
*
**       Open DAFOUT
*
         MVC   DAFOUT(L_DAFOUT),T_DAFOUT Copy DAFOUT DCB template
         MVC   W_OPENO(L_OPENO),T_OPENO Copy open parameter list
         OPEN  DAFOUT,MF=(E,W_OPENO) Open DAFOUT
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFOUT' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    DAFOUT+48,X'10'     DAFOUT open ?
         BNZ   INITOUOK            . Yes
         ABEND 801,DUMP            . No - User abend 801 (U0801)
INITOUOK EQU   *                   DAFOUT is open
*
**       Open DAFRPT
*
         MVC   DAFRPT(L_DAFRPT),T_DAFRPT Copy DAFRPT DCB template
         MVC   W_OPENO(L_OPENO),T_OPENO Copy open parameter list
         OPEN  DAFRPT,MF=(E,W_OPENO) Open DAFRPT
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFRPT' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    DAFRPT+48,X'10'     DAFRPT open ?
         BNZ   INITRPOK            Yes
         ABEND 801,DUMP            User abend 801 (U0801)
INITRPOK EQU   *                   The file is open
         LA    R15,W_DAFRPT        DAFRPT control
         USING D_PRTCTL,R15        DAFRPT control reference
         LA    R1,P_RPT            Get DAFRPT header address
         ST    R1,D_PRTHDR         Store DAFRPT header address
         ZAP   D_PRTPGE,=P'0'      Initialize page counter
         ZAP   D_PRTLNE,=P'99'     Initialize line counter
         DROP  R15                 DAFRPT control dereference
*
**       Open DAFSNAP
*
         MVC   DAFSNAP(L_DAFSNAP),T_DAFSNAP Copy DAFSNAP DCB template
         MVC   W_OPENO(L_OPENO),T_OPENO Copy open parameter list
         OPEN  DAFSNAP,MF=(E,W_OPENO) Open DAFSNAP
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFSNAP' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    DAFSNAP+48,X'10'    DAFSNAP open ?
         BNZ   INITSNOK            Yes
         ABEND 801,DUMP            User abend 801 (U0801)
INITSNOK EQU   *                   The file is open
*
**       Open DAFSTAT
*
         MVC   DAFSTAT(L_DAFSTAT),T_DAFSTAT Copy DAFSTAT DCB template
         MVC   W_OPENO(L_OPENO),T_OPENO Copy open parameter list
         OPEN  DAFSTAT,MF=(E,W_OPENO) Open DAFSTAT
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFSTAT' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    DAFSTAT+48,X'10'    DAFSTAT open ?
         BNZ   INITSTOK            Yes
         ABEND 801,DUMP            User abend 801 (U0801)
INITSTOK EQU   *                   The file is open
         LA    R15,W_DAFSTAT       DAFSTAT control
         USING D_PRTCTL,R15        DAFSTAT control reference
         LA    R1,P_STAT           Get DAFSTAT header address
         ST    R1,D_PRTHDR         Store DAFSTAT header address
         ZAP   D_PRTPGE,=P'0'      Initialize DAFSTAT page counter
         ZAP   D_PRTLNE,=P'99'     Initialize DAFSTAT line counter
         DROP  R15                 DAFSTAT control dereference
*
**       Open DAFTRACE
*
         MVC   DAFTRACE(L_DAFTRACE),T_DAFTRACE Copy DAFTRACE DCB templ
         MVC   W_OPENO(L_OPENO),T_OPENO Copy open parameter list
         OPEN  DAFTRACE,MF=(E,W_OPENO) Open DAFTRACE
         ST    R15,W_OPEN_RC       Save the return code from OPEN
         $MSG  W_LOG,DAF552I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFTRACE' Move DDNAME into message
         $HEX  W_LOG+29,W_OPEN_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         TM    DAFTRACE+48,X'10'   DAFTRACE open ?
         BNZ   INITTROK            Yes
         ABEND 801,DUMP            User abend 801 (U0801)
INITTROK EQU   *                   The file is open
*
**       Obtain Keyword Table
*
         MVC   W_STG_LENGTH,=F'8192' Storage length
         STORAGE OBTAIN,LENGTH=8192,BNDRY=PAGE Keyword table
         ST    R1,W_STG_ADDR       Storage address
         ST    R15,W_STG_RC        Storage return code
         LTR   R15,R15             OK ?
         BZ    GMKWDOK             Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'OBTAIN/TBLKWD' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
GMKWDOK  EQU   *
         $MSG  W_LOG,DAF550I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(13),=CL013'Keyword_Table'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_TBLKWD,W_STG_ADDR Dynamic keyword table address
         L     R0,W_TBLKWD         Dynamic keyword table address
         L     R1,=F'8192'         Keyword table length
         L     R14,=A(TBLKWD)      Static keyword table address
         LR    R15,R1              Keyword table length
         MVCL  R0,R14              Copy keyword table
*
**       Obtain SMF Table
*
         LA    R0,@_TBLSMF         SMF table length
         ST    R0,W_STG_LENGTH     SMF table length
         STORAGE OBTAIN,LENGTH=@_TBLSMF,BNDRY=PAGE Dynamic SMF table
         ST    R1,W_STG_ADDR       Storage address
         ST    R15,W_STG_RC        Storage return code
         LTR   R15,R15             OK ?
         BZ    GMSMFOK             Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'OBTAIN/TBLSMF' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
GMSMFOK  EQU   *
         $MSG  W_LOG,DAF550I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(09),=CL009'SMF_Table'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_TBLSMF,W_STG_ADDR Dynamic keyword table address
         L     R0,W_TBLSMF         Dynamic SMF table address
         LA    R1,@_TBLSMF         SMF table length
         L     R14,=A(TBLSMF)      Static SMF table address
         LR    R15,R1              SMF table length
         MVCL  R0,R14              Copy SMF table
*
**       Obtain SNAP Storage
*
         MVC   W_STG_LENGTH,=F'32768' SMF SNAP storage length
         STORAGE OBTAIN,LENGTH=32768,BNDRY=PAGE SMF SNAP storage
         ST    R1,W_STG_ADDR       Storage address
         ST    R15,W_STG_RC        Storage return code
         LTR   R15,R15             OK ?
         BZ    GMSNAPOK            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'OBTAIN/SMFSNAP' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
GMSNAPOK EQU   *
         $MSG  W_LOG,DAF550I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(09),=CL009'SMF_SNAP'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_SMFSNAP,W_STG_ADDR SMF SNAP storage address
*
**       Process EXEC PARMs
*
         LTR   R2,R2               Any JCL Parameter ?
         BZ    NOJCLPRM            No, Continue
         CLC   2(8,R3),=C'ALLTRACE'  All traces requested ?
         BNE   PARMCRIT            Yes, check criteria trace
         OI    W_F$TRAC,W_F$CRI    Turn on criteria trace flag
         B     TRACEOPN            Open DAFTRACE
PARMCRIT CLC   2(8,R3),=C'CRITRACE'  Criteria trace requested ?
         BNE   NOJCLPRM            No, continue
         OI    W_F$TRAC,W_F$CRI    Turn on criteria trace flag
         B     TRACEOPN            Open DAFTRACE
TRACEOPN EQU   *
NOJCLPRM EQU   *
*
**       Display SMF System Identification
*
         XR    R6,R6               PSA address
         USING PSA,R6              PSA reference
         L     R6,FLCCVT           CVT address
         DROP  R6                  PSA dereference
         USING CVT,R6              CVT reference
         L     R6,CVTSMCA          SMCA address
         DROP  R6                  CVT dereference
         USING SMCABASE,R6         SMCA reference
         $MSG  W_LOG,DAF560I       Move message template
         MVC   W_LOG+36(4),SMCASID SMF System Identification
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         DROP  R6                  SMCA dereference
*
**       Display Base Control Program Name and Level
*
         XR    R6,R6               PSA address
         USING PSA,R6              PSA reference
         L     R6,FLCCVT           CVT address
         DROP  R6                  PSA dereference
         USING CVT,R6              CVT reference
         L     R6,CVTECVT          ECVT address
         DROP  R6                  CVT dereference
         USING ECVT,R6             ECVT reference
         $MSG  W_LOG,DAF561I       Move message template
         MVC   W_LOG+22(06),=CL006'BCP'
         MVC   W_LOG+29(06),ECVTPNAM Product Name
         MVC   W_LOG+36(02),ECVTPVER Product Version
         MVC   W_LOG+39(02),ECVTPREL Product Release
         MVC   W_LOG+42(02),ECVTPMOD Product Modification
         DROP  R6                  ECVT dereference
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Display Data Facilities Name and Level
*
         XR    R6,R6               PSA address
         USING PSA,R6              PSA reference
         L     R6,FLCCVT           CVT address
         DROP  R6                  PSA dereference
         USING CVT,R6              CVT reference
         L     R6,CVTDFA           DFA address
         DROP  R6                  CVT dereference
         USING DFA,R6              DFA reference
         $MSG  W_LOG,DAF561I       Move message template
         CLI   DFAPROD,DFAZOS      DFSMS z/OS ?
         BNE   INITDFAOS390        . No
         MVC   W_LOG+22(13),=CL013'DFSMS  z/OS' Product Name
         XR    R7,R7               Clear
         ICM   R7,B'0111',DFAVER   Load hex 3 byte VRM
         O     R7,=X'00F0F0F0'     Convert to ZD
         ST    R7,W_DOUBLE+4       Move to storage
         PACK  W_DOUBLE(2),W_DOUBLE+5(3) Unpack VRM
         XR    R7,R7               Clear
         ICM   R7,B'0011',W_DOUBLE Load packed 2 byte VRM
         ST    R7,W_DOUBLE         Move to storage
         UNPK  W_FULL1(3),W_DOUBLE+2(2) Unpack VRM
         MVC   W_LOG+37(01),W_FULL1  Product Version
         MVC   W_LOG+40(01),W_FULL1+1 Product Release
         MVC   W_LOG+43(01),W_FULL1+2 Product Modification
         B     INITDFAMSG          Continue
INITDFAOS390 EQU *
         CLI   DFAPROD,DFAOS390    DFSMS OS/390 ?
         BNE   INITDFADFSMS        . No
         MVC   W_LOG+22(13),=CL013'DFSMS  OS/390' Product Name
         XR    R7,R7               Clear
         ICM   R7,B'0111',DFAVER   Load hex 3 byte VRM
         O     R7,=X'00F0F0F0'     Convert to ZD
         ST    R7,W_DOUBLE+4       Move to storage
         PACK  W_DOUBLE(2),W_DOUBLE+5(3) Unpack VRM
         XR    R7,R7               Clear
         ICM   R7,B'0011',W_DOUBLE Load packed 2 byte VRM
         ST    R7,W_DOUBLE         Move to storage
         UNPK  W_FULL1(3),W_DOUBLE+2(2) Unpack VRM
         MVC   W_LOG+37(01),W_FULL1  Product Version
         MVC   W_LOG+40(01),W_FULL1+1 Product Release
         MVC   W_LOG+43(01),W_FULL1+2 Product Modification
         B     INITDFAMSG          Continue
INITDFADFSMS EQU *
         CLI   DFAPROD,DFADFSMS    DFSMS ?
         BNE   INITDFADFP          . No
         MVC   W_LOG+22(13),=CL013'DFSMS' Product Name
         XR    R7,R7               Clear
         ICM   R7,B'0111',DFAVER   Load hex 3 byte VRM
         O     R7,=X'00F0F0F0'     Convert to ZD
         ST    R7,W_DOUBLE+4       Move to storage
         PACK  W_DOUBLE(2),W_DOUBLE+5(3) Unpack VRM
         XR    R7,R7               Clear
         ICM   R7,B'0011',W_DOUBLE Load packed 2 byte VRM
         ST    R7,W_DOUBLE         Move to storage
         UNPK  W_FULL1(3),W_DOUBLE+2(2) Unpack VRM
         MVC   W_LOG+37(01),W_FULL1  Product Version
         MVC   W_LOG+40(01),W_FULL1+1 Product Release
         MVC   W_LOG+43(01),W_FULL1+2 Product Modification
         B     INITDFAMSG          Continue
INITDFADFP   EQU *
         CLI   DFAPROD,DFADFP      DFP ?
         BNE   INITDFAERR          . No
         MVC   W_LOG+22(13),=CL013'DFP' Product Name
         XR    R7,R7               Clear
         ICM   R7,B'0011',DFAREL   Load hex 2 byte VRM
         O     R7,=X'0000000F'     Force sign
         ST    R7,W_DOUBLE         Move to storage
         UNPK  W_FULL1(3),W_DOUBLE+2(2) Unpack VRM
         MVC   W_LOG+37(01),W_FULL1  Product Version
         MVC   W_LOG+40(01),W_FULL1+1 Product Release
         MVC   W_LOG+43(01),W_FULL1+2 Product Modification
         B     INITDFAMSG          Continue
INITDFAERR   EQU *
         MVC   W_LOG+22(13),=CL013'DFA Unknown' Product Name
         B     INITDFAMSG          Continue
INITDFAMSG   EQU *
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         DROP  R6                  DFA dereference
*
**       Display SMF Record Types Not Being Recorded
*
         L     R4,W_TBLSMF         Set SMF table base address
         USING D_TBLSMF,R4         SMF table reference
         LA    R5,#_TBLSMF         SMF definition table count
INITRECN EQU   *
         XR    R6,R6               Clear SMF record type
         ICM   R6,B'0001',D_SMFRTY SMF record type
         SMFRTEST RECTYPE=(R6)     Testing Record Recording
         C     R15,=F'0'           OK ?
         BE    INITRECI            . Yes
         $MSG  W_LOG,DAF530I       Move message template
         MVC   W_LOG+52(64),D_SMFRNM SMF Record Name
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
INITRECI EQU   *
         LA    R4,L_TBLSMF(,R4)    Next SMF table entry
         BCT   R5,INITRECN         Another SMF table entry ?
         $MSG  W_LOG,DAF521I       Move message template
         MVC   W_LOG+32(14),=CL014'Initialization'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         DROP  R4                  SMF table dereference
DAFINIT  $EXIT                     Exit
         TITLE 'DAFMB - Move Binary'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - Label address  (R2)                    *
*                  . 04(R1) - Binary address (R3)                    *
*                  . 08(R1) - Binary length  (R4)                    *
*  Notes:          Exit if the binary value is zero.                 *
**********************************************************************
DAFMB    $ENTRY AMODE=31,RMODE=24  Entry
         L     R2,0(R1)            Label address
         L     R3,4(R1)            Binary address
         LTR   R3,R3               Binary address zero ?
         BNP   DAFMB0              Yes, Done
         L     R4,8(R1)            Binary length
         LTR   R4,R4               Binary length zero ?
         BNP   DAFMB0              Yes, Done
         XC    W_DAFMB4,W_DAFMB4   Zero temp fullword
         LA    R5,W_DAFMB4         Temp fullword address
         AH    R5,=H'4'            Point to end of temp fullword
         SR    R5,R4               Adjust for length
         $VLM  (R5),(R3),(R4)      Move binary value
         L     R3,W_DAFMB4         Store binary value
         LTR   R3,R3               Binary value zero ?
         BNP   DAFMB0              Yes, Done
         MVC   W_TXTLBL,0(R2)
         CVD   R3,W_DBL
         MVC   W_BINEDT,P_BINMSK
         EDMK  W_BINEDT,W_DBL
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,W_BINEDT,16), Move                            X
               MF=(E,W_WRK)
DAFMB    $EXIT                     Exit
         TITLE 'DAFMC - Move Comment'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - Label address (R3)                     *
*                  . 04(R1) - Field address (R4)                     *
*                  . 08(R1) - Field length  (R5)                     *
*  Notes:          If input field leading null - exit.               *
*                  If input field completely blank - exit.           *
*                  Will stop moving characters if max length or      *
*                  trailing blank is encountered.                    *
*                  Will skip label if equal to CL004'NONE'.          *
**********************************************************************
DAFMC    $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,0(R1)            Input label address
         L     R4,4(R1)            Input field address
         CLI   0(R4),X'00'         Input field leading null ?
         BE    DAFMC0              Yes, get out
         L     R5,8(R1)            Input field max length
         LR    R15,R5              Input field max length
         $VLC  (R4),P_BLANKS,(R15) Input field completely blank ?
         BE    DAFMC0              Yes, get out
         XR    R7,R7               Clear counter
         $FILL W_SAVCM1,C' '       Blank temp comment
         LA    R2,W_SAVCM1         Temp comment address
         LA    R6,15               Maximum label length
         CLC   0(4,R3),=C'NONE'    Bypass label ?
         BE    MCFSLB              Yes, skip it
MCLSLB   CLC   0(1,R3),=C' '       Leading label blanks?
         BNE   MCLNXT              No, move it
         LA    R3,1(,R3)           Next input byte
         B     MCLSLB              Another label byte ?
MCLNXT   MVC   0(1,R2),0(R3)       Move one label byte
         CLC   0(1,R3),=C' '       Trailing label blank ?
         BE    MCLEXIT             Yes, Done
         CLC   0(1,R3),=C'='       Trailing label equal sign ?
         BE    MCLEXIT             Yes, Done
         LA    R3,1(,R3)           Next input byte
         LA    R2,1(,R2)           Next output byte
         LA    R7,1(,R7)           Increment counter
         BCT   R6,MCLNXT           Another label byte ?
MCLEXIT  LA    R2,1(,R2)           Next output byte
         LA    R7,1(,R7)           Increment counter
MCFSLB   CLC   0(1,R4),=C' '       Leading field blank ?
         BNE   MCFNXT              No, move it
         LA    R4,1(,R4)           Next input byte
         BCTR  R5,0                Decrement max length
         B     MCFSLB              Another field byte ?
MCFNXT   MVC   0(1,R2),0(R4)       Move one field byte
         CLC   0(1,R4),=C' '       Trailing field blank ?
         BE    MCFEXIT             Yes, Done
         LA    R4,1(,R4)           Next input byte
         LA    R2,1(,R2)           Next output byte
         LA    R7,1(,R7)           Increment counter
         BCT   R5,MCFNXT           Another field byte ?
MCFEXIT  LA    R2,1(,R2)           Next output byte
         LA    R7,1(,R7)           Increment counter
         L     R6,W_CMT@           Comment address
         LA    R2,W_SRTCMT         Comment starting address
         SR    R6,R2               Comment length
         LR    R2,R6               Comment length
         AR    R2,R7               Determine new comment length
         C     R6,=F'86'           Comment line 1 ?
         BH    MCC2L               No, check comment line 2
         C     R2,=F'86'           Too big for comment line 1 ?
         BL    MCMOVE              Move it
         LA    R15,W_SRTCM2        Bump it up to comment line 2
         ST    R15,W_CMT@          Save new comment address
         B     MCMOVE              Move it
MCC2L    C     R6,=F'172'          Comment line 2 ?
         BH    MCC3L               No, check comment line 3
         C     R2,=F'172'          Too big for comment line 2 ?
         BL    MCMOVE              Move it
         LA    R15,W_SRTCM3        Bump it up to comment line 3
         ST    R15,W_CMT@          Save new comment address
         B     MCMOVE              Move it
MCC3L    C     R6,=F'258'          Comment line 3 ?
         BH    MCC4L               No, check comment line 4
         C     R2,=F'258'          Too big for comment line 3 ?
         BL    MCMOVE              Move it
         LA    R15,W_SRTCM4        Bump it up to comment line 4
         ST    R15,W_CMT@          Save new comment address
         B     MCMOVE              Move it
MCC4L    C     R6,=F'344'          Comment line 4 ?
         BH    MCC5L               No, check comment line 5
         C     R2,=F'344'          Too big for comment line 4 ?
         BL    MCMOVE              Move it
         LA    R15,W_SRTCM5        Bump it up to comment line 5
         ST    R15,W_CMT@          Save new comment address
         B     MCMOVE              Move it
MCC5L    C     R6,=F'430'          Comment line 5 ?
         BH    DAFMC4              No, get out RC=04
         C     R2,=F'430'          Too big for comment line 5 ?
         BL    MCMOVE              Move it
         B     DAFMC4              Comment too long - Get out RC=04
MCMOVE   L     R6,W_CMT@           Comment address
         BCTR  R7,0                Move length - 1
         LR    R1,R7               Move length - 1
         $VLM  (R6),W_SAVCM1,(R1)  Move it
         AR    R6,R7               New address
         LA    R6,1(,R6)           Incr
         ST    R6,W_CMT@           Save
DAFMC    $EXIT                     Exit
         TITLE 'DAFPC - Process Compare Table'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - Compare Table Address (R3)             *
*                  . 04(R1) - Comparator Address    (R4)             *
*  Output:         R15 -  00 - Comparator found                      *
*                  R15 -  04 - Comparator not found                  *
*  Notes:          Move compare table label to W_TXTLBL ending in =  *
*                  Compare values                                    *
*                  If equal:  Mov_cmt(label=text), RC=00             *
*                  If not:    Mov_cmt(label=Unknown), RC=04          *
*                  If text = reserved then get out                   *
**********************************************************************
DAFPC    $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,0(R1)            Compare table address
         L     R4,4(R1)            Comparator address
         L     R5,0(R3)            Compare length
         LA    R3,4(,R3)           Entries
         L     R6,0(,R3)           Entries
         LA    R3,4(,R3)           Input label address
         LA    R2,W_TXTLBL         Output label address
         $FILL W_TXTLBL,C' '       Blank label
         $FILL W_DAFPC,C' '        Blank work
PCLNXT   MVC   0(1,R2),0(R3)       Move one label byte
         CLC   0(1,R3),=C'='       Trailing label equal sign ?
         BE    PCLEXIT             Yes, Done
         LA    R3,1(,R3)           Next input label address
         LA    R2,1(,R2)           Next output label address
         B     PCLNXT              Get next input label byte
PCLEXIT  EQU   *
*CLEXIT  LR    R15,R5              Compare length
         LA    R3,1(,R3)           Next input label address
PCNEXT   $VLC  (R3),(R4),(R5)      CHAR match ?
         BNE   PCINCR
         LR    R7,R3               Entry address
         AR    R7,R5               Text address
         CLC   0(8,R15),=C'Reserved' Reserved value ?
         BE    DAFPC0              Yes, get out
         MVC   W_DAFPC,0(R7)       Save text value
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R7),41),                                     X
               MF=(E,W_WRK)
         B     DAFPC0              Get out
PCINCR   LA    R3,46(,R3)          Next CHAR table entry
         BCT   R6,PCNEXT           Another one ?
         CLC   W_TXTLBL(6),=C'MAJOR=' Major enqueue ?
         BE    DAFPC4              Indicate comparator not found
         $FILL W_CHAR16,C' '       Blank work area
         MVC   W_CHAR16(8),=C'Unknown(' Move prefix
         LR    R15,R5              Compare length
         $VLM  W_CHAR16+8,(R4),(R15)  Move comparator
         LA    R15,W_CHAR16        Work area address
         LA    R15,8(R15)          Add prefix
         AR    R15,R5              Add comparator length
         MVI   0(R15),C')'         Move suffix
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,W_CHAR16,16),                                 X
               MF=(E,W_WRK)
         B     DAFPC4              Indicate comparator not found
DAFPC    $EXIT                     Exit
         TITLE 'DAFPP - Put Print Record'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - Printer Control Address (R3)           *
*                  . 04(R1) - Printer DCB Address     (R4)           *
*                  . 08(R1) - Record Address          (R5)           *
*  Output:         R15 -  00 - Normal                                *
**********************************************************************
DAFPP    $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,0(R1)            Printer Control Table Address
         L     R4,4(R1)            Printer DCB Address
         L     R5,8(R1)            Record Address
         USING D_PRTCTL,R3         Printer control reference
         CP    D_PRTLNE,=P'55'     End of page ?
         BL    PPNOHEAD            No
         ZAP   D_PRTLNE,=P'0'      Reset line counter
         AP    D_PRTPGE,=P'1'      Increment page counter
         $FILL W_TRACE,C' '        Blank header record
         MVI   W_TRACE,C'1'        ANSI carriage control - new page
         MVC   W_TRACE+009(30),=CL030'Dataset Audit Facility (DAF) -'
         MVC   W_TRACE+039(12),=CL012' Level &GVRM'
         MVC   W_TRACE+051(21),=CL021'    Source=&GSRCDAT'
         MVC   W_TRACE+072(19),=CL019', Object=&GOBJDAT'
         MVC   W_TRACE+091(23),=CL023', &SYSTEM_ID'
         MVC   W_TRACE+110(5),=C'Page: ' Page number literal
         MVC   W_TRACE+125(6),=X'402020202120' Page number mask
         ED    W_TRACE+125(6),D_PRTPGE Edit page number
         PUT   (R4),W_TRACE        Write header record
         PUT   (R4),P_BLANKS       Write blank header record
         L     R15,D_PRTHDR        Get header address
         PUT   (R4),(R15)          Write next logical record
         L     R15,D_PRTHDR        Get header address
         CLC   1(4,R15),=C'Date'   Is this DAFRPT ?
         BNE   PPNOHEAD            Continue
         CP    D_PRTPGE,=P'1'      First page ?
         BE    PPNOHEAD            Continue
         CLC   W_LSTDSN,W_DSN1     Is this a continuation ?
         BNE   PPNOHEAD            No, Continue
         $FILL W_TRACE,C' '        Blank header record
         MVC   W_TRACE+01(L'W_DSN1),W_DSN1 Dataset
         MVC   W_TRACE+45(11),=C'(continued)'
         PUT   (R4),W_TRACE        Write next logical record
         $FILL W_TRACE,C' '        Blank header record
PPNOHEAD EQU   *
         AP    D_PRTLNE,=P'1'      Increment line counter
         PUT   (R4),(R5)           Write detail record
         DROP  R3                  Printer control dereference
DAFPP    $EXIT                     Exit
         TITLE 'DAFPS - Process Control Statements'
DAFPS    $ENTRY AMODE=31,RMODE=24  Entry
         $MSG  W_LOG,DAF520I       Move message template
         MVC   W_LOG+32(26),=CL026'Process Control Statements'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         XC    W_FLAG,W_FLAG       Turn off flags
         XC    W_F$CS,W_F$CS       Turn off control statement flags
         $FILL W_TYPE,C' '         Blank type
         $MSG  W_LOG,DAF502I       Move message template
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
PSGETCS  $FILL W_CS,C' '           Blank DAFCS record
         $FILL W_CSKWD,C' '        Blank control statement keyword
         $FILL W_CSOP,C' '         Blank control statement operator
         $FILL W_CSVAL,C' '        Blank control statement value
         GET   DAFCS,W_CS+9        Read next logical DAFCS record
         CALL  DAFCSP              Control Statement Parse
         LTR   R15,R15             OK ?
         BNZ   PSGETCS             No - Get next control statement
         L     R3,W_KWD@           Keyword table pointer
         USING D_TBLKWD,R3         Keyword table reference
         L     R4,W_OP@            Operator table pointer
         USING D_TBLOP,R4          Operator table reference
         LA    R5,D_KWDVGA         Get value getmain address
         A     R5,D_OPOFF          Adjust operator offset
         L     R15,0(R5)
         LTR   R15,R15             Any operands yet ?
         BNZ   PSNOGM              Yes, skip getmain
         LH    R0,D_KWDVGL         Value getmain length
         STORAGE OBTAIN,LENGTH=(0),BNDRY=PAGE Obtain operand area
         ST    R1,W_STG_ADDR       Storage address
         ST    R15,W_STG_RC        Storage return code
         LTR   R15,R15             OK ?
         BZ    PSGMVLOK            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'OBTAIN/VALUE' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
PSGMVLOK EQU   *
         $MSG  W_LOG,DAF550I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(12),=C'Operand_Area'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   0(4,R5),W_STG_ADDR  Dynamic operand area address
         L     R0,W_STG_ADDR       Receiving field address
         LH    R1,D_KWDVGL         Receiving field length
         XR    R14,R14             Sending field address - none
         XR    R15,R15             Sending field length - none
         ICM   R15,B'1000',=C' '   Pad character
         MVCL  R0,R14              Fill the field
PSNOGM   MVC   W_HALF1,D_KWDKVC    Keyword value count
         $INCR W_HALF1             Increment temporary operand counter
         CLC   W_HALF1,D_KWDOMC    Too many operands ?
         BL    PSMOVCS             No, operand OK
         MVC   W_CS+53(22),=C'<--- Too many keywords'
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         OI    W_F$CS,W_F$KWD      Turn on keyword error flag
         B     PSGETCS             Any more DAFCS records ?
PSMOVCS  LH    R2,D_KWDOML         Maximum operand length
         LA    R2,5(,R2)           Add 5 (2 length, 3 flag)
         LA    R15,D_KWDOVC        Operator value count
         A     R15,D_OPOFF         Adjust with offset
         L     R15,0(R15)
         STH   R15,W_HALF1         Adjust with offset
         MH    R2,W_HALF1          Offset
         LA    R15,D_KWDVGA        Value getmain address
         A     R15,D_OPOFF
         A     R2,0(R15)           Address
         STH   R7,W_HALF1          Save
         MVC   0(1,R2),D_OPLO      Low operand
         MVC   1(1,R2),D_OPEQ      Equal operand
         MVC   2(1,R2),D_OPHI      High operand
         MVC   3(2,R2),W_HALF1     Move operand
         LA    R2,5(,R2)           Point to operand
         L     R1,W_CSVAL@         Control statement value length
         $VLM  (R2),W_CSVAL,(R1)   Move control statement value
         $INCR D_KWDKVC,H          Increment keyword value counter
         LA    R5,D_KWDOVC         Operator value count
         A     R5,D_OPOFF          Adjust with offset
         L     R15,0(R5)
         LA    R15,1(R15)          Increment specific
         ST    R15,0(R5)           Put it back
         MVC   W_CS+63(24),=C'<--- OK                 '
         $PRINT DAFLOG,W_CS        Put DAFLOG record
         TM    W_F$TRAC,W_F$CRI    Criteria Trace ?
         BNO   PSNOTRA1            No
         $MSG  W_LOG,DAF620I       Move message template
         MVC   W_LOG+13(L'W_CSKWD),W_CSKWD Keyword
         MVC   W_LOG+27(L'W_CSOP),W_CSOP Operator
         MVC   W_LOG+37(L'W_CSVAL),W_CSVAL Value
         MVC   W_LOG+88(4),W_CSVAL@ Value
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
PSNOTRA1 EQU   *
         $INCR W_CSTOT             Increment DAFCS counter
         B     PSGETCS             Any more DAFCS records ?
PSEOD    EQU   *
         TM    W_F$CS,W_F$KWD+W_F$OP+W_F$VAL DAFCS error flag on ?
         BZ    PSNECS              No
         TM    W_F$CS,W_F$KWD      Keyword error flag on ?
         BNO   PSNEKWD             No, continue
         $PRINT DAFLOG,P_BLANKS    Put blank DAFLOG record
         $MSG  W_LOG,DAF500I       Move message template
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         L     R3,W_TBLKWD         Set keyword table address
         LA    R15,#_TBLKWD        Keyword table count
         ST    R15,W_KWDTB#        Keyword table count
         $FILL W_LOG,C' '          Blank log record
         MVC   W_LOG+09(07),=C'Keyword' Move keyword literal
         MVC   W_LOG+19(04),=C'Type' Move type literal
         MVC   W_LOG+28(02),=C'ML' Move ML literal
         MVC   W_LOG+32(11),=C'Description' Move description literal
         MVC   W_LOG+59(06),=C'Alias1' Move alias1 literal
         MVC   W_LOG+77(06),=C'Alias2' Move alias2 literal
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         $FILL W_LOG,C' '          Blank log record
         MVC   W_LOG+09(07),=C'=======' Move keyword literal
         MVC   W_LOG+19(04),=C'====' Move type literal
         MVC   W_LOG+28(02),=C'==' Move length literal
         MVC   W_LOG+32(11),=C'===========' Move description literal
         MVC   W_LOG+59(06),=C'======' Move alias1 literal
         MVC   W_LOG+77(06),=C'======' Move alias2 literal
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
PSEKWD   $FILL W_LOG,C' '          Blank log record
         MVC   W_LOG+09(L'D_KWDTXT),D_KWDTXT  Move keyword name
         MVC   W_LOG+19(L'D_KWDTYP),D_KWDTYP  Move keyword type
         LH    R1,D_KWDOML         Load keyword maximum length
         CVD   R1,W_DBL            Convert keyword maximum length
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  W_LOG+28(02),W_DBL+6(2) Unpack keyword maximum length
         MVC   W_LOG+32(L'D_KWDDES),D_KWDDES  Move keyword description
         MVC   W_LOG+59(L'D_KWDAL1),D_KWDAL1  Move keyword alias 1
         MVC   W_LOG+77(L'D_KWDAL2),D_KWDAL2  Move keyword alias 2
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         LA    R3,L_TBLKWD(,R3)    Increment keyword table entry
         L     R1,W_KWDTB#         Keyword table count
         $DECR W_KWDTB#            Keyword table count
         BCT   R1,PSEKWD           Print next keyword table entry
PSNEKWD  TM    W_F$CS,W_F$OP       Operator error flag on ?
         BNO   PSNEOP              No, continue
         $PRINT DAFLOG,P_BLANKS    Put blank DAFLOG record
         $MSG  W_LOG,DAF501I       Move message template
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         L     R4,=A(TBLOP)        Set operator table address
         LA    R5,#_TBLOP          Operator table count
         $FILL W_LOG,C' '          Blank log record
         MVC   W_LOG+09(08),=C'Operator' Move operator literal
         MVC   W_LOG+23(11),=C'Description' Move description literal
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         $FILL W_LOG,C' '          Blank log record
         MVC   W_LOG+09(08),=C'========' Move operator literal
         MVC   W_LOG+23(11),=C'===========' Move description literal
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
PSEOP    $FILL W_LOG,C' '          Blank log record
         MVC   W_LOG+09(L'D_OPTXT),D_OPTXT  Move operator name
         MVC   W_LOG+23(L'D_OPDES),D_OPDES  Move operator description
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         LA    R4,L_TBLOP(,R4)     Increment operator table entry
         BCT   R5,PSEOP            Print next operator table entry
PSNEOP   EQU   *
         $MSG  W_LOG,DAF712S       Move message template
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_RC,=F'12'         Return Code 12
PSNECS   EQU   *
         CLC   W_CSTOT,=F'0'       Any DAFCS specified ?
         BNE   PSEXIT              . Yes, done
         $MSG  W_LOG,DAF503I       Move message template
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
PSEXIT   EQU   *
         $MSG  W_LOG,DAF521I       Move message template
         MVC   W_LOG+32(26),=CL026'Process Control Statements'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
DAFPS    $EXIT                     Exit
         DROP  R3                  Keyword table dereference
         DROP  R4                  Operator table dereference
         TITLE 'DAFPT - Process TM Table'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - TM Table Address   (R2)                *
*                  . 04(R1) - Comparator Address (R3)                *
*  Notes:          Move compare table label to W_TXTLBL ending in =  *
*                  Test all eight bits                               *
*                  If on and text ne Reserved, Mov_cmt(label=text)   *
**********************************************************************
DAFPT    $ENTRY AMODE=31,RMODE=24  Entry
         L     R2,0(R1)            TM Table address
         L     R3,4(R1)            Compare address
         MVC   W_TM,0(R3)          Compare value
         $FILL W_TXTLBL,C' '       Blank label
         $FILL W_DAFPT1,C' '       Blank work 1
         $FILL W_DAFPT2,C' '       Blank work 2
         $FILL W_DAFPT3,C' '       Blank work 3
         $FILL W_DAFPT4,C' '       Blank work 4
         LA    R4,W_TXTLBL         Output label address
PTLNXT   MVC   0(1,R4),0(R2)       Move one label byte
         CLC   0(1,R2),=C'='       Trailing label equal sign ?
         BE    PTLEXIT             Yes, Done
         LA    R2,1(,R2)           Next input label address
         LA    R4,1(,R4)           Next output label address
         B     PTLNXT              Get next input label byte
PTLEXIT  LA    R2,1(,R2)           First entry
         TM    W_TM,W_F$BIT0       Is bit 0 on ?
         BNO   PTBIT1              No
         CLC   0(8,R2),=C'Reserved' Reserved ?
         BE    PTBIT1              Yes, Skip it
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R2),32),                                     X
               MF=(E,W_WRK)
         CLI   W_DAFPT1,C' '       Blank ?
         BE    PTB0M1              Yes - use it
         CLI   W_DAFPT2,C' '       Blank ?
         BE    PTB0M2              Yes - use it
         CLI   W_DAFPT3,C' '       Blank ?
         BE    PTB0M3              Yes - use it
         CLI   W_DAFPT4,C' '       Blank ?
         BE    PTB0M4              Yes - use it
PTB0M1   MVC   W_DAFPT1,0(R2)      Move text
         B     PTB0EXIT            Next bit
PTB0M2   MVC   W_DAFPT2,0(R2)      Move text
         B     PTB0EXIT            Next bit
PTB0M3   MVC   W_DAFPT3,0(R2)      Move text
         B     PTB0EXIT            Next bit
PTB0M4   MVC   W_DAFPT4,0(R2)      Move text
         B     PTB0EXIT            Next bit
PTB0EXIT EQU   *                   Next bit
PTBIT1   LA    R2,32(,R2)          Next TM table entry
         TM    W_TM,W_F$BIT1       Is bit 1 on ?
         BNO   PTBIT2              No
         CLC   0(8,R2),=C'Reserved' Reserved ?
         BE    PTBIT2              Yes, Skip it
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R2),32),                                     X
               MF=(E,W_WRK)
         CLI   W_DAFPT1,C' '       Blank ?
         BE    PTB1M1              Yes - use it
         CLI   W_DAFPT2,C' '       Blank ?
         BE    PTB1M2              Yes - use it
         CLI   W_DAFPT3,C' '       Blank ?
         BE    PTB1M3              Yes - use it
         CLI   W_DAFPT4,C' '       Blank ?
         BE    PTB1M4              Yes - use it
PTB1M1   MVC   W_DAFPT1,0(R2)      Move text
         B     PTB1EXIT            Next bit
PTB1M2   MVC   W_DAFPT2,0(R2)      Move text
         B     PTB1EXIT            Next bit
PTB1M3   MVC   W_DAFPT3,0(R2)      Move text
         B     PTB1EXIT            Next bit
PTB1M4   MVC   W_DAFPT4,0(R2)      Move text
         B     PTB1EXIT            Next bit
PTB1EXIT EQU   *                   Next bit
PTBIT2   LA    R2,32(,R2)          Next TM table entry
         TM    W_TM,W_F$BIT2       Is bit 2 on ?
         BNO   PTBIT3              No
         CLC   0(8,R2),=C'Reserved' Reserved ?
         BE    PTBIT3              Yes, Skip it
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R2),32),                                     X
               MF=(E,W_WRK)
         CLI   W_DAFPT1,C' '       Blank ?
         BE    PTB2M1              Yes - use it
         CLI   W_DAFPT2,C' '       Blank ?
         BE    PTB2M2              Yes - use it
         CLI   W_DAFPT3,C' '       Blank ?
         BE    PTB2M3              Yes - use it
         CLI   W_DAFPT4,C' '       Blank ?
         BE    PTB2M4              Yes - use it
PTB2M1   MVC   W_DAFPT1,0(R2)      Move text
         B     PTB2EXIT            Next bit
PTB2M2   MVC   W_DAFPT2,0(R2)      Move text
         B     PTB2EXIT            Next bit
PTB2M3   MVC   W_DAFPT3,0(R2)      Move text
         B     PTB2EXIT            Next bit
PTB2M4   MVC   W_DAFPT4,0(R2)      Move text
         B     PTB2EXIT            Next bit
PTB2EXIT EQU   *                   Next bit
PTBIT3   LA    R2,32(,R2)          Next TM table entry
         TM    W_TM,W_F$BIT3       Is bit 3 on ?
         BNO   PTBIT4              No
         CLC   0(8,R2),=C'Reserved' Reserved ?
         BE    PTBIT4              Yes, Skip it
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R2),32),                                     X
               MF=(E,W_WRK)
         CLI   W_DAFPT1,C' '       Blank ?
         BE    PTB3M1              Yes - use it
         CLI   W_DAFPT2,C' '       Blank ?
         BE    PTB3M2              Yes - use it
         CLI   W_DAFPT3,C' '       Blank ?
         BE    PTB3M3              Yes - use it
         CLI   W_DAFPT4,C' '       Blank ?
         BE    PTB3M4              Yes - use it
PTB3M1   MVC   W_DAFPT1,0(R2)      Move text
         B     PTB3EXIT            Next bit
PTB3M2   MVC   W_DAFPT2,0(R2)      Move text
         B     PTB3EXIT            Next bit
PTB3M3   MVC   W_DAFPT3,0(R2)      Move text
         B     PTB3EXIT            Next bit
PTB3M4   MVC   W_DAFPT4,0(R2)      Move text
         B     PTB3EXIT            Next bit
PTB3EXIT EQU   *                   Next bit
PTBIT4   LA    R2,32(,R2)          Next TM table entry
         TM    W_TM,W_F$BIT4       Is bit 4 on ?
         BNO   PTBIT5              No
         CLC   0(8,R2),=C'Reserved' Reserved ?
         BE    PTBIT5              Yes, Skip it
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R2),32),                                     X
               MF=(E,W_WRK)
         CLI   W_DAFPT1,C' '       Blank ?
         BE    PTB4M1              Yes - use it
         CLI   W_DAFPT2,C' '       Blank ?
         BE    PTB4M2              Yes - use it
         CLI   W_DAFPT3,C' '       Blank ?
         BE    PTB4M3              Yes - use it
         CLI   W_DAFPT4,C' '       Blank ?
         BE    PTB4M4              Yes - use it
PTB4M1   MVC   W_DAFPT1,0(R2)      Move text
         B     PTB4EXIT            Next bit
PTB4M2   MVC   W_DAFPT2,0(R2)      Move text
         B     PTB4EXIT            Next bit
PTB4M3   MVC   W_DAFPT3,0(R2)      Move text
         B     PTB4EXIT            Next bit
PTB4M4   MVC   W_DAFPT4,0(R2)      Move text
         B     PTB4EXIT            Next bit
PTB4EXIT EQU   *                   Next bit
PTBIT5   LA    R2,32(,R2)          Next TM table entry
         TM    W_TM,W_F$BIT5       Is bit 5 on ?
         BNO   PTBIT6              No
         CLC   0(8,R2),=C'Reserved' Reserved ?
         BE    PTBIT6              Yes, Skip it
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R2),32),                                     X
               MF=(E,W_WRK)
         CLI   W_DAFPT1,C' '       Blank ?
         BE    PTB5M1              Yes - use it
         CLI   W_DAFPT2,C' '       Blank ?
         BE    PTB5M2              Yes - use it
         CLI   W_DAFPT3,C' '       Blank ?
         BE    PTB5M3              Yes - use it
         CLI   W_DAFPT4,C' '       Blank ?
         BE    PTB5M4              Yes - use it
PTB5M1   MVC   W_DAFPT1,0(R2)      Move text
         B     PTB5EXIT            Next bit
PTB5M2   MVC   W_DAFPT2,0(R2)      Move text
         B     PTB5EXIT            Next bit
PTB5M3   MVC   W_DAFPT3,0(R2)      Move text
         B     PTB5EXIT            Next bit
PTB5M4   MVC   W_DAFPT4,0(R2)      Move text
         B     PTB5EXIT            Next bit
PTB5EXIT EQU   *                   Next bit
PTBIT6   LA    R2,32(,R2)          Next TM table entry
         TM    W_TM,W_F$BIT6       Is bit 6 on ?
         BNO   PTBIT7              No
         CLC   0(8,R2),=C'Reserved' Reserved ?
         BE    PTBIT7              Yes, Skip it
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R2),32),                                     X
               MF=(E,W_WRK)
         CLI   W_DAFPT1,C' '       Blank ?
         BE    PTB6M1              Yes - use it
         CLI   W_DAFPT2,C' '       Blank ?
         BE    PTB6M2              Yes - use it
         CLI   W_DAFPT3,C' '       Blank ?
         BE    PTB6M3              Yes - use it
         CLI   W_DAFPT4,C' '       Blank ?
         BE    PTB6M4              Yes - use it
PTB6M1   MVC   W_DAFPT1,0(R2)      Move text
         B     PTB6EXIT            Next bit
PTB6M2   MVC   W_DAFPT2,0(R2)      Move text
         B     PTB6EXIT            Next bit
PTB6M3   MVC   W_DAFPT3,0(R2)      Move text
         B     PTB6EXIT            Next bit
PTB6M4   MVC   W_DAFPT4,0(R2)      Move text
         B     PTB6EXIT            Next bit
PTB6EXIT EQU   *                   Next bit
PTBIT7   LA    R2,32(,R2)          Next TM table entry
         TM    W_TM,W_F$BIT7       Is bit 7 on ?
         BNO   DAFPT0              No
         CLC   0(8,R2),=C'Reserved' Reserved ?
         BE    DAFPT0              Yes, Skip it
         CALL  DAFMC,              Move Comment                        X
               (W_TXTLBL,(R2),32),                                     X
               MF=(E,W_WRK)
         CLI   W_DAFPT1,C' '       Blank ?
         BE    PTB7M1              Yes - use it
         CLI   W_DAFPT2,C' '       Blank ?
         BE    PTB7M2              Yes - use it
         CLI   W_DAFPT3,C' '       Blank ?
         BE    PTB7M3              Yes - use it
         CLI   W_DAFPT4,C' '       Blank ?
         BE    PTB7M4              Yes - use it
PTB7M1   MVC   W_DAFPT1,0(R2)      Move text
         B     PTB7EXIT            Next bit
PTB7M2   MVC   W_DAFPT2,0(R2)      Move text
         B     PTB7EXIT            Next bit
PTB7M3   MVC   W_DAFPT3,0(R2)      Move text
         B     PTB7EXIT            Next bit
PTB7M4   MVC   W_DAFPT4,0(R2)      Move text
         B     PTB7EXIT            Next bit
PTB7EXIT EQU   *                   Next bit
DAFPT    $EXIT                     Exit
         TITLE 'DAFPV - Process Volumes'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - Volume serial count address (R2)       *
*                  . 04(R1) - Volume serial count length  (R3)       *
*                  . 08(R1) - Volume serial address       (R4)       *
*                  . 12(R1) - Volume serial offset        (R5)       *
*                  . 16(R1) - Volume serial length        (R6)       *
*  Notes:          Handles up to ten volume serials                  *
**********************************************************************
DAFPV    $ENTRY AMODE=31,RMODE=24  Entry
         L     R2,00(R1)           Volume serial count address
         LTR   R2,R2               Volume serial count address zero ?
         BNP   DAFPV0              Yes, get out
         L     R3,04(R1)           Volume serial count length
         LTR   R3,R3               Volume serial count length zero ?
         BNP   DAFPV0              Yes, get out
         L     R4,08(R1)           Volume serial address
         LTR   R4,R4               Volume serial address zero ?
         BNP   DAFPV0              Yes, get out
         L     R5,12(R1)           Volume serial offset
         L     R6,16(R1)           Volume serial length
         XC    W_DAFPV4,W_DAFPV4   Zero temp fullword
         LA    R7,W_DAFPV4         Temp fullword address
         AH    R7,=H'4'            Point to end of temp fullword
         SR    R7,R3               Adjust for count length
         $VLM  (R7),(R2),(R3)      Move volume serial count
         L     R3,W_DAFPV4         Store volume serial count
         LTR   R3,R3               Volume serial count zero ?
         BNP   DAFPV0              Yes, Done
         LA    R8,W_VOL1           Volume serial criteria address
         AR    R4,R5               Apply volume serial offset
         XR    R9,R9               Zero unique volume serials
PVNEXT   EQU   *
         LA    R15,10              Original volume serial count
         LA    R1,W_VOL1           Volume serial criteria address
DAFPVCHK EQU   *
         CLC   0(6,R4),0(R1)       Duplicate volume serial ?
         BE    DAFPVINC            Yes, skip it
         LA    R1,6(,R1)           Increment Volume serial criteria add
         BCT   R15,DAFPVCHK         Any more ?
         CLC   0(6,R4),=CL006' '   Blank volume serial ?
         BE    DAFPV0              Yes, get out
         C     R9,=F'10'           More than 10 unique volume serials ?
         BNH   DAFPVCOK            No, continue
         $MSG  W_LOG,DAF540I       Move message template
         MVC   W_LOG+23(L'W_RECORD),W_RECORD Record Type
         MVC   W_LOG+27(L'W_DATE),W_DATE Record Date
         MVC   W_LOG+35(L'W_TIME),W_TIME Record Time
         MVC   W_LOG+51(L'W_DSN1),W_DSN1 Dataset
         $HEX  W_LOG+19,W_DAFPV4,LEN=3 Volume serial count
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         B     DAFPV0              Get out
DAFPVCOK EQU   *
         LA    R9,1(,R9)           Increment unique volume serials
         CALL  DAFMC,              Move Comment                        X
               (=C'VOL=',(R4),6), Volume serial                        X
               MF=(E,W_WRK)
         MVC   0(6,R8),0(R4)       Move volume serial criteria
         LA    R8,6(R8)            Next volume serial criteria address
DAFPVINC EQU   *
         AR    R4,R6               Next entry
         BCT   R3,PVNEXT           Any more ?
DAFPV    $EXIT                     Exit
         TITLE 'DAFRECFM - Convert RECFM bitmask to RECFM character'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - RECFM bitmask address   (R3)           *
*                  . 04(R1) - RECFM character address (R4)           *
**********************************************************************
DAFRECFM $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,0(R1)            RECFM bitmask address
         L     R4,4(R1)            RECFM character address
         MVC   0(5,R4),=CL005' '   Blank RECFM character
DAFRECFMU EQU  *
         TM    0(R3),DS1RECFU      Undefined ?
         BNO   DAFRECFMF           . No, check fixed
         MVC   0(1,R4),=CL001'U'   . Yes
         LA    R4,1(R4)            Next character
         B     DAFRECFMB           Check blocked
DAFRECFMF EQU  *
         TM    0(R3),DS1RECFF      Fixed ?
         BNO   DAFRECFMV           . No, check variable
         MVC   0(1,R4),=CL001'F'   . Yes
         LA    R4,1(R4)            Next character
         B     DAFRECFMB           Check blocked
DAFRECFMV EQU  *
         TM    0(R3),DS1RECFV      Variable ?
         BNO   DAFRECFMB           . No, check blocked
         MVC   0(1,R4),=CL001'V'   . Yes
         LA    R4,1(R4)            Next character
         B     DAFRECFMB           Check blocked
DAFRECFMB EQU  *
         TM    0(R3),DS1RECFB      Blocked ?
         BNO   DAFRECFMS           . No, check spanned
         MVC   0(1,R4),=CL001'B'   . Yes
         LA    R4,1(R4)            Next character
         B     DAFRECFMS           Check spanned
DAFRECFMS EQU  *
         TM    0(R3),DS1RECFS      Spanned ?
         BNO   DAFRECFMT           . No, check track overflow
         MVC   0(1,R4),=CL001'S'   . Yes
         LA    R4,1(R4)            Next character
         B     DAFRECFMT           Check track overflow
DAFRECFMT EQU  *
         TM    0(R3),DS1RECFT      Track overflow ?
         BNO   DAFRECFMA           . No, check ANSI control
         MVC   0(1,R4),=CL001'T'   . Yes
         LA    R4,1(R4)            Next character
         B     DAFRECFMA           Check ANSI control
DAFRECFMA EQU  *
         TM    0(R3),DS1RECFA      ANSI control ?
         BNO   DAFRECFMM           . No, check machine control
         MVC   0(1,R4),=CL001'A'   . Yes
         LA    R4,1(R4)            Next character
         B     DAFRECFMM           Check machine control
DAFRECFMM EQU  *
         TM    0(R3),DS1RECMC      Machine control ?
         BNO   DAFRECFMX           . No, exit
         MVC   0(1,R4),=CL001'M'   . Yes
         B     DAFRECFMX           Exit
DAFRECFM $EXIT                     Exit
         TITLE 'DAFRM - Reslove Mask'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - OP address (R3)                        *
*                  . 04(R1) - CS address (R4)                        *
*                  . 08(R1) - Length  (R5)                           *
*  Notes:          If input field leading null - exit.               *
**********************************************************************
DAFRM    $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,0(R1)            Original value 1 address
         L     R4,4(R1)            Original value 2 address
         L     R5,8(R1)            Maximum length
         LH    R5,0(R5)            Maximum length
         $FILL W_VAL1O,C' '        Blank original value 1
         $FILL W_VAL2O,C' '        Blank original value 2
         $VLM  W_VAL1O,(R3),(R5)   Save original value 1
         $VLM  W_VAL2O,(R4),(R5)   Save original value 2
         $FILL W_VAL1R,C' '        Blank resolved value 1
         $FILL W_VAL2R,C' '        Blank resolved value 2
         LA    R3,W_VAL1O          Original value 1 address
         LA    R4,W_VAL2O          Original value 2 address
         LA    R6,W_VAL1R          Resolved value 1 address
         LA    R7,W_VAL2R          Resolved value 2 address
         XR    R8,R8               Zero resolved length
RMNEXT   CLI   0(R3),C' '          End ?
         BE    RMCOPY              Yes, get out
         CLI   0(R3),C'?'          Single character wildcard ?
         BE    RMINCR              Yes, skip it
         CLC   0(2,R3),=C'* '      Multiple character wildcard ending ?
         BE    RMDONE              Yes, get out
         CLI   0(R3),C'*'          Multiple character wildcard ?
         BNE   RMCOPY              No, copy it
         LA    R3,1(,R3)           Increment original value 1 address
         BCTR  R5,0                Decrement maximum length
RMNEXT2  LA    R4,1(,R4)           Increment original value 2 address
         CLC   0(1,R3),0(R4)       End of multiple character wildcard ?
         BE    RMCOPY              Yes, copy it
         BCT   R5,RMNEXT2          Loop until end of original value 2
         XR    R8,R8               Zero resolved length
         $FILL W_VAL2R,C' '        Blank resolved value 2
         B     RMDONE              Get out
RMCOPY   MVC   0(1,R6),0(R3)       Copy original to resolved value 1
         MVC   0(1,R7),0(R4)       Copy original to resolved value 2
         LA    R6,1(,R6)           Increment resolved value 1 address
         LA    R7,1(,R7)           Increment resolved value 2 address
         LA    R8,1(,R8)           Increment resolved length
RMINCR   LA    R3,1(,R3)           Increment original value 1 address
         LA    R4,1(,R4)           Increment original value 2 address
         BCT   R5,RMNEXT           Loop until end of original value 1
RMDONE   TM    W_F$TRAC,W_F$CRI    Criteria Trace ?
         BNO   RMNOCTRA            No, do not trace
         $MSG  W_TRACE,DAF621I     Move message template
         MVC   W_TRACE+18(44),W_VAL1O Original value 1
         MVC   W_TRACE+65(44),W_VAL2O Original value 2
         PUT   DAFTRACE,W_TRACE    Print a DAFTRACE record
         $MSG  W_TRACE,DAF622I     Move message template
         MVC   W_TRACE+18(44),W_VAL1R Resolved value 1
         MVC   W_TRACE+65(44),W_VAL2R Resolved value 2
         PUT   DAFTRACE,W_TRACE    Print a DAFTRACE record
RMNOCTRA LR    R15,R8              Return code
         B     DAFRMR              Return code
DAFRM    $EXIT                     Exit
         TITLE 'DAFSS - Sort Extracted SMF Records'
DAFSS    $ENTRY AMODE=31,RMODE=24  Entry
         $MSG  W_LOG,DAF520I       Move message template
         MVC   W_LOG+32(26),=CL026'Sort Extracted SMF Records'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_LINK(L_LINK),T_LINK Copy LINK parameter list
         LINK  EP=SORT,MF=(E,P_ICEEPL),SF=(E,W_LINK) LINK to sort
         LTR   R15,R15             Sort OK ?
         BZ    SSEXIT              Yes, continue
         $MSG  W_LOG,DAF716T       Move message template
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         MVC   W_RC,=F'16'         Return code 16
         B     SSEXIT              Continue
SSEXIT   EQU   *
         $MSG  W_LOG,DAF521I       Move message template
         MVC   W_LOG+32(26),=CL026'Sort Extracted SMF Records'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
DAFSS    $EXIT                     Exit
         TITLE 'DAFSWA - Static Workarea'
DAFSWA   CSECT                     Workarea static
T_DAF801 DC    CL100'DAF801A System Macro Problem - R15=________ '
T_DAF900 DC    CL100'DAF900A Abend Sxxx Uxxxx Module=________ +'
T_DAF901 DC    CL100'DAF901A Abend SDWA not present'
P_TBLHEX DC    C'0123456789ABCDEF'
P_BLANKS DC    CL133' '
P_RCTMSK DS    0CL20               Record count mask
         DC    X'40202020'
         DC    X'6B202020'
         DC    X'6B202020'
         DC    X'6B202020'
         DC    X'6B202120'
P_EDTMSK DC    XL16'404020206B2020206B2020206B202120'
P_RTYMSK DC    XL4'40202021'
P_BINMSK DC    XL16'40202020202020202020202020202120'
P_VLC    CLC   0(*-*,R14),0(R15)   Variable Length Compare (Executed)
P_VLM    MVC   0(*-*,R14),0(R15)   Variable Length Move (Executed)
P_VLTRT  TRT   0(*-*,R14),0(R15)   Variable Length TRT (Executed)
P_OTH    DC    CL058'Other'
P_TOT    DC    CL058'Total'
P_LOG    DS    0CL133              DAFLOG header record
         DC    CL133' DAF Log: '
P_RPT    DS    0CL133              DAFRPT header record
         DC    CL47' Date    Time        SID  Job      User     RTY'
         DC    CL044' '
         DC    CL42' '
P_STAT   DS    0CL133              DAFSTAT header record
         DC    C'          DAFSMF          DAFRPT         Invalid'
         DC    C'    SMF Record Types'
         ORG   P_STAT+133          DAFSTAT header record
*
**       SORT Extended Parameter List
*
         CNOP  0,4                 Fullword alignment
P_ICEEPL DC    A(P_ICECSA)         Address of control statement area
         DC    A(0)                Address of user exit E15 or E32
         DC    A(0)                Address of user exit E35
         DC    A(0)                Address of user exit constant
         DC    A(0)                Address of ALTSEQ translation table
         DC    A(0)                Address of ESTAE area pointer
         DC    A(0)                Address of user exit E18
         DC    A(0)                Address of user exit E39
         DC    A(0)                Four character call identifier
         DC    F'-1'               End of parameter list
P_ICECSA EQU   *                   Control statement area
         DC    AL2(P_ICECSE-P_ICECSB) Control statement length
P_ICECSB EQU   *
         DC    C'OPTION MSGDDN=DAFLOG '
         DC    C'DEBUG NOABEND '
         DC    C'SORT FIELDS=(1,80,CH,A) '
         DC    C'RECORD LENGTH=515,TYPE=F '
P_ICECSE EQU   *
*
**       System Macro Templates
*
T_CLOSE  CLOSE (),MF=L             CLOSE parameter list
L_CLOSE  EQU   *-T_CLOSE           CLOSE parameter list length
T_DAFCS  DCB   DDNAME=DAFCS,       DAFCS DCB                           X
               BLKSIZE=0,                                              X
               BUFNO=10,                                               X
               DSORG=PS,                                               X
               EODAD=PSEOD,                                            X
               LRECL=80,                                               X
               MACRF=(GM)
L_DAFCS  EQU   *-T_DAFCS           DAFCS DCB Length
T_DAFLOG DCB   DDNAME=DAFLOG,      DAFLOG DCB                          X
               BLKSIZE=0,                                              X
               BUFNO=10,                                               X
               DSORG=PS,                                               X
               LRECL=133,                                              X
               MACRF=(PM),                                             X
               RECFM=FBA
L_DAFLOG EQU   *-T_DAFLOG          DAFLOG DCB length
T_DAFOUT DCB   DDNAME=DAFOUT,      DAFOUT DCB                          X
               BLKSIZE=0,                                              X
               BUFNO=25,                                               X
               DSORG=PS,                                               X
               LRECL=515,                                              X
               MACRF=(PM),                                             X
               RECFM=FB
L_DAFOUT EQU   *-T_DAFOUT          DAFOUT DCB length
T_DAFRPT DCB   DDNAME=DAFRPT,      DAFRPT DCB                          X
               BLKSIZE=0,                                              X
               BUFNO=25,                                               X
               DSORG=PS,                                               X
               LRECL=133,                                              X
               MACRF=(PM),                                             X
               RECFM=FBA
L_DAFRPT EQU   *-T_DAFRPT          DAFRPT DCB length
T_DAFSMF DCB   DDNAME=DAFSMF,      DAFSMF DCB                          X
               BFTEK=A,                                                X
               BLKSIZE=0,                                              X
               BUFNO=50,                                               X
               DSORG=PS,                                               X
               EODAD=ESEOD,                                            X
               EROPT=SKP,                                              X
               MACRF=(GL)
L_DAFSMF EQU   *-T_DAFSMF          DAFSMF DCB Length
T_DAFSNAP DCB  DDNAME=DAFSNAP,     DAFSNAP DCB                         X
               BLKSIZE=1632,                                           X
               BUFNO=10,                                               X
               DSORG=PS,                                               X
               LRECL=125,                                              X
               MACRF=(W),                                              X
               RECFM=VBA
L_DAFSNAP EQU  *-T_DAFSNAP         DAFSNAP DCB length
T_DAFSTAT DCB  DDNAME=DAFSTAT,     DAFSTAT DCB                         X
               BLKSIZE=0,                                              X
               BUFNO=10,                                               X
               DSORG=PS,                                               X
               LRECL=133,                                              X
               MACRF=(PM),                                             X
               RECFM=FBA
L_DAFSTAT EQU  *-T_DAFSTAT         DAFSTAT DCB length
T_DAFTRACE DCB DDNAME=DAFTRACE,    DAFTRACE DCB                        X
               BLKSIZE=0,                                              X
               BUFNO=10,                                               X
               DSORG=PS,                                               X
               LRECL=133,                                              X
               MACRF=(PM),                                             X
               RECFM=FBA
L_DAFTRACE EQU *-T_DAFTRACE        DAFTRACE DCB length
T_ESTAE  ESTAE 0,MF=L              ESTAE parameter list
L_ESTAE  EQU   *-T_ESTAE           ESTAE parameter list length
T_LINK   LINK  ,SF=L               LINK parameter list
L_LINK   EQU   *-T_LINK            LINK parameter list length
T_OPENI  OPEN  (,INPUT),MF=L       OPEN parameter list (Input)
L_OPENI  EQU   *-T_OPENI           OPEN parameter list length (Input)
T_OPENO  OPEN  (,OUTPUT),MF=L      OPEN parameter list (Output)
L_OPENO  EQU   *-T_OPENO           OPEN parameter list length (Output)
T_RDJFCB RDJFCB (,INPUT),MF=L      RDJFCB parameter list
L_RDJFCB EQU   *-T_RDJFCB          RDJFCB parameter list length
T_SNAP   SNAP  DCB=*-*,            SNAP parameter list                 X
               STORAGE=(*-*,*-*),                                      X
               MF=L
L_SNAP   EQU   *-T_SNAP            SNAP parameter list length
P_SORTIN DCB   DDNAME=SORTIN,      SORTIN DCB                          X
               BLKSIZE=0,                                              X
               BUFNO=25,                                               X
               DSORG=PS,                                               X
               LRECL=515,                                              X
               MACRF=(PM),                                             X
               RECFM=FB
L_SORTIN EQU   *-P_SORTIN          SORTIN DCB Length
P_SORTOU DCB   DDNAME=SORTOUT,     SORTOUT DCB                         X
               BLKSIZE=0,                                              X
               BUFNO=25,                                               X
               DSORG=PS,                                               X
               EODAD=GREOD,                                            X
               LRECL=515,                                              X
               MACRF=(GM),                                             X
               RECFM=FB
L_SORTOU EQU   *-P_SORTOU          SORTOUT DCB Length
T_SWAREQ SWAREQ EPA=*-*,           SWAREQ parameter list               X
               FCODE=RL,                                               X
               MF=L
L_SWAREQ EQU   *-T_SWAREQ          SWAREQ parameter list length
T_WTO    WTO   '1234567890123456789012345678901234567890123456789012345X
               678901234567890123456789012345678901234567890',         X
               DESC=6,             Job status                          X
               ROUTCDE=11,         Programmer Information              X
               MF=L
L_WTO    EQU   *-T_WTO             WTO parameter list length
         TITLE 'DAFTERM - Termination'
DAFTERM  $ENTRY AMODE=31,RMODE=24  Entry
         $MSG  W_LOG,DAF520I       Move message template
         MVC   W_LOG+32(11),=CL011'Termination'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Release Value Area
*
         L     R3,W_TBLKWD         Set keyword table base
         USING D_TBLKWD,R3         Keyword table reference
         LA    R4,#_TBLKWD         Keyword table count
DTNXTKW  LH    R6,D_KWDVGL         Value getmain length
         LA    R7,#_TBLOP          Operator table count
         LA    R8,D_KWDVGA         Operand address
DTNXTOP  L     R5,0(R8)
         LTR   R5,R5               Any ?
         BZ    DTINCOP             No
         STORAGE RELEASE,ADDR=(5),LENGTH=(6) Release value area
         LTR   R15,R15             OK ?
         BZ    RLVALOK             Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'RELEASE/VALUE' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
RLVALOK  EQU   *
DTINCOP  LA    R8,4(,R8)           Next value getmain address
         BCT   R7,DTNXTOP          Another operator ?
DTNOFRE  LA    R3,L_TBLKWD(,R3)    Next keyword table entry
         BCT   R4,DTNXTKW          Another keyword ?
         DROP  R3                  keyword table dereference
*
**       Release Keyword Table
*
         L     R0,=F'8192'         Keyword table length
         ST    R0,W_STG_LENGTH     Keyword table length
         L     R5,W_TBLKWD         Keyword table address
         ST    R5,W_STG_ADDR       Keyword table address
         STORAGE RELEASE,ADDR=(5),LENGTH=(0) Release dynamic keyword
         LTR   R15,R15             OK ?
         BZ    RLKWDOK             Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'RELEASE/TBLKWD' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
RLKWDOK  EQU   *
         $MSG  W_LOG,DAF551I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(13),=CL013'Keyword_Table'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Release SMF Table
*
         LA    R0,@_TBLSMF         SMF table length
         ST    R0,W_STG_LENGTH     SMF table length
         L     R5,W_TBLSMF         SMF table address
         ST    R5,W_STG_ADDR       SMF table address
         STORAGE RELEASE,ADDR=(5),LENGTH=(0) Release dynamic SMF table
         ST    R15,W_STG_RC        Storage return code
         LTR   R15,R15             OK ?
         BZ    RLSMFOK             Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'RELEASE/TBLSMF' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
RLSMFOK  EQU   *
         $MSG  W_LOG,DAF551I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(09),=CL009'SMF_Table'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Release SMF SNAP Storage
*
         L     R0,=F'32768'        SMF SNAP storage length
         ST    R0,W_STG_LENGTH     SMF SNAP storage length
         L     R5,W_SMFSNAP        SMF SNAP storage address
         ST    R5,W_STG_ADDR       SMF SNAP storage address
         STORAGE RELEASE,ADDR=(5),LENGTH=(0) Release SMF SNAP storage
         LTR   R15,R15             OK ?
         BZ    RLSNAPOK            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(15),=CL015'RELEASE/SMFSNAP' Macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
RLSNAPOK EQU   *
         $MSG  W_LOG,DAF551I       Move message template
         $HEX  W_LOG+29,W_STG_RC,LEN=2 Return code
         $HEX  W_LOG+40,W_STG_ADDR,LEN=8 Storage address
         $HEX  W_LOG+56,W_STG_LENGTH,LEN=8 Storage length
         MVC   W_LOG+65(13),=CL013'SMF_SNAP'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Close DAFCS
*
         TM    DAFCS+48,X'10'      DAFCS open ?
         BZ    TERMCSNO            . No
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE DAFCS,MF=(E,W_CLOSE) Close DAFCS
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFCS' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
TERMCSNO EQU *
*
**       Close DAFOUT
*
         TM    DAFOUT+48,X'10'      DAFOUT open ?
         BZ    TERMOUNO            . No
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE DAFOUT,MF=(E,W_CLOSE) Close DAFOUT
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFOUT' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
TERMOUNO EQU *
*
**       Close DAFRPT
*
         TM    DAFRPT+48,X'10'      DAFRPT open ?
         BZ    TERMRPNO            . No
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE DAFRPT,MF=(E,W_CLOSE) Close DAFRPT
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFRPT' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
TERMRPNO EQU *
*
**       Close DAFSNAP
*
         TM    DAFSNAP+48,X'10'     DAFSNAP open ?
         BZ    TERMSNNO            . No
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE DAFSNAP,MF=(E,W_CLOSE) Close DAFSNAP
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFSNAP' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
TERMSNNO EQU *
*
**       Close DAFSTAT
*
         TM    DAFSTAT+48,X'10'     DAFSTAT open ?
         BZ    TERMSTNO            . No
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE DAFSTAT,MF=(E,W_CLOSE) Close DAFSTAT
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFSTAT' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
TERMSTNO EQU *
*
**       Close DAFTRACE
*
         TM    DAFTRACE+48,X'10'   DAFTRACE open ?
         BZ    TERMTRNO            . No
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE DAFTRACE,MF=(E,W_CLOSE) Close DAFTRACE
         ST    R15,W_CLOSE_RC      Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFTRACE' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
TERMTRNO EQU *
*
**       Cancel ESTAE
*
         MVC   W_ESTAE(L_ESTAE),T_ESTAE Copy ESTAE parameter list
         ESTAE 0,MF=(E,W_ESTAE)    Cancel ESTAE
         LTR   R15,R15             OK ?
         BZ    ESTAEOK3            Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(12),=CL012'ESTAE/CANCEL' System macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
ESTAEOK3 EQU   *
         MVC   W_CLOSE_RC,=F'0'    Save the return code from CLOSE
         $MSG  W_LOG,DAF553I       Move message template
         MVC   W_LOG+17(8),=CL008'DAFLOG' Move DDNAME into message
         $HEX  W_LOG+29,W_CLOSE_RC,LEN=2 Return code
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         $MSG  W_LOG,DAF521I       Move message template
         MVC   W_LOG+32(11),=CL011'Termination'
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
*
**       Close DAFLOG
*
         MVC   W_CLOSE(L_CLOSE),T_CLOSE Copy CLOSE parameter list
         CLOSE DAFLOG,MF=(E,W_CLOSE) Close DAFLOG
DAFTERM  $EXIT                     Exit
         TITLE 'DAF002 - Dump Header'
DAF002   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMFRCD2,R3          SMF record reference
         $MSG  W_LOG,DAF510I       Move message template
         MVC   W_LOG+33(04),SMF2SID SMF system id
         CALL  DAFCD,              Convert Date                        X
               (SMF2DTE,W_LOG+43), Date                                X
               MF=(E,W_WRK)
         CALL  DAFCT,              Convert Time                        X
               (SMF2TME,W_TIME),   Input/Output Times                  X
               MF=(E,W_WRK)
         MVC   W_LOG+56(11),W_TIME Time
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         B     DAF0024             Do not process
         DROP  R3                  SMF record dereference
DAF002   $EXIT                     Exit
         TITLE 'DAF003 - Dump Trailer'
DAF003   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMFRCD3,R3          SMF record reference
         $MSG  W_LOG,DAF511I       Move message template
         MVC   W_LOG+33(04),SMF3SID SMF system id
         CALL  DAFCD,              Convert Date                        X
               (SMF3DTE,W_LOG+43), Date                                X
               MF=(E,W_WRK)
         CALL  DAFCT,              Convert Time                        X
               (SMF3TME,W_TIME),   Input/Output Times                  X
               MF=(E,W_WRK)
         MVC   W_LOG+56(11),W_TIME Time
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         B     DAF0034             Do not process
         DROP  R3                  SMF record dereference
DAF003   $EXIT                     Exit
         TITLE 'DAF007 - Data Lost'
DAF007   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         $MSG  W_LOG,DAF512I       Move message template
         MVC   W_LOG+33(04),SMFXXSID Lost system
         CALL  DAFCD,              Convert Date                        X
               (SMF7STD,W_LOG+43), Input/Output Dates                  X
               MF=(E,W_WRK)
         CALL  DAFCT,              Convert Time                        X
               (SMF7STM,W_TIME),   Input/Output Times                  X
               MF=(E,W_WRK)
         MVC   W_LOG+51(11),W_TIME Lost from time
         CALL  DAFCD,              Convert Date                        X
               (SMFXXDTE,W_LOG+66), Input/Output Dates                 X
               MF=(E,W_WRK)
         CALL  DAFCT,              Convert Time                        X
               (SMFXXTME,W_TIME),  Input/Output Times                  X
               MF=(E,W_WRK)
         MVC   W_LOG+74(11),W_TIME Lost to time
         LA    R15,W_LOG+92        Lost to time
         ST    R15,W_CMT@          Lost to time
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMF7NRO,2), Lost Records                      X
               MF=(E,W_WRK)
         $PRINT DAFLOG,W_LOG       Put DAFLOG record
         B     DAF0074             Do not process
         DROP  R3                  SMF record dereference
DAF007   $EXIT                     Exit
         TITLE 'DAF014 - Extract SMF Record 14/15'
**********************************************************************
*  Notes:          If Data definition name is blank, do not use it.  *
*                  If member name is blank, do not use it.           *
*                  If GDG is blank, do not use it.                   *
*                  If DSN is x'04' bypass the record (VSAM Assist)   *
*                  JFCBNVOL can contain a number larger than five,   *
*                  however, only the first five volumes are in       *
*                  JFCBVOLS.                                         *
**********************************************************************
DAF014   $ENTRY AMODE=31,RMODE=24  Entry
DAF015   EQU   DAF014
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         LA    R4,SMFJFCB1         JFCB address
         USING JFCB,R4             JFCB reference
         CLC   JFCBDSNM,=44X'04'   VTOC ?
         BNE   E14NOVTC            . No, continue
         MVC   W_DSN1,=CL044'FORMAT4.DSCB ' VTOC
         B     E14VTOC             Continue
E14NOVTC MVC   W_DSN1,JFCBDSNM     Dataset 1
E14VTOC  MVC   W_JOB1,SMF14JBN     Job name
         MVC   W_USER,SMF14UID     User identification
         MVC   W_BYTE1,JFCBNVOL    Number of volumes
         CLC   W_BYTE1,=AL1(5)     More than five volumes ?
         BNH   E14VOLOK            . No, continue
         MVC   W_BYTE1,=AL1(5)     Process only five volumes
E14VOLOK EQU   *
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SDC=',SMF14SDC,1), SDC                              X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NUC=',SMF14NUC,1), NUC                              X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SUC=',SMF14SUC,1), SUC                              X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SET=',SMF14SET,1), SET                              X
               MF=(E,W_WRK)
         CALL  DAFPV,              Process Volume Serials              X
               (W_BYTE1,1,JFCBVOLS,0,6), Process Volume Serials        X
               MF=(E,W_WRK)
         CLC   SMFTIOE5,=CL008' '  Blank Data definition name ?
         BE    E14NODDN            . Yes
         MVC   W_DD,SMFTIOE5       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
E14NODDN TM    JFCBIND1,JFCPDS     Member of PDS ?
         BNO   E14NOMEM            . No
         CLC   JFCBELNM,=CL008' '  Member present ?
         BE    E14NOMEM            . No
         MVC   W_MEMBER,JFCBELNM   Member name
         CALL  DAFMC,              Move Comment                        X
               (=C'MEMBER=',W_MEMBER,8), Member name                   X
               MF=(E,W_WRK)
E14NOMEM TM    JFCBIND1,JFCGDG     GDG ?
         BNO   E14NOGDG            . No
         CLC   JFCBELNM,=CL008' '  GDG present ?
         BE    E14NOGDG            . No
         CALL  DAFMC,              Move Comment                        X
               (=C'GDG=',JFCBELNM,8), GDG                              X
               MF=(E,W_WRK)
E14NOGDG CALL  DAFCT,              Convert Time                        X
               (SMF14OPE,W_TMPTME), Input/Output Times                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'OPE=',W_TMPTME,11), Open time                       X
               MF=(E,W_WRK)
         XR    R15,R15             Clear julian year
         ICM   R15,B'0001',JFCBCRDT  Insert julian year
         CVD   R15,W_DBL           Convert julian year
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  W_FULL1,W_DBL+6(2)  Unpack julian year
         MVC   W_YY,W_FULL1+2      Move julian year
         XR    R15,R15             Clear julian days
         ICM   R15,B'0011',JFCBCRDT+1 Insert julian days
         CVD   R15,W_DBL           Convert julian days
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  W_DDD,W_DBL+6(2)    Unpack julian days
         CALL  DAFMC,              Move Comment                        X
               (=C'CRDT=',W_YYDDD,5), Create date                      X
               MF=(E,W_WRK)
         XR    R15,R15             Clear julian year
         ICM   R15,B'0001',JFCBXPDT  Insert julian year
         CVD   R15,W_DBL           Convert julian year
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  W_FULL1,W_DBL+6(2)  Unpack julian year
         MVC   W_YY,W_FULL1+2      Move julian year
         XR    R15,R15             Clear julian days
         ICM   R15,B'0011',JFCBXPDT+1 Insert julian days
         CVD   R15,W_DBL           Convert julian days
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  W_DDD,W_DBL+6(2)    Unpack julian days
         CALL  DAFMC,              Move Comment                        X
               (=C'XPDT=',W_YYDDD,5), Expiration date                  X
               MF=(E,W_WRK)
         NI    JFCBIND2,255-JFCBRWPW Turn off extra bits
         NI    JFCBIND2,255-JFCENT Turn off extra bits
         NI    JFCBIND2,255-JFCREQ Turn off extra bits
         NI    JFCBIND2,255-JFCTEMP Turn off extra bits
         L     R14,=A(T14DSP)      DISP
         CALL  DAFPC,              Process Compare Table               X
               ((R14),JFCBIND2),   DISP                                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BUFNO=',JFCBUFNO,1), Buffers                        X
               MF=(E,W_WRK)
         CALL  DAFDSORG,           Process DSORG                       X
               (JFCDSORG,W_DSORG),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DSORG=',W_DSORG,3), DSORG                           X
               MF=(E,W_WRK)
         CALL  DAFRECFM,           RECFM                               X
               (JFCRECFM,W_RECFM),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RECFM=',W_RECFM),  RECFM                            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BLKSIZE=',JFCBLKSI,2), BLKSIZE                      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'LRECL=',JFCLRECL,2), LRECL                          X
               MF=(E,W_WRK)
         MVC   W_LRECL,W_LRECL     Clear LRECL
         MVC   W_LRECL+2(2),JFCLRECL LRECL
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NVOL=',JFCBNVOL,1),  Volumes                        X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'EXCP=',SMFEXCP,4), EXCP                             X
               MF=(E,W_WRK)
         MVC   W_EXCP,SMFEXCP      EXCP
         TM    SMF14RIN,SMF14EOV   EOV ?
         BNO   E14NOEOV            . No
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE=',=C'EOV',3), EOV                              X
               MF=(E,W_WRK)
E14NOEOV EQU   *
         TM    SMF14RIN,W_F$BIT2   DASD ?
         BNO   E14TAPE             . No, tape
         NI    JFCBCTRI,255-W_F$CTRI Turn off insignificant bits
         L     R14,=A(T14SPC)      Space type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),JFCBCTRI),   Space type                          X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'PQTY=',JFCBPQTY,3), Primary quantity                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SQTY=',JFCBSQTY,3), Secondary quantity              X
               MF=(E,W_WRK)
         TM    JFCBIND1,JFCRLSE    Release specified ?
         BNO   E14NORLS            . No
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE=',=C'Release',7), Release                      X
               MF=(E,W_WRK)
E14NORLS EQU   *
         XR    R0,R0               Clear
         ICM   R1,B'1111',SMF14NTU Tracks used
         SLDL  R0,4                Move four bits to the left
         STCM  R0,B'1111',W_DBL    Store in work field
         STCM  R1,B'1111',W_DBL+4  Store in work field
         OI    W_DBL+7,X'0F'       Force sign
         UNPK  W_NTU,W_DBL+3(5)    Unpack it
         L     R15,=A(TBLHEX)      Set HEX table address
         USING TBLHEX,R15          HEX table reference
         TR    W_NTU,TBLHEX        Convert to HEX
         DROP  R15                 HEX table dereference
         CALL  DAFMC,              Move Comment                        X
               (=C'NTU=',W_NTU,8), Tracks used                         X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NTR=',SMF14NTR,4), Tracks released                  X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NER=',SMF14NER,1), Extents released                 X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NEX=',SMF14NEX,1), Extents                          X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NTA=',SMF14NTA,4), Tracks allocated                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'VOL=',SMFSRTEV,6), Volume                           X
               MF=(E,W_WRK)
         B     DAF0140             Done
E14TAPE  EQU   *
         NI    JFCBLTYP,255-JFCDSEQN Turn off dataset sequence num bit
         L     R14,=A(T14LTP)      Label type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),JFCBLTYP),   Label type                          X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'FLSQ=',JFCBFLSQ,2), File sequence number            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DEBVL=',SMFDEBVL,2), Volume sequence number         X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DCBBL=',SMFDCBBL,4), Volume block count             X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DSSNO=',SMFDSSNO,6), Dataset serial number          X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
         DROP  R4                  JFCB dereference
DAF014   $EXIT                     Exit
         AIF   ('&RT_DFSORT' EQ '000').NODFSORT1
         TITLE 'DAF016 - Extract SMF Record 16'
DAF016   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record reference - Header
         A     R3,ICEPROD          Add product section offset
         DROP  R3                  Header dereference
         USING ICESMFP,R3          SMF record reference - Product
         CLC   ICERELNM,=CL004'13.0' DFSORT Release 13 ?
         BL    DAF0164             Lower than Release 13 - Exit
         DROP  R3                  SMF record - Product dereference
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record reference - Header
         L     R4,ICEDATA          Load data section offset
         XR    R5,R5               Clear
         LH    R5,ICEDATAL         Load data section length
         XR    R6,R6               Clear
         LH    R6,ICEDATAN         Load data section number
         LTR   R6,R6               Any data sections ?
         BNP   E16DATAEND          No, continue
         AR    R3,R4               Add data section offset
         ST    R3,W_SMFOF1         Add data section offset
         CALL  DAFD16              Extract SMF Record 16 - Data
E16DATAEND EQU   *                 End of data section
         DROP  R3                  SMF record - Product dereference
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record reference - Header
         L     R4,ICEINDS          Load input section offset
         XR    R5,R5               Clear
         LH    R5,ICEINDSL         Load input section length
         XR    R6,R6               Clear
         LH    R6,ICEINDSN         Load input section number
         LTR   R6,R6               Any input sections ?
         BNP   E16INEND            No, continue
         AR    R3,R4               Add input section offset
         ST    R3,W_SMFOF1         Add input section offset
E16IN    EQU   *
         CALL  DAFI16              Extract SMF Record 16 - Input
         AR    R3,R5               Next input
         ST    R3,W_SMFOF1         Add data section offset
         BCT   R6,E16IN            Next input
E16INEND EQU   *                   End of Input
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record - Header reference
         L     R4,ICEOTDS          Load SORTOUT section offset
         XR    R5,R5               Clear
         LH    R5,ICEOTDSL         Load SORTOUT section length
         XR    R6,R6               Clear
         LH    R6,ICEOTDSN         Load SORTOUT section number
         LTR   R6,R6               Any SORTOUT sections ?
         BNP   E16OTEND            No, continue
         AR    R3,R4               Add SORTOUT section offset
         ST    R3,W_SMFOF1         Add SORTOUT section offset
E16OT    EQU   *
         CALL  DAFS16              Extract SMF Record 16 - SORTOUT
         AR    R3,R5               Next SORTOUT
         ST    R3,W_SMFOF1         Add data section offset
         BCT   R6,E16OT            Next SORTOUT
E16OTEND EQU   *                   End of SORTOUT
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record - Header reference
         L     R4,ICEOFDS          Load Outfil section offset
         XR    R5,R5               Clear
         LH    R5,ICEOFDSL         Load Outfil section length
         XR    R6,R6               Clear
         LH    R6,ICEOFDSN         Load Outfil section number
         LTR   R6,R6               Any Outfil sections ?
         BNP   E16OFEND            No, continue
         AR    R3,R4               Add SORTOUT section offset
         ST    R3,W_SMFOF1         Add SORTOUT section offset
E16OF    EQU   *
         CALL  DAFO16              Extract SMF Record 16 - Outfil
         AR    R3,R5               Next Outfil
         ST    R3,W_SMFOF1         Add SORTOUT section offset
         BCT   R6,E16OF            Next Outfil
E16OFEND EQU   *                   End of Outfil
         B     DAF0164             Check criteria not needed
DAF016   $EXIT                     Exit
         TITLE 'DAFD16 - Extract SMF Record 16 - Data'
DAFD16   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record - Header reference
         MVC   W_JOB1,ICEJOBNM     Job name
         MVC   W_USER,ICEUSER      User identification
         MVC   W_GROUP,ICEGROUP    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         L     R3,W_SMFOF1         Load data section offset
         DROP  R3                  SMF record - Header dereference
         USING ICESMFD,R3          SMF record - Data reference
         CLI   ICEIDSNM,X'00'      SORTIN present ?
         BE    DAFD16NI            . No
         MVC   W_DSN1,ICEIDSNM     Dataset
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,ICEIVOLS,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'INPDS=',ICEINPDS,2), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'INNDS=',ICEINNDS,2), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'OUTDS=',ICEOUTDS,2), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'OFLDS=',ICEOFLDS,2), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'RCDS=',ICERCDS,4), Records sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BYTES=',ICEBYTES,4), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'CPUT=',ICECPUT,4), Sort CPU time                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'WBLK=',ICEWBLK,4), Sort work tracks used            X
               MF=(E,W_WRK)
         L     R14,=A(T16TOO)      ICEFLBY2
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICEFLBY2),   ICEFLBY2                            X
               MF=(E,W_WRK)
         L     R14,=A(T16CSF)      ICECSFLG
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICECSFLG),   ICECSFLG                            X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
DAFD16NI EQU   *
         $FILL W_SRTCMT,C' '       Blank comment
         LA    R15,W_SRTCMT        Initialize comment address
         ST    R15,W_CMT@          Initialize comment address
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record - Header reference
         MVC   W_JOB1,ICEJOBNM     Job name
         MVC   W_USER,ICEUSER      User identification
         MVC   W_GROUP,ICEGROUP    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         L     R3,W_SMFOF1         Load data section offset
         DROP  R3                  SMF record - Header dereference
         USING ICESMFD,R3          SMF record - Data reference
         CLI   ICEODSNM,X'00'      SORTIN present ?
         BE    DAFD16NO            . No
         MVC   W_DSN1,ICEODSNM     Dataset
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,ICEOVOLS,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'INPDS=',ICEINPDS,2), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'INNDS=',ICEINNDS,2), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'OUTDS=',ICEOUTDS,2), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'OFLDS=',ICEOFLDS,2), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'RCDS=',ICERCDS,4), Records sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BYTES=',ICEBYTES,4), Bytes sorted                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'CPUT=',ICECPUT,4), Sort CPU time                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'WBLK=',ICEWBLK,4), Sort work tracks used            X
               MF=(E,W_WRK)
         L     R14,=A(T16TOO)      ICEFLBY2
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICEFLBY2),   ICEFLBY2                            X
               MF=(E,W_WRK)
         L     R14,=A(T16CSF)      ICECSFLG
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICECSFLG),   ICECSFLG                            X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
DAFD16NO EQU   *
         DROP  R3                  SMF record - Data dereference
DAFD16   $EXIT                     Exit
         TITLE 'DAFI16 - Extract SMF Record 16 - Input'
DAFI16   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record - Header reference
         MVC   W_JOB1,ICEJOBNM     Job name
         MVC   W_USER,ICEUSER      User identification
         MVC   W_GROUP,ICEGROUP    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         L     R3,W_SMFOF1         Load data section offset
         DROP  R3                  SMF record - Header dereference
         USING ICESMFIN,R3         SMF record - Input reference
         MVC   W_DSN1,ICEINNAM     Dataset
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,ICEINVOL,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CLC   ICEINDDN,=CL008' '  Blank DDNAME ?
         BNE   I16DDN1             No
         MVC   W_DD,W_SAVDD        Data definition name
         B     I16DDN2
I16DDN1  MVC   W_DD,ICEINDDN       Data definition name
         MVC   W_SAVDD,W_DD        Data definition name
I16DDN2  CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         CALL  DAFRECFM,           RECFM                               X
               (ICEINRCF,W_RECFM),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RECFM=',W_RECFM),  RECFM                            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BLKSIZE=',ICEINBKZ,2), BLKSIZE                      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'LRECL=',ICEINLRL,2), LRECL                          X
               MF=(E,W_WRK)
         XC    W_LRECL,W_LRECL     Clear LRECL
         MVC   W_LRECL+2(2),ICEINLRL LRECL
         L     R14,=A(T16AMB)      Access Method Flags
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICEINAMB),   Access Method Flags                 X
               MF=(E,W_WRK)
         L     R14,=A(T16FL1)      Flags Byte
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICEINFL2),   Flags Byte                          X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
         DROP  R3                  SMF record - Input dereference
DAFI16   $EXIT                     Exit
         TITLE 'DAFO16 - Extract SMF Record 16 - Outfil'
DAFO16   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record - Header reference
         MVC   W_JOB1,ICEJOBNM     Job name
         MVC   W_USER,ICEUSER      User identification
         MVC   W_GROUP,ICEGROUP    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         L     R3,W_SMFOF1         Load data section offset
         DROP  R3                  SMF record - Header dereference
         USING ICESMFOF,R3         SMF record - Outfil reference
         MVC   W_DSN1,ICEOFNAM     Dataset
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,ICEOFVOL,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CLC   ICEOFDDN,=CL008' '  Blank DDNAME ?
         BNE   O16DDN1             No
         MVC   W_DD,W_SAVDD        Data definition name
         B     O16DDN2
O16DDN1  MVC   W_DD,ICEOFDDN       Data definition name
         MVC   W_SAVDD,W_DD        Data definition name
O16DDN2  CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         CALL  DAFRECFM,           RECFM                               X
               (ICEOFRCF,W_RECFM),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RECFM=',W_RECFM),  RECFM                            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BLKSIZE=',ICEOFBKZ,2), BLKSIZE                      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'LRECL=',ICEOFLRL,2), LRECL                          X
               MF=(E,W_WRK)
         XC    W_LRECL,W_LRECL     Clear LRECL
         MVC   W_LRECL+2(2),ICEOFLRL LRECL
         L     R14,=A(T16AMB)      Access Method Flags
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICEOFAMB),   Access Method Flags                 X
               MF=(E,W_WRK)
         L     R14,=A(T16FL1)      Flags Byte 1
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICEOFFL1),   Flags Byte 1                        X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
         DROP  R3                  SMF record - Outfil dereference
DAFO16   $EXIT                     Exit
         TITLE 'DAFS16 - Extract SMF Record 16 - SORTOUT'
DAFS16   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING ICESMFH,R3          SMF record - Header reference
         MVC   W_JOB1,ICEJOBNM     Job name
         MVC   W_USER,ICEUSER      User identification
         MVC   W_GROUP,ICEGROUP    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         L     R3,W_SMFOF1         Load SORTOUT section offset
         DROP  R3                  SMF record - Header dereference
         USING ICESMFOT,R3         SMF record - SORTOUT reference
         MVC   W_DSN1,ICEOTNAM     Dataset
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,ICEOTVOL,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CLC   ICEOTDDN,=CL008' '  Blank DDNAME ?
         BNE   S16DDN1             No
         MVC   W_DD,W_SAVDD        Data definition name
         B     S16DDN2
S16DDN1  MVC   W_DD,ICEOTDDN       Data definition name
         MVC   W_SAVDD,W_DD        Data definition name
S16DDN2  CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         CALL  DAFRECFM,           RECFM                               X
               (ICEOTRCF,W_RECFM),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RECFM=',W_RECFM),  RECFM                            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BLKSIZE=',ICEOTBKZ,2), BLKSIZE                      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'LRECL=',ICEOTLRL,2), LRECL                          X
               MF=(E,W_WRK)
         XC    W_LRECL,W_LRECL     Clear LRECL
         MVC   W_LRECL+2(2),ICEOTLRL LRECL
         L     R14,=A(T16AMB)      Access Method Flags
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICEOTAMB),   Access Method Flags                 X
               MF=(E,W_WRK)
         L     R14,=A(T16FL1)      Flags Byte 1
         CALL  DAFPT,              Process TM Table                    X
               ((R14),ICEOTFL1),   Flags Byte 1                        X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
         DROP  R3                  SMF record - SORTOUT dereference
DAFS16   $EXIT                     Exit
.NODFSORT1     ANOP
         TITLE 'DAF017 - Extract SMF Record 17'
DAF017   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF17DSN     Dataset 1
         CLC   W_DSN1+00(17),=C'SYS1.DFDSS.DEFRAG' Special DEFRAG ?
         BNE   E17DSNOK            . No
         CLC   W_DSN1+17(10),=X'4BFFFFFFFFFFFFFFFF4B' Special DEFRAG ?
         BNE   E17DSNOK            . No
         MVC   W_DSN1+17(10),=C'.XXXXXXXX.' Special DEFRAG
E17DSNOK EQU   *
         MVC   W_JOB1,SMF17JBN     Job name
         MVC   W_USER,SMF17UID     User identification
         CALL  DAFPV,              Process Volume Serials              X
               (SMF17NVL,1,SMF17RV2,2,8), Process Volume Serials       X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NVL=',SMF17NVL,1), Volumes                          X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF017   $EXIT                     Exit
         TITLE 'DAF018 - Extract SMF Record 18'
DAF018   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF18ODS     Old dataset 1
         MVC   W_JOB1,SMF18JBN     Job name
         MVC   W_USER,SMF18UID     User identification
         CALL  DAFPV,              Process Volume Serials              X
               (SMF18NVL,1,SMF18RV2,2,8), Process Volume Serials       X
               MF=(E,W_WRK)
         MVC   W_DSN2,SMF18NDS     New DSN
         CALL  DAFMC,              Move Comment                        X
               (=C'NDS=',SMF18NDS,44), New DSN                         X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NVL=',SMF18NVL,1), Volumes                          X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
         MVC   W_DSN1,SMF18NDS     New dataset 1
         MVC   W_DSN2,SMF18ODS     Old DSN
         CALL  DAFPV,              Process Volume Serials              X
               (SMF18NVL,1,SMF18RV2,2,8), Process Volume Serials       X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'ODS=',SMF18ODS,44), Old DSN                         X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NVL=',SMF18NVL,1), Volumes                          X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF018   $EXIT                     Exit
         TITLE 'DAF022 - Extract SMF Record 22'
**********************************************************************
*  Notes:          Only process activate records                     *
*                  Only process I/O config change elements           *
*                  Only process first record of each change          *
**********************************************************************
DAF022   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         CLC   SMF22IND,=AL2(9)    Subtype 9 (Activate) ?
         BNE   DAF0224             . No, exit
         CLC   SMF22OID,=X'0B'     I/O config change element ?
         BNE   DAF0224             . No, exit
         CLC   SMF22R#,=AL1(1)     First record of this change ?
         BNE   DAF0224             . No, exit
         MVC   W_DSN1,SMF22IDN     IODF dataset name
         MVC   W_JOB1,=CL008'MVS'  Job name - MVS
         MVC   W_USER,=CL008'MVS'  User identification - MVS
         CALL  DAFMC,              Move Comment                        X
               (=C'EDT=',SMF22EDT,2), EDT identification               X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CFI=',SMF22CFI,8), OS configuration identification  X
               MF=(E,W_WRK)
         L     R14,=A(T22FNC)      Function
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF22FNC),   Function                            X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF022   $EXIT                     Exit
         TITLE 'DAF024 - Extract SMF Record 24'
DAF024   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         L     R14,=A(T24SUB)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF24SUB),   Subtype                             X
               MF=(E,W_WRK)
         CLC   SMF24NTR,=H'4'      Four sections ? (4.1.0 and above)
         BE    E244SECT            . Yes, do not adjust
         CLC   SMF24NTR,=H'3'      Three sections ? (Below 4.1.0)
         BE    E243SECT            . Yes, adjust
         B     DAF0244             Unknown record format
E243SECT EQU   *
         SH    R3,=H'8'            Adjust base for missing section
E244SECT EQU   *
         L     R14,=A(T24BCF)      SMF24BCF
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF24BCF),   SMF24BCF                            X
               MF=(E,W_WRK)
         L     R14,=A(T24EOJ)      SMF24EOJ
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF24EOJ),   SMF24EOJ                            X
               MF=(E,W_WRK)
         MVC   W_DSN1,SMF24DSN     Dataset 1
         MVC   W_JOB1,SMF24JBN     Job name
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'CNT=',SMF24CNT,4), Number of records                X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF024   $EXIT                     Exit
         TITLE 'DAF036 - Extract SMF Record 36'
DAF036   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_SMFOF1,SMF36DOF   Get data section offset
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add offset to data section
         USING SMF36DAT,R3         Data section reference
         MVC   W_DSN1,SMF36CNM     Catalog dataset 1
         MVC   W_JOB1,SMF36JNM     Job name
         MVC   W_USER,SMF36UID     User identification
         MVC   W_VOL1,SMF36CVS     Catalog volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'VOLUME=',W_VOL1,6), Catalog volume serial           X
               MF=(E,W_WRK)
         MVC   W_CATALOG,SMF36CNM  Catalog name
         MVC   W_DSN2,SMF36PDS     Portable DSN
         MVC   W_VOL2,SMF36PVS     Portable volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'PGM=',SMF36PGM,8), Program name                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'PDS=',W_DSN2,44),  Portable DSN                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'PVS=',W_VOL2,6),   Portable volser                  X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'EDT=',SMF36EDT,8), Export date                      X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'ETM=',SMF36ETM,8), Export time                      X
               MF=(E,W_WRK)
         L     R14,=A(T36EIN)      Indicator
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF36EIN),   Indicator                           X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
         MVC   W_DSN1,SMF36PDS     Portable dataset 1
         MVC   W_VOL1,SMF36PVS     Portable volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'VOLUME=',W_VOL1,6), Portable volume serial          X
               MF=(E,W_WRK)
         MVC   W_DSN2,SMF36CNM     Catalog DSN
         MVC   W_VOL2,SMF36CVS     Catalog volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'PGM=',SMF36PGM,8), Program name                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CVS=',W_VOL2,6), Catalog volume serial              X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'EDT=',SMF36EDT,8), Export date                      X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'ETM=',SMF36ETM,8), Export time                      X
               MF=(E,W_WRK)
         L     R14,=A(T36EIN)      Indicator
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF36EIN),   Indicator                           X
               MF=(E,W_WRK)
         DROP  R3                  Data section dereference
DAF036   $EXIT                     Exit
         AIF   ('&RT_DFSMS' EQ '000').NODFSMS1
         TITLE 'DAF042 - Extract SMF Record 42'
**********************************************************************
*  Notes:          SMF42EAD/ESD can contain 'NO xCDS SPECIFIED'      *
*                  (where xCDS is either ACDS or SCDS)               *
*                  Bypass VARY SMS volume - DSN low values           *
**********************************************************************
DAF042   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
*
**       Subtype Selection
*
         AIF   ('&ST_DFSMS03' EQ 'NO').NODFSMS031
         CLC   SMF42STY,=AL2(03)   SMS Configuration ?
         BE    EXT42T03            . Yes
.NODFSMS031    ANOP
         AIF   ('&ST_DFSMS06' EQ 'NO').NODFSMS061
         CLC   SMF42STY,=AL2(06)   Dataset Statistics ?
         BE    EXT42T06            . Yes
.NODFSMS061    ANOP
         AIF   ('&ST_DFSMS07' EQ 'NO').NODFSMS071
         CLC   SMF42STY,=AL2(07)   Dataset Statistics ?
         BE    EXT42T07            . Yes
.NODFSMS071    ANOP
         AIF   ('&ST_DFSMS09' EQ 'NO').NODFSMS091
         CLC   SMF42STY,=AL2(09)   X37 Abend ?
         BE    EXT42T09            . Yes
.NODFSMS091    ANOP
         AIF   ('&ST_DFSMS10' EQ 'NO').NODFSMS101
         CLC   SMF42STY,=AL2(10)   Volume Selection Failure ?
         BE    EXT42T10            . Yes
.NODFSMS101    ANOP
         AIF   ('&ST_DFSMS16' EQ 'NO').NODFSMS161
         CLC   SMF42STY,=AL2(16)   Dataset Response Time Summary ?
         BE    EXT42T16            . Yes
.NODFSMS161    ANOP
         AIF   ('&ST_DFSMS20' EQ 'NO').NODFSMS201
         CLC   SMF42STY,=AL2(20)   STOW Initialize ?
         BE    EXT42T20            . Yes
.NODFSMS201    ANOP
         AIF   ('&ST_DFSMS21' EQ 'NO').NODFSMS211
         CLC   SMF42STY,=AL2(21)   Member Delete ?
         BE    EXT42T21            . Yes
.NODFSMS211    ANOP
         B     DAF0424             Exit - No criteria check
         AIF   ('&ST_DFSMS03' EQ 'NO').NODFSMS032
*
**       Subtype 03 - SMS Configuration
*
EXT42T03 EQU   *                   SMS Configuration
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STY=',SMF42STY,2), Subtype                          X
               MF=(E,W_WRK)
         MVC   W_JOB1,SMF42SSI     Job name
         MVC   W_USER,SMF42SSI     User identification
         LA    R3,SMF42_LEN(R3)    Set subtype 3 header
         USING SMF42S3,R3          Subtype 3 Header reference
         MVC   W_SMFOF1,SMF42EAO   Get offset to event audit section
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add event audit section offset
         USING SMF4203A,R3         Event audit section reference
         CLC   SMF42EAC(8),=C'ACTIVATE' ACTIVATE ?
         BNE   DAF0424             . No, bypass the record
         CLC   SMF42EAD(17),=C'NO ACDS SPECIFIED' ACDS specified ?
         BE    E42ESD              No, check SCSD
         MVC   W_DSN1,SMF42EAD     ACDS dataset 1
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE=',=C'ACDS_Dataset',12), ACDS DSN               X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'EAC=',SMF42EAC,8), Action                           X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
E42ESD   CLC   SMF42ESD(17),=C'NO SCDS SPECIFIED' SCDS specified ?
         BE    DAF0424             . No, get out
         MVC   W_DSN1,SMF42ESD     SCDS dataset 1
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE=',=C'SCDS_Dataset',12), SCDS DSN               X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'EAC=',SMF42EAC,8), Action                           X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
         B     DAF0420             Return to caller
.NODFSMS032    ANOP
         AIF   ('&ST_DFSMS06' EQ 'NO').NODFSMS062
*
**       Subtype 06 - Dataset Statistics
*
EXT42T06 EQU   *                   Dataset Statistics
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         DROP  R3                  SMF record dereference
         B     DAF0424             Return to caller
.NODFSMS062    ANOP
         AIF   ('&ST_DFSMS07' EQ 'NO').NODFSMS072
*
**       Subtype 07 - Dataset Statistics
*
EXT42T07 EQU   *                   Dataset Statistics
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         DROP  R3                  SMF record dereference
         B     DAF0424             Return to caller
.NODFSMS072    ANOP
         AIF   ('&ST_DFSMS09' EQ 'NO').NODFSMS092
*
**       Subtype 09 - X37 Abend
*
EXT42T09 EQU   *                   X37 Abend
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STY=',SMF42STY,2), Subtype                          X
               MF=(E,W_WRK)
         LA    R3,SMF42_LEN(R3)    Set subtype 9 header
         USING SMF42S9,R3          Subtype 9 Header reference
         MVC   W_SMFOF1,SMF42ABO   Get offset to X37 abend section
         MVC   W_SMFOF2,SMF42SMO   Get offset to SMS data section
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add event audit section offset
         USING SMF4209A,R3         X37 abend section reference
         MVC   W_JOB1,S42JOBN      Job name
         MVC   W_USER,S42AAUID     User identification
         MVC   W_DSN1,S42DSNME     Dataset
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,S42VOLSR,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CALL  DAFDSORG,           Process DSORG                       X
               (S42DSORG,W_DSORG),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DSORG=',W_DSORG,3), DSORG                           X
               MF=(E,W_WRK)
         L     R14,=A(T42FLAGS)    T42FLAGS
         CALL  DAFPT,              Process TM Table                    X
               ((R14),S42FLAGS),   S42FLAGS                            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NEXT=',S42NEXT,1), Number of extents                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'TNTRK=',S42TNTRK,4), Total number tracks this vol   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'ASSAT=',S42ASSAT,4), Secondary allocation amount    X
               MF=(E,W_WRK)
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF2         Add SMS data section offset
         USING SMF4209B,R3         SMS data section reference
         MVC   W_MGMTCLAS,S42MCNME Management class name
         CALL  DAFMC,              Move Comment                        X
               (=C'MGMTCLAS=',W_MGMTCLAS,8),     Management class name X
               MF=(E,W_WRK)
         MVC   W_STORCLAS,S42SCNME Storage class name
         CALL  DAFMC,              Move Comment                        X
               (=C'STORCLAS=',W_STORCLAS,8),        Storage class name X
               MF=(E,W_WRK)
         MVC   W_DATACLAS,S42DCNME Data class name
         CALL  DAFMC,              Move Comment                        X
               (=C'DATACLAS=',W_DATACLAS,8),           Data class name X
               MF=(E,W_WRK)
         CALL  SMFSNAP             SNAP current SMF record
         B     DAF0420             Return to caller
         DROP  R3                  SMF record dereference
.NODFSMS092    ANOP
         AIF   ('&ST_DFSMS10' EQ 'NO').NODFSMS102
*
**       Subtype 10 - Volume Selection Failure
*
EXT42T10 EQU   *                   X37 Abend
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STY=',SMF42STY,2), Subtype                          X
               MF=(E,W_WRK)
         LA    R3,SMF42_LEN(R3)    Set subtype 10 header
         USING SMF42SA,R3          Subtype 10 Header reference
         MVC   W_SMFOF1,SMF42VSF   Volume Selection Failure offset
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add Volume Selection Failure offset
         USING SMF420AA,R3         Volume Selection Failure reference
         MVC   W_JOB1,SMF42JBN     Job name
         MVC   W_DSN1,SMF42DSN     Dataset
         MVC   W_DD,SMF42DDN       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DDN=',W_DD,8), Data definition name                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'PGN=',SMF42PGN,8), Program name                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'STN=',SMF42STN,8), Step name                        X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'RSP=',SMF42RSP,4), Requested space quantity         X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'UNT=',SMF42UNT,2), Unit of Requested space quantity X
               MF=(E,W_WRK)
         MVC   W_DATACLAS,SMF42DCN Data class name
         CALL  DAFMC,              Move Comment                        X
               (=C'DATACLAS=',W_DATACLAS,8),           Data class name X
               MF=(E,W_WRK)
         MVC   W_MGMTCLAS,SMF42MCN Management class name
         CALL  DAFMC,              Move Comment                        X
               (=C'MGMTCLAS=',W_MGMTCLAS,8),     Management class name X
               MF=(E,W_WRK)
         MVC   W_STORCLAS,SMF42SNM Storage class name
         CALL  DAFMC,              Move Comment                        X
               (=C'STORCLAS=',W_STORCLAS,8),        Storage class name X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SGS=',SMF42SGS+2,30), Storage group name (1 of 15)  X
               MF=(E,W_WRK)
         DROP  R3                  Volume Selection Failure dereference
         B     DAF0420             Return to caller
.NODFSMS102    ANOP
         AIF   ('&ST_DFSMS16' EQ 'NO').NODFSMS162
*
**       Subtype 16 - Dataset Response Time Summary
*
EXT42T16 EQU   *                   Dataset Response Time Summary
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STY=',SMF42STY,2), Subtype                          X
               MF=(E,W_WRK)
         LA    R3,SMF42_LEN(R3)    Set subtype 16 header
         USING SMF42SG,R3          Subtype 16 Header reference
         LH    R4,SMF42GD3         Sysplex wide count
         LTR   R4,R4               Any Sysplex wide ?
         BNP   EXT42T16C1          No, continue
EXT42T16N1 EQU  *
         MVC   W_SMFOF1,SMF42GD1   Sysplex wide
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add Volume Selection Failure data
         USING SMF420GA,R3         Sysplex wide reference
         MVC   W_DSN1,SMF42GAB     Dataset
         MVC   W_DSN2,SMF42GAC     VSAM Spere Name
         CALL  DAFMC,              Move Comment                        X
               (=C'VSN=',SMF42GAC,44), VSAM Spere Name                 X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
EXT42T16C1 EQU  *
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STY=',SMF42STY,2), Subtype                          X
               MF=(E,W_WRK)
         LA    R3,SMF42_LEN(R3)    Set subtype 16 header
         USING SMF42SG,R3          Subtype 16 Header reference
         LH    R4,SMF42GD6         Sysplex wide count
         LTR   R4,R4               Any Sysplex wide ?
         BNP   EXT42T16C2          No, continue
EXT42T16N2 EQU  *
         MVC   W_SMFOF1,SMF42GD4   Sysplex wide
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add Volume Selection Failure data
         USING SMF420GB,R3         Sysplex wide reference
         MVC   W_DSN1,SMF42GBB     Dataset
         MVC   W_DSN2,SMF42GBC     VSAM Spere Name
         CALL  DAFMC,              Move Comment                        X
               (=C'VSN=',SMF42GBC,44), VSAM Spere Name                 X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
EXT42T16C2 EQU  *
         DROP  R3                  SMF record dereference
         B     DAF0424             Return to caller - No Check
.NODFSMS162    ANOP
         AIF   ('&ST_DFSMS20' EQ 'NO').NODFSMS202
*
**       Subtype 20 - STOW Initialize
*
EXT42T20 EQU   *                   Dataset Statistics
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STY=',SMF42STY,2), Subtype                          X
               MF=(E,W_WRK)
         LA    R3,SMF42_LEN(R3)    Set subtype 20 header
         USING SMF42SK,R3          Subtype 20 Header reference
         MVC   W_SMFOF1,SMF42KN1   Job/Data Set Information offset
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add Job/Data Set Information offset
         USING SMF420KA,R3         Job/Data Set Information reference
         MVC   W_JOB1,SMF42KJB     Job name
         CALL  DAFMC,              Move Comment                        X
               (=C'KST=',SMF42KST,8), Step name                        X
               MF=(E,W_WRK)
         MVC   W_DSN1,SMF42KDS     Dataset
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,SMF42KVS,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         DROP  R3                  Job/Data Set Information dereference
         B     DAF0420             Return to caller
.NODFSMS202    ANOP
         AIF   ('&ST_DFSMS21' EQ 'NO').NODFSMS212
*
**       Subtype 21 - Member Delete
*
EXT42T21 EQU   *                   Dataset Statistics
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF42,R3            SMF record reference
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STY=',SMF42STY,2), Subtype                          X
               MF=(E,W_WRK)
         LA    R3,SMF42_LEN(R3)    Set subtype 21 header
         USING SMF42SL,R3          Subtype 21 Header reference
         MVC   W_SMFOF1,SMF42LN1   Job/Data Set Information offset
         MVC   W_SMFOF2,SMF42LN4   Get offset to deleted alias names
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add Job/Data Set Information offset
         USING SMF420LA,R3         Job/Data Set Information reference
         MVC   W_JOB1,SMF42LJB     Job name
         CALL  DAFMC,              Move Comment                        X
               (=C'LST=',SMF42LST,8), Step name                        X
               MF=(E,W_WRK)
         MVC   W_DSN1,SMF42LDS     Dataset
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,SMF42LVS,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'Len=',SMF42LNL,2), Length of member name            X
               MF=(E,W_WRK)
         MVC   W_MEMBER,SMF42LMN   Member
         CALL  DAFMC,              Move Comment                        X
               (=C'Member=',SMF42LMN,8), Member name                   X
               MF=(E,W_WRK)
         DROP  R3                  Job/Data Set Information dereference
         B     DAF0420             Return to caller
.NODFSMS212    ANOP
DAF042   $EXIT                     Exit
.NODFSMS1      ANOP
         AIF   ('&RT_BDT' EQ '000').NOBDT1
         TITLE 'DAF059 - Extract SMF Record 59'
DAF059   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMFSTART,R3         SMF record reference
         MVC   W_SMFOF1,SMF59OPD   Get product section offset
         MVC   W_SMFOF2,SMF59OTI   Get transaction id section offset
         MVC   W_SMFOF3,SMF59OTT   Get transaction type section offset
         MVC   W_SMFOF4,SMF59OTD   Get transaction data section offset
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add offset to product section
         USING SMF59PRS,R3         Product section reference
         CLC   SMF59TID,=C'FF'     File to File ?
         BNE   DAF0594             . No, bypass the record
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF2         Add offset to product section
         USING SMF59TRI,R3         Transaction id section reference
         MVC   W_USER,SMF59TSU     User identification
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF3         Add offset to transaction type sect
         USING SMF59TTS,R3         Transaction type section reference
         CLC   SMF59OFG,=C'D'      Origin DD Dummy ?
         BNE   E59ONUL1            . No, origin is a real dataset
         MVC   W_DSN1,=CL044'NULLFILE' Origin is NULLFILE
         B     E59ONUL2            Continue
E59ONUL1 EQU   *
         MVC   W_DSN1,SMF59OFN     Origin dataset
         MVC   W_MEMBER,SMF59OMN   Origin member
         CALL  DAFMC,              Move Comment                        X
               (=C'OMN=',W_MEMBER,8), Origin member                    X
               MF=(E,W_WRK)
         MVC   W_VOL1,SMF59OVI     Origin volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'OVI=',W_VOL1,6), Origin volume serial               X
               MF=(E,W_WRK)
E59ONUL2 EQU   *
         MVC   W_DSN2,SMF59DFN     Destination dataset
         CALL  DAFMC,              Move Comment                        X
               (=C'DFN=',W_DSN2,44), Destination dataset               X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DMN=',SMF59DMN,8), Destination member               X
               MF=(E,W_WRK)
         MVC   W_VOL2,SMF59DVI     Destination volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'DVI=',W_VOL2,6), Destination volume serial          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'ONN=',SMF59ONN,8), Origin node name                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DNN=',SMF59DNN,8), Destination node name            X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF4         Add offset to transaction data sect
         USING SMF59TRD,R3         Transaction data section reference
         MVC   W_JOB1,SMF59BJN     Job name
         DROP  R3                  SMF record dereference
         CALL  DAFCC               Check criteria
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF2         Add offset to product section
         USING SMF59TRI,R3         Transaction id section reference
         MVC   W_USER,SMF59TSU     User identification
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF3         Add offset to transaction type sect
         USING SMF59TTS,R3         Transaction type section reference
         CLC   SMF59DFG,=C'D'      Destination DD Dummy ?
         BNE   E59DNUL1            . No, check for internal reader
         MVC   W_DSN1,=CL044'NULLFILE' Destination is NULLFILE
         B     E59DNUL3            Continue
E59DNUL1 EQU   *
         CLC   SMF59DFG,=C'I'      Destination internal reader ?
         BNE   E59DNUL2            . No, destination is a real dataset
         MVC   W_DSN1,=CL044'INTRDR' Destination is INTRDR
         B     E59DNUL3            Continue
E59DNUL2 EQU   *
         MVC   W_DSN1,SMF59DFN     Destination dataset
         MVC   W_MEMBER,SMF59DMN   Destination member
         CALL  DAFMC,              Move Comment                        X
               (=C'DMN=',W_MEMBER,8), Destination member               X
               MF=(E,W_WRK)
         MVC   W_VOL1,SMF59DVI     Destination volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'DVI=',W_VOL1,6), Destination volume serial          X
               MF=(E,W_WRK)
E59DNUL3 EQU   *
         MVC   W_DSN2,SMF59OFN     Origin dataset
         CALL  DAFMC,              Move Comment                        X
               (=C'OFN=',W_DSN2,44), Origin dataset                    X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'OMN=',SMF59OMN,8), Origin member                    X
               MF=(E,W_WRK)
         MVC   W_VOL2,SMF59OVI     Origin volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'OVI=',W_VOL2,6), Origin volume serial               X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'ONN=',SMF59ONN,8), Origin node name                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DNN=',SMF59DNN,8), Destination node name            X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF4         Add offset to transaction data sect
         USING SMF59TRD,R3         Transaction data section reference
         MVC   W_JOB1,SMF59BJN     Job name
         DROP  R3                  SMF record dereference
DAF059   $EXIT                     Exit
.NOBDT1        ANOP
         TITLE 'DAF060 - Extract SMF Record 60'
**********************************************************************
*  Notes:          Bypass convert SMS volume - DSN low values        *
**********************************************************************
DAF060   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         CLC   SMF60ENM,=44X'00'   DSN low values ?
         BE    DAF0604             . Yes, bypass the record
         MVC   W_DSN1,SMF60ENM     Dataset 1
         MVC   W_JOB1,SMF60JNM     Job name
         MVC   W_USER,SMF60UID     User identification
         MVC   W_VVDS,SMF60CNM     VVDS name
         L     R14,=A(T6XSUB)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF60SUB),   Subtype                             X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'VVDS=',W_VVDS,44), VVDS name                        X
               MF=(E,W_WRK)
         L     R14,=A(T6XTYP)      Type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF60TYP),   Type                                X
               MF=(E,W_WRK)
         CALL  DSOTYP,             Process DSORG in the SMF6XTYP       X
               (SMF60TYP,W_DSORG),                                     X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF060   $EXIT                     Exit
         TITLE 'DAF061 - Extract SMF Record 61'
DAF061   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF61ENM     Dataset 1
         MVC   W_JOB1,SMF61JNM     Job name
         MVC   W_USER,SMF61UID     User identification
         MVC   W_CATALOG,SMF61CNM  Catalog name
         L     R14,=A(T6XSUB)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF61SUB),   Subtype                             X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         L     R14,=A(T6XTYP)      Type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF61TYP),   Type                                X
               MF=(E,W_WRK)
         CALL  DSOTYP,             Process DSORG in the SMF6XTYP       X
               (SMF61TYP,W_DSORG),                                     X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF061   $EXIT                     Exit
         TITLE 'DAF062 - Extract SMF Record 62'
DAF062   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF62DNM     Dataset 1
         MVC   W_JOB1,SMF62JBN     Job name
         MVC   W_USER,SMF62UIF     User identification
         CALL  DAFPV,              Process Volume Serials              X
               (SMF62VCT,2,SMF62VSR,0,10), Process Volume Serials      X
               MF=(E,W_WRK)
         MVC   W_CATALOG,SMF62CNM  Catalog name
         L     R14,=A(T62IND)      SMF62IND
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF62IND),   SMF62IND                            X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CVS=',SMF62CVS,6), Catalog volume serial            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'VCT=',SMF62VCT,2), Volumes                          X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF062   $EXIT                     Exit
         TITLE 'DAF063 - Extract SMF Record 63'
DAF063   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF63ENM     Dataset 1
         MVC   W_JOB1,SMF63JBN     Job name
         MVC   W_USER,SMF63UIF     User identification
         MVC   W_CATALOG,SMF63CNM  Catalog name
         L     R14,=A(T63FDT)      SMF63FDT
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF63FDT),   SMF63FDT                            X
               MF=(E,W_WRK)
         L     R14,=A(T6XIOD)      SMF63TYP
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF63TYP),   SMF63TYP                            X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF063   $EXIT                     Exit
         TITLE 'DAF064 - Extract SMF Record 64'
**********************************************************************
*  Notes:          If DDN is blank, do not use it                    *
*                  Bypass MSTJCL00 STGINDEX - DSN low values         *
**********************************************************************
DAF064   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF64DNM     Dataset 1
         MVC   W_JOB1,SMF64JBN     Job name
         MVC   W_USER,SMF64UIF     User identification
         MVC   W_DSORG,=CL003'VS'  DSORG
         LH    R1,SMF64ESL         Extent length
         XR    R0,R0               Clear
         D     R0,=F'26'           Determine volume serial count
         ST    R1,W_FULL1          Volume serial count
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'VOL=',W_FULL1,4), Volume serial count               X
               MF=(E,W_WRK)
         CALL  DAFPV,              Process Volume Serials              X
               (W_FULL1,4,SMF64FCC,8,26), Process Volume Serials       X
               MF=(E,W_WRK)
         LA    R4,SMF64ESL
         AH    R4,SMF64ESL
         AH    R4,=H'2'
         DROP  R3                  SMF record dereference
         USING SMF64STS,R4         Statistics reference
         CLC   SMF64DDN,=CL008' '  Blank Data definition name ?
         BE    E64NODDN            . Yes
         CLC   SMF64DDN,=CL008'STGINDEX' Storage index ?
         BNE   E64NOSTG            . No - continue
         CLC   W_DSN1,=44X'00'     DSN null
         BE    DAF0644             . Yes, bypass the record
E64NOSTG MVC   W_DD,SMF64DDN       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         DROP  R4                  statistics dereference
         USING D_SMFREC,R3         SMF record reference
E64NODDN MVC   W_CATALOG,SMF64CNM  Catalog name
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         L     R14,=A(T64RIN)      SMF64RIN
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF64RIN),   SMF64RIN                            X
               MF=(E,W_WRK)
         L     R14,=A(T64DTY)      SMF64DTY
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF64DTY),   SMF64DTY                            X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
         USING SMF64STS,R4         Statistics reference
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NIL=',SMF64NIL,4), Prior levels                     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NEX=',SMF64NEX,4), Prior extents                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NLR=',SMF64NLR,4), Prior records                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NDE=',SMF64NDE,4), Prior deletes                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NIN=',SMF64NIN,4), Prior inserts                    X
               MF=(E,W_WRK)
         MVC   W_NUP,SMF64NUP      NUP
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NUP=',SMF64NUP,4), Prior updates                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NRE=',SMF64NRE,4), Prior retrieves                  X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NFS=',SMF64NFS,4), Prior unused ci's                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NCS=',SMF64NCS,4), Prior ci splits                  X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NAS=',SMF64NAS,4), Prior ca splits                  X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NEP=',SMF64NEP,4), Prior EXCPs                      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DIL=',SMF64DIL,4), Change levels                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DEX=',SMF64DEX,4), Change extents                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DLR=',SMF64DLR,4), Change records                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DDE=',SMF64DDE,4), Change deletes                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DIN=',SMF64DIN,4), Change inserts                   X
               MF=(E,W_WRK)
         MVC   W_DUP,SMF64DUP      DUP
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DUP=',SMF64DUP,4), Change updates                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DRE=',SMF64DRE,4), Change retrieves                 X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DFS=',SMF64DFS,4), Change unused ci's               X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DCS=',SMF64DCS,4), Change ci splits                 X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DAS=',SMF64DAS,4), Change ca splits                 X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DEP=',SMF64DEP,4), Change EXCPs                     X
               MF=(E,W_WRK)
         MVC   W_EXCP,SMF64DEP     EXCP
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DBS=',SMF64DBS,4), Physical blocksize               X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DCI=',SMF64DCI,4), Control interval size            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DLS=',SMF64DLS,4), Maximum logical recordsize       X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DKL=',SMF64DKL,2), Key length                       X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STR=',SMF64STR,1), Strings specified                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BNO=',SMF64BNO,1), Buffers specified                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BSP=',SMF64BSP,4), Bufferspace                      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BFD=',SMF64BFD,2), Data buffers                     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BFI=',SMF64BFI,2), Index buffers                    X
               MF=(E,W_WRK)
         MVC   W_DSN2,SMF64CLN     Cluster DSN
         CALL  DAFMC,              Move Comment                        X
               (=C'CLN=',SMF64CLN,44), Cluster DSN                     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'PLH=',SMF64PLH,2), Concurrent strings               X
               MF=(E,W_WRK)
         L     R14,=A(T64MC1)      SMF64MC1
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF64MC1),   SMF64MC1                            X
               MF=(E,W_WRK)
         L     R14,=A(T64MC2)      SMF64MC2
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF64MC2),   SMF64MC2                            X
               MF=(E,W_WRK)
         L     R14,=A(T64MC3)      SMF64MC3
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF64MC3),   SMF64MC3                            X
               MF=(E,W_WRK)
         DROP  R4                  Statistics dereference
DAF064   $EXIT                     Exit
         TITLE 'DAF065 - Extract SMF Record 65'
DAF065   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF65ENM     Dataset 1
         MVC   W_JOB1,SMF65JNM     Job name
         MVC   W_USER,SMF65UID     User identification
         MVC   W_CATALOG,SMF65CNM  Catalog name
         L     R14,=A(T6XSUB)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF65SUB),   Subtype                             X
               MF=(E,W_WRK)
         L     R14,=A(T6XFNC)      Function
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF65FNC),   Function                            X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         L     R14,=A(T6XTYP)      Type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF65TYP),   Type                                X
               MF=(E,W_WRK)
         CALL  DSOTYP,             Process DSORG in the SMF6XTYP       X
               (SMF65TYP,W_DSORG),                                     X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF065   $EXIT                     Exit
         TITLE 'DAF066 - Extract SMF Record 66'
DAF066   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF66ENM     Old dataset 1
         MVC   W_JOB1,SMF66JNM     Job name
         MVC   W_USER,SMF66UID     User identification
         MVC   W_CATALOG,SMF66CNM  Catalog name
         L     R14,=A(T6XSUB)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF66SUB),   Subtype                             X
               MF=(E,W_WRK)
         L     R14,=A(T6XTYP)      Type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF66TYP),   Type                                X
               MF=(E,W_WRK)
         CALL  DSOTYP,             Process DSORG in the SMF6XTYP       X
               (SMF66TYP,W_DSORG),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         CLC   SMF66FNC,=C'R'      Rename ?
         BNE   DAF0660             . Get out
         MVC   W_DSN2,SMF66NNM     New DSN
         CALL  DAFMC,              Move Comment                        X
               (=C'NNM=',SMF66NNM,44), New name                        X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
         MVC   W_DSN1,SMF66NNM     New dataset 1
         MVC   W_DSN2,SMF66ENM     Old DSN
         L     R14,=A(T6XSUB)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF66SUB),   Subtype                             X
               MF=(E,W_WRK)
         L     R14,=A(T6XTYP)      Type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF66TYP),   Type                                X
               MF=(E,W_WRK)
         CALL  DSOTYP,             Process DSORG in the SMF6XTYP       X
               (SMF66TYP,W_DSORG),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'ENM=',SMF66ENM,44), Old name                        X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF066   $EXIT                     Exit
         TITLE 'DAF067 - Extract SMF Record 67'
DAF067   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF67DEN     Dataset 1
         MVC   W_JOB1,SMF67JBN     Job name
         MVC   W_USER,SMF67UIF     User identification
         MVC   W_CATALOG,SMF67CNM  Catalog name
         L     R14,=A(T67FDT)      SMF67FDT
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF67FDT),   SMF67FDT                            X
               MF=(E,W_WRK)
         L     R14,=A(T6XIOD)      SMF67IOD
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF67IOD),   SMF67IOD                            X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF067   $EXIT                     Exit
         TITLE 'DAF068 - Extract SMF Record 68'
DAF068   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF68ONM     Old dataset 1
         MVC   W_JOB1,SMF68JBN     Job name
         MVC   W_USER,SMF68UIF     User identification
         MVC   W_CATALOG,SMF68CNM  Catalog name
         MVC   W_DSN2,SMF68NNM     New DSN
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'NNM=',SMF68NNM,44), New DSN                         X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
         MVC   W_DSN1,SMF68NNM     New dataset 1
         MVC   W_DSN2,SMF68ONM     Old DSN
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'ONM=',SMF68ONM,44), Old DSN                         X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF068   $EXIT                     Exit
         TITLE 'DAF069 - Extract SMF Record 69'
DAF069   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_DSN1,SMF69CNM     Dataset 1
         MVC   W_JOB1,SMF69JBN     Job name
         MVC   W_USER,SMF69UIF     User identification
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,SMF69VSR,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         MVC   W_CATALOG,SMF69CNM  Catalog name
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NDS=',SMF69NDS,2), Free extents                     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NUC=',SMF69NUC,2), Free cylinders                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NUT=',SMF69NUT,2), Free tracks                      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'LNC=',SMF69LNC,2), Continuous cylinders             X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'LNT=',SMF69LNT,2), Continuous tracks                X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CAT=',W_CATALOG,44), Catalog name                   X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
DAF069   $EXIT                     Exit
         AIF   ('&RT_RMF' EQ '000').NORMF1
         TITLE 'DAF073 - Extract SMF Record 73'
DAF073   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF73HDR,R3         SMF record reference
         MVC   W_SMFOF1,SMF73HIS   Channel path control offset
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add Channel path control offset
         USING SMF73CTL,R3         Channel path control reference
         MVC   W_JOB1,=CL008'RMF'  Job name
         MVC   W_USER,=CL008'RMF'  User identification
         MVC   W_DSN1,SMF73TNM     Dataset 1
         CALL  DAFMC,              Move Comment                        X
               (=C'TSF=',SMF73TSF,2), IODF name suffix                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TOK=',SMF73TOK,16), Partial token information       X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TDY=',SMF73TDY,10), IODF creation date              X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TTM=',SMF73TTM,9), IODF creation time               X
               MF=(E,W_WRK)
         DROP  R3                  Channel path control dereference
DAF073   $EXIT                     Exit
         TITLE 'DAF074 - Extract SMF Record 74'
DAF074   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF74HDR,R3         SMF record reference
*
**       Subtype Selection
*
         CLC   SMF74STY,=AL2(01)   Device activity
         BE    EXT74T01            Yes
         B     DAF0744             Exit - No criteria check
*
**       Subtype 01 - Device activity
*
EXT74T01 EQU   *                   Subtype 01 - Device activity
         MVC   W_SMFOF1,SMF74DCS   Device control data offset
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add device control data offset
         USING SMF74A,R3           Device control Data reference
         MVC   W_JOB1,=CL008'RMF'  Job name
         MVC   W_USER,=CL008'RMF'  User identification
         MVC   W_DSN1,SMF74TNM     Dataset 1
         CALL  DAFMC,              Move Comment                        X
               (=C'TSF=',SMF74TSF,2), IODF name suffix                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TOK=',SMF74TOK,16), Partial token information       X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TDY=',SMF74TDY,10), IODF creation date              X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TTM=',SMF74TTM,9), IODF creation time               X
               MF=(E,W_WRK)
         DROP  R3                  Device control data dereference
DAF074   $EXIT                     Exit
         TITLE 'DAF075 - Extract SMF Record 75'
DAF075   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF75HDR,R3         SMF record reference
         MVC   W_SMFOF1,SMF75PSS   Get offset to page/swap section
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add page/swap section offset
         USING SMF75PSD,R3         Page/swap section reference
         MVC   W_JOB1,=CL008'RMF'  Job name
         MVC   W_USER,=CL008'RMF'  User identification
         MVC   W_DSN1,SMF75DSN     Dataset 1
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,SMF75VOL,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         L     R14,=A(T75PST)      SMF75PST
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF75PST),   SMF75PST                            X
               MF=(E,W_WRK)
         L     R14,=A(T75FL2)      SMF75FL2
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF75FL2),   SMF75FL2                            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SLA=',SMF75SLA,4), Available slots                  X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'MXU=',SMF75MXU,4), Maximum slots                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'MNU=',SMF75MNU,4), Minimum slots                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'AVU=',SMF75AVU,4), Average slots                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'BDS=',SMF75BDS,4), Unusable slots                   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'USE=',SMF75USE,4), Used samples                     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'REQ=',SMF75REQ,4), Requests                         X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SIO=',SMF75SIO,4), I/O requests                     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'PGX=',SMF75PGX,4), Pages transferred                X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DEV=',SMF75DEV,8), Device name                      X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'CU=',SMF75CU,8),   Control unit name                X
               MF=(E,W_WRK)
         DROP  R3                  Page/swap section dereference
DAF075   $EXIT                     Exit
         TITLE 'DAF077 - Extract SMF Record 77'
DAF077   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF77HDR,R3         SMF record reference
         MVC   W_77EDS,SMF77EDS    Get enqueue data section offset
         MVC   W_77EDN,SMF77EDN    Get enqueue data section count
         MVC   W_77EDL,SMF77EDL    Get enqueue data section length
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_77EDS          Add enqueue data section offset
         USING SMF77ENQ,R3         Enqueue data section reference
         LH    R4,W_77EDN          Enqueue data section count
         LTR   R4,R4               Any enqueue data sections ?
         BNP   DAF0774             No, get out
E77DTANX EQU   *
*
**       Major Enqueue Name
*
         CALL  DAFMC,              Move Comment                        X
               (=C'QNM=',SMF77QNM,8), Major Enqueue Name               X
               MF=(E,W_WRK)
         LA    R15,MAJORNUM        Major table size
         L     R14,=A(TBLMAJOR)    Major table address
E77CKMAJ EQU    *
         CLC   SMF77QNM,0(R14)     Major match ?
         BE    E77OKMAJ            . Yes
         LA    R14,MAJORLEN(R14)   Next major
         BCT   R15,E77CKMAJ        Process next major, if any
E77OKMAJ EQU   *
         MVC   W_MAJDES,8(R14)     Move major enqueue description
         CALL  DAFMC,              Move Binary Comment                 X
               (=C'NONE',W_MAJDES,32), Major Enqueue Description       X
               MF=(E,W_WRK)
         MVC   W_DSN1,SMF77RNM     Dataset 1
         L     R14,=A(T77DFG)      SMF77DFG
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF77DFG),   SMF77DFG                            X
               MF=(E,W_WRK)
         MVC   W_JOB2,SMF77DO1     Resource owning job name 1
         MVC   W_JOB3,SMF77DO2     Resource owning job name 2
         MVC   W_JOB4,SMF77DW1     Resource waiting job name 1
         MVC   W_JOB5,SMF77DW2     Resource waiting job name 2
         MVC   W_MAJOR,SMF77QNM    Major enqueue name
         MVC   W_MINOR,SMF77RNM    Minor enqueue name
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'RLN=',SMF77RLN,1), Minimum resource contention time X
               MF=(E,W_WRK)
         ICM   R15,B'1111',SMF77WTM Minimum resource contention time
         SRL   R15,10              Convert 1024th into seconds
         STCM  R15,B'1111',SMF77WTM Minimum resource contention time
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'WTM=',SMF77WTM,4), Minimum resource contention time X
               MF=(E,W_WRK)
         ICM   R15,B'1111',SMF77WTX Maximum resource contention time
         SRL   R15,10              Convert 1024th into seconds
         STCM  R15,B'1111',SMF77WTX Maximum resource contention time
         MVC   W_WTX,SMF77WTX      Maximum resource contention time
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'WTX=',SMF77WTX,4), Maximum resource contention time X
               MF=(E,W_WRK)
         ICM   R15,B'1111',SMF77WTT Total resource contention time
         SRL   R15,10              Convert 1024th into seconds
         STCM  R15,B'1111',SMF77WTT Total resource contention time
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'WTT=',SMF77WTT,4), Total resource contention time   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'QL1=',SMF77QL1,2), Queue length of 1                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'QL2=',SMF77QL2,2), Queue length of 2                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'QL3=',SMF77QL3,2), Queue length of 3                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'QL4=',SMF77QL4,2), Queue length of 4                X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'EXM=',SMF77EXM,2), Minimum exclusive requests waitinX
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'EXX=',SMF77EXX,2), Maximum exclusive requests waitinX
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SHM=',SMF77SHM,2), Minimum share requests waiting   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SHX=',SMF77SHX,2), Maximum share requests waiting   X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'EVT=',SMF77EVT,2), Total interval contentions       X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DOW=',SMF77DOW,2), Owners at maximum contention     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'DWR=',SMF77DWR,2), Waiters at maximum contention    X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DO1=',SMF77DO1,8), Resource owning job name 1       X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SY1=',SMF77SY1,8), Resource owning system 1         X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DO2=',SMF77DO2,8), Resource owning job name 2       X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SY2=',SMF77SY2,8), Resource owning system 2         X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DW1=',SMF77DW1,8), Resource waiting job name 1      X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SY3=',SMF77SY3,8), Resource waiting system 1        X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DW2=',SMF77DW2,8), Resource waiting job name 2      X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SY4=',SMF77SY4,8), Resource waiting system 2        X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
E77DTAIN AH    R3,W_77EDL          Next enqueue data section
         $FILL W_SRTCMT,C' '       Blank comment area
         $FILL W_DSN1,C' '         Blank dataset 1
         LA    R15,W_SRTCMT        Initialize comment address
         ST    R15,W_CMT@          Initialize comment address
         BCT   R4,E77DTANX         Any more ?
         B     DAF0774             No, get out
         DROP  R3                  Enqueue data section dereference
DAF077   $EXIT                     Exit
         TITLE 'DAF078 - Extract SMF Record 78'
DAF078   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF78HDR,R3         SMF record reference
*
**       Subtype Selection
*
         CLC   SMF78STY,=AL2(03)   I/O Queuing Activity ?
         BE    EXT78T03            Yes
         B     DAF0784             Not subtype 3 - exit
*
**       Subtype 03 - I/O Queuing Activity
*
EXT78T03 EQU   *
         MVC   W_SMFOF1,SMF78QDS   Get IOQ global section offset
         DROP  R3                  SMF record dereference
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add IOQ global section offset
         USING R783GD,R3           IOQ global section reference
         MVC   W_JOB1,=CL008'RMF'  Job name
         MVC   W_USER,=CL008'RMF'  User identification
         MVC   W_DSN1,R783TNM      Dataset 1 - IODF name
         CALL  DAFMC,              Move Comment                        X
               (=C'TSF=',R783TSF,2), IODF name suffix                  X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TDT=',R783TDT,8), IODF creation date                X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TTM=',R783TTM,8), IODF creation time                X
               MF=(E,W_WRK)
         DROP  R3                  IOQ global section dereference
DAF078   $EXIT                     Exit
         TITLE 'DAF079 - Extract SMF Record 79'
DAF079   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF79HDR,R3         Header section reference
         MVC   W_SMFOF1,SMF79ASS   Data section offset
*
**       Subtype Selection
*
         CLC   SMF79STY,=AL2(06)   Reserve Data ?
         BE    EXT79T06            . Yes
         CLC   SMF79STY,=AL2(07)   Enqueue Contention Data ?
         BE    EXT79T07            . Yes
         CLC   SMF79STY,=AL2(11)   Page Data Set Activity ?
         BE    EXT79T11            . Yes
         B     DAF0794             Exit, no check
         DROP  R3                  Header section dereference
*
**       Subtype 06 - Reserve Data
*
EXT79T06 EQU   *
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add data section offset
         USING R796ELEM,R3         Data section reference
         MVC   W_MAJOR,R796MAJ     Major enqueue name
         MVC   W_MINOR,R796MIN     Minor enqueue name
         MVC   W_JOB1,R796JBN      Job name
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,R796VOLS,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'UCB=',R796UCB,3), UCB                               X
               MF=(E,W_WRK)
         B     DAF0790             Exit
         DROP  R3                  Data section reference
*
**       Subtype 07 - Enqueue Contention Data
*
EXT79T07 EQU   *
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add data section offset
         USING R797ELEM,R3         Data section reference
         MVC   W_MAJOR,R797MAJ     Major enqueue name
         MVC   W_MINOR,R797MIN     Minor enqueue name
         MVC   W_JOB1,R797JBN      Job name
         B     DAF0790             Exit
         DROP  R3                  Data section reference
*
**       Subtype 11 - Page Data Set Activity
*
EXT79T11 EQU   *
         L     R3,W_SMFBAS         Set SMF record base
         A     R3,W_SMFOF1         Add data section offset
         USING R79BELEM,R3         Data section reference
         MVC   W_JOB1,=CL008'RMF'  Job name
         MVC   W_USER,=CL008'RMF'  User identification
         MVC   W_MINOR,R79BDSN     Data set name
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,R79BVSER,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'UCB=',R79BDADR,3), UCB                              X
               MF=(E,W_WRK)
         B     DAF0790             Exit
         DROP  R3                  Data section reference
DAF079   $EXIT                     Exit
.NORMF1        ANOP
         AIF   ('&RT_RACFPROC' EQ '000').NORACFPROC1
         TITLE 'DAF080 - Extract SMF Record 80'
DAF080   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_80REL,SMF80REL    Save offset to relocate section
         MVC   W_80CNT,SMF80CNT    Save relocate sections
         MVC   W_JOB1,SMF80JBN     Job name
         MVC   W_USER,SMF80USR     User identification
         L     R14,=A(T80DES)      SMF80DES
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF80DES),   SMF80DES                            X
               MF=(E,W_WRK)
         L     R14,=A(T80EVENT)    Event code
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF80EVT),   Event code                          X
               MF=(E,W_WRK)
         L     R14,=A(T80QUAL)     Qualifier
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF80EVT),   Qualifier (Event code & qualifier)  X
               MF=(E,W_WRK)
         L     R14,=A(T80AUTH)     SMF80ATH
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF80ATH),   SMF80ATH                            X
               MF=(E,W_WRK)
         MVC   W_GROUP,SMF80GRP    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SEC=',SMF80SEC,8), Security label                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TERMINAL=',SMF80TRM,8), Terminal                    X
               MF=(E,W_WRK)
         L     R14,=A(T80REA)      SMF80REA
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF80REA),   SMF80REA                            X
               MF=(E,W_WRK)
         L     R14,=A(T80RE2)      SMF80RE2
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF80RE2),   SMF80RE2                            X
               MF=(E,W_WRK)
         LA    R3,SMF80FLG         Get SMF80FLG address
         DROP  R3                  SMF record dereference
         AH    R3,W_80REL          Add offset to relocate section
         USING SMF80DTP,R3         Relocate section reference
         LH    R4,W_80CNT          Relocate sections
         LTR   R4,R4               Any relocate sections ?
         BNP   DAF0804             No, get out
E80DTPNX XR    R5,R5               Clear length
         IC    R5,SMF80DLN         Length
         CLC   SMF80DTP,=AL1(1)    Resource name - type 1
         BE    E80DTP01            Yes - process it
         CLC   SMF80DTP,=AL1(3)    Access intent - type 3
         BE    E80DTP03            Yes - process it
         CLC   SMF80DTP,=AL1(4)    Access allowed - type 4
         BE    E80DTP04            Yes - process it
         CLC   SMF80DTP,=AL1(9)    Resource name - type 9
         BE    E80DTP09            Yes - process it
         CLC   SMF80DTP,=AL1(12)   Permit ID's - type 12
         BE    E80DTP12            Yes - process it
         CLC   SMF80DTP,=AL1(15)   Volume - type 15
         BE    E80DTP15            Yes - process it
         CLC   SMF80DTP,=AL1(17)   Class - type 17 ?
         BE    E80DTP17            Yes - process it
         CLC   SMF80DTP,=AL1(33)   Profile - type 33
         BE    E80DTP33            Yes - process it
         CLC   SMF80DTP,=AL1(49)    Name - type 49
         BE    E80DTP49            Yes - process it
         B     E80DTPIN            Next relocate section
E80DTP01 $VLM  W_DSN1,SMF80DTA,(R5) dataset 1
         B     E80DTPIN            Next relocate section
E80DTP03 L     R14,=A(T80AAR)      Access authority requested
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF80DTA),   Access authority requested          X
               MF=(E,W_WRK)
         B     E80DTPIN            Next relocate section
E80DTP04 L     R14,=A(T80AAA)      Access authority allowed
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF80DTA),   Access authority allowed            X
               MF=(E,W_WRK)
         B     E80DTPIN            Next relocate section
E80DTP09 $VLM  W_DSN1,SMF80DTA,(R5) dataset 1
         B     E80DTPIN            Next relocate section
E80DTP12 XR    R0,R0               Clear R0
         LA    R1,1(R5)            Length
         D     R0,=F'9'            Determine number of ID's
         LR    R7,R1               Number of ID's
         LA    R8,SMF80DTA         Input ID
E80NXT12 $FILL W_WRK,C' '          Clear work area
         LA    R15,W_WRK           Output ID
         MVC   0(8,R15),1(R8)      Move the ID
         LA    R8,9(R8)            Next input ID
         CALL  DAFMC,              Move Comment                        X
               (=C'ID=',W_WRK,128),   ID's                             X
               MF=(E,W_WRK)
         BCT   R7,E80NXT12         Next ID
         B     E80DTPIN            Next relocate section
E80DTP15 CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,SMF80DTA,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         B     E80DTPIN            Next relocate section
E80DTP17 CALL  DAFMC,              Move Comment                        X
               (=C'CLASS=',SMF80DTA,8), Class name                     X
               MF=(E,W_WRK)
         CLC   SMF80DTA(7),=CL007'DATASET' Dataset ?
         BNE   DAF0804             . No, skip
         B     E80DTPIN            Next relocate section
E80DTP33 LA    R3,1(,R3)           Skip flag byte
         $VLM  W_DSN2,SMF80DTA,(R5) Profile name
         BCTR  R3,0                Flag byte reset
         CALL  DAFMC,              Move Comment                        X
               (=C'PROFILE=',W_DSN2,44), Profile name                  X
               MF=(E,W_WRK)
         B     E80DTPIN            Next relocate section
E80DTP49 $VLM  W_NAME,SMF80DTA,(R5) Name
         $FILL W_TRT,X'00'         Blank TRT
         MVI   W_TRT+C' ',X'FF'    Blank TRT
E80TRT49 LA    R6,W_NAME           Keyword start
         $VLTRT (R6),W_TRT,(R5)    Blank ?
         BZ    E80CLI49            No - move name
         CLI   1(R1),C' '          Double blank ?
         BE    E80CLI49            Yes - move name
         MVI   0(R1),C'_'          Change blank to underscore
         B     E80TRT49            Check again
E80CLI49 CLI   W_NAME+19,C'_'      Last character underscore ?
         BNE   E80MVC49            No - move name
         MVI   W_NAME+19,C' '      Change last underscore to blank
E80MVC49 CALL  DAFMC,              Move Comment                        X
               (=C'NAME=',W_NAME,20), Name                             X
               MF=(E,W_WRK)
         B     E80DTPIN            Next relocate section
E80DTPIN XR    R1,R1               Clear
         IC    R1,SMF80DLN         Length
         AH    R1,=H'2'            SMF80DTP+SMF80DLN
         AR    R3,R1               Next Relocate section
         BCT   R4,E80DTPNX         Any more relocate sections ?
         CLI   W_DSN1,C' '         Blank ?
         BE    DAF0804             . Yes - Skip
         DROP  R3                  Relocate section dereference
DAF080   $EXIT                     Exit
.NORACFPROC1   ANOP
         AIF   ('&RT_RACFINIT' EQ '000').NORACFINIT1
         TITLE 'DAF081 - Extract SMF Record 81'
DAF081   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         MVC   W_81REL,SMF81REL    Save offset to relocate section
         MVC   W_81CNT,SMF81CNT    Save relocate sections
         MVC   W_JOB1,=CL008'RACF' Job name
         MVC   W_USER,=CL008'RACF' User identification
         MVC   W_DSN1,SMF81UDS     UADS dataset 1
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,SMF81UVL,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'UADS_Dataset',12), UADS DSN                X
               MF=(E,W_WRK)
         LA    R3,SMF81FLG         Get SMF81FLG address
         DROP  R3                  SMF record dereference
         AH    R3,W_81REL          Add offset to relocate section
         USING SMF81DTP,R3         Relocate section reference
         LH    R4,W_81CNT          Relocate sections
         LTR   R4,R4               Any relocate sections ?
         BNP   DAF0814             No, get out
E81DTPNX CLC   SMF81DTP,=AL1(30)   RACF dataset status - Type 30
         BNE   E81DTPIN            No, check next relocate section
         CALL  DAFCC               Check criteria
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,SMF81DTA+4,0,6), Process Volume Serials        X
               MF=(E,W_WRK)
         L     R14,=A(T81D30)      RACF dataset type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF81DTA),   RACF dataset type                   X
               MF=(E,W_WRK)
         $FILL W_DSN1,C' '         Blank out dataset 1
         XR    R1,R1               Clear length
         IC    R1,SMF81DLN         Length
         S     R1,=F'11'           DSN length minus 1
         $VLM  W_DSN1,SMF81DTA+11,(R1)  dataset 1
E81DTPIN XR    R1,R1               Clear
         IC    R1,SMF81DLN         Length
         AH    R1,=H'2'            SMF81DTP+SMF81DLN
         AR    R3,R1               Next Relocate section
         BCT   R4,E81DTPNX         Any more relocate sections ?
         DROP  R3                  Dereference relocate section
DAF081   $EXIT                     Exit
.NORACFINIT1   ANOP
         AIF   ('&RT_ICSF' EQ '000').NOICSF1
         TITLE 'DAF082 - Extract SMF Record 82'
**********************************************************************
*  Notes:          Only process subtypes 1, 7 & 8                    *
**********************************************************************
DAF082   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF82,R3            SMF record reference
*
**       Subtype Selection
*
         CLC   SMF82STY,=AL2(01)   Initialization ?
         BE    EXT82T01            Yes
         CLC   SMF82STY,=AL2(07)   KEU Key Part Entry ?
         BE    EXT82T07            Yes
         CLC   SMF82STY,=AL2(08)   CKDS Refresh ?
         BE    EXT82T08            Yes
         B     DAF0824             Not subtype 1, 7 or 8 - exit
*
**       Subtype 01 - Initialization
*
EXT82T01 EQU   *
         LA    R0,SMF82LNG         SMF basic section length
         AR    R3,R0               Set SMF Initialization
         USING SMF82INI,R3         Initialization reference
         MVC   W_JOB1,=CL008'ICSF' Job name - ICSF
         MVC   W_USER,=CL008'ICSF' User identification - ICSF
         MVC   W_DSN1,SMF82CKD     CKDS data set name
         L     R14,=A(T82VES)      SMF82VES
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF82VES),   SMF82VES                            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'IDO=',SMF82IDO,1), Crypto domain index              X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'ITE=',SMF82ITE,4), Trace entries                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'IML=',SMF82IML,4), Maximum data length              X
               MF=(E,W_WRK)
         B     DAF0820             Exit
*
**       Subtype 07 - KEU Key Part Entry
*
EXT82T07 EQU   *
         LA    R0,SMF82LNG         SMF basic section length
         AR    R3,R0               Set SMF KEU Key Part Entry
         USING SMF82KP,R3          KEU Key Part Entry reference
         MVC   W_JOB1,=CL008'ICSF' Job name - ICSF
         MVC   W_USER,=CL008'ICSF' User identification - ICSF
         MVC   W_DSN1,SMF82KCK     CKDS data set name
         CALL  DAFMC,              Move Comment                        X
               (=C'KV=',SMF82KV,8), Key part verification pattern      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'KKS=',SMF82KKS,1), KSU number                       X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'KDX=',SMF82KDX,1), Crypto domain index              X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'KCL=',SMF82KCL,24), CKDS entry being modified       X
               MF=(E,W_WRK)
         B     DAF0820             Exit
*
**       Subtype 08 - CKDS Refresh
*
EXT82T08 EQU   *
         LA    R0,SMF82LNG         SMF basic section length
         AR    R3,R0               Set CKDS Refresh
         USING SMF82REF,R3         CKDS Refresh reference
         MVC   W_JOB1,=CL008'ICSF' Job name - ICSF
         MVC   W_USER,=CL008'ICSF' User identification - ICSF
         MVC   W_DSN1,SMF82ROC     Old CKDS data set name
         CALL  DAFMC,              Move Comment                        X
               (=C'Old_CKDS=',SMF82ROC,44), Old CKDS data set name     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'New_CKDS=',SMF82RNC,44), New CKDS data set name     X
               MF=(E,W_WRK)
         MVC   W_CMTCLR,=C'N'      Do not clear comment area
         CALL  DAFCC               Check criteria
         MVC   W_DSN1,SMF82RNC     New CKDS data set name
         DROP  R3                  SMF record dereference
DAF082   $EXIT                     Exit
.NOICSF1       ANOP
         AIF   ('&RT_RACFAUDIT' EQ '000').NORACFAUDIT1
         TITLE 'DAF083 - Extract SMF Record 83'
DAF083   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMFRCD83,R3         SMF record reference
         A     R3,SMF83OD1         Offset to security section
         DROP  R3                  SMF record dereference
         USING SMF83DS1,R3         Security section reference
         MVC   W_HALF1,SMF83REL    Save offset to relocate section
         MVC   W_HALF2,SMF83CNT    Save relocate sections
         MVC   W_JOB1,SMF83JBN     Job name
         MVC   W_USER,SMF83USR     User identification
         L     R14,=A(T80DES)      SMF80DES
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF83DES),   SMF83DES                            X
               MF=(E,W_WRK)
         L     R14,=A(T80EVENT)    Event code
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF83EVT),   Event code                          X
               MF=(E,W_WRK)
         L     R14,=A(T80QUAL)     Qualifier
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF83EVT),   Qualifier (Event code & qualifier)  X
               MF=(E,W_WRK)
         L     R14,=A(T80AUTH)     SMF83ATH
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF83ATH),   SMF83ATH                            X
               MF=(E,W_WRK)
         MVC   W_GROUP,SMF83GRP    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SEC=',SMF83SEC,8), Security label                   X
               MF=(E,W_WRK)
         L     R14,=A(T80REA)      SMF83REA
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF83REA),   SMF83REA                            X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'TERMINAL=',SMF83TRM,8), Terminal                    X
               MF=(E,W_WRK)
         L     R14,=A(T80REA)      SMF80REA
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF83REA),   SMF80REA                            X
               MF=(E,W_WRK)
         L     R14,=A(T80RE2)      SMF80RE2
         CALL  DAFPT,              Process TM Table                    X
               ((R14),SMF83RE2),   SMF80RE2                            X
               MF=(E,W_WRK)
         DROP  R3                  Security section dereference
         L     R3,W_SMFBAS         Set SMF record base
         LA    R3,4(R3)            Get past record length/seg. desc.
         AH    R3,W_HALF1          Add offset to relocate section
         USING SMF83VAR,R3         Relocate section reference
         LH    R4,W_HALF2          Relocate sections
         LTR   R4,R4               Any relocate sections ?
         BNP   DAF0834             No, get out
E83DTPNX CLC   SMF83DTP,=AL1(62)   Dataset name - type 62
         BE    E83DTP62            Yes
         CLC   SMF83DTP,=AL1(63)   Link value - type 63
         BE    E83DTP63            Yes
         B     E83DTPIN            Next relocate section
E83DTP62 XR    R1,R1               Clear length
         IC    R1,SMF83DLN         Length
         $VLM  W_DSN1,SMF83DTA,(R1) dataset 1
         B     E83DTPIN            Next relocate section
E83DTP63 LA    R5,SMF83DTA         Link value address
         CALL  DAFMC,              Move Comment                        X
               (=C'LINK=',(R5),4), Link value                          X
               MF=(E,W_WRK)
         B     E83DTPIN            Next relocate section
E83DTPIN XR    R1,R1               Clear
         IC    R1,SMF83DLN         Length
         AH    R1,=H'2'            SMF83DTP+SMF83DLN
         AR    R3,R1               Next Relocate section
         BCT   R4,E83DTPNX         Any more relocate sections ?
         DROP  R3                  Relocate section dereference
DAF083   $EXIT                     Exit
.NORACFAUDIT1  ANOP
         TITLE 'DAF088 - Extract SMF Record 88'
DAF088   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         SMF record address
         USING SMFRCD88,R3         SMF record reference
*
**       Subtype Selection
*
         CLC   SMF88STP,=AL2(01)   Logstream activity ?
         BE    EXT88T01            . Yes
         B     DAF0884             Exit - No criteria check
*
**       Logstream activity
*
EXT88T01 EQU   *                   Logstream activity
         L     R4,W_SMFBAS         Address SMF record
         A     R4,SMF88LOF         Address log stream section
         USING SMF88LSD,R4         Log stream section reference
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF88EOF         Address events section
         USING SMF88ESD,R5         Events section reference
         L     R6,W_SMFBAS         Address SMF record
         A     R6,SMF88SOF         Address structure section
         USING SMF88SSD,R6         Structure section reference
         CLC   SMF88STN,=CL16'*DASDONLY*' DASD Only ?
         BNE   DAF0884             . No, exit - no check
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'STY=',SMF88STP,2), Subtype                          X
               MF=(E,W_WRK)
         MVC   W_LOGSTREAM,SMF88LSN Log stream name
         MVC   W_DSN1(26),SMF88LSN Log stream name
         CALL  DAFMC,              Move Comment                        X
               (=C'LOGSTREAM=',SMF88LSN),                              X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'STN=',SMF88STN),                                    X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
         DROP  R4                  Log stream section dereference
         DROP  R5                  Events section dereference
         DROP  R6                  Structure section dereference
         B     DAF0880             Exit
DAF088   $EXIT                     Exit
         TITLE 'DAF090 - Extract SMF Record 90'
DAF090   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         SMF record address
         USING SMFRCD90,R3         SMF record reference
         L     R4,W_SMFBAS         Address SMF record
         A     R4,SMF90POF         Address product section
         USING SMF90PRH,R4         product section reference
         MVC   W_JOB1,SMF90PNM     Job name
         MVC   W_USER,SMF90PNM     User identification
*
**       Subtype Selection
*
         CLC   SMF90TID,=AL2(05)   SET SMF ?
         BE    EXT90T5             Yes
         CLC   SMF90TID,=AL2(06)   Switch SMF ?
         BE    EXT90T6             Yes
         CLC   SMF90TID,=AL2(07)   Halt EOD ?
         BE    EXT90T7             Yes
         CLC   SMF90TID,=AL2(09)   IPL SMF ?
         BE    EXT90T9             Yes
         CLC   SMF90TID,=AL2(13)   SETSMF ?
         BE    EXT90T13            Yes
         CLC   SMF90TID,=AL2(15)   SET SMF (Restart SMF) ?
         BE    EXT90T15            Yes
         CLC   SMF90TID,=AL2(26)   IPL LOGREC ?
         BE    EXT90T26            Yes
         B     DAF0904             Exit - No criteria check
*
**       SET SMF, IPL SMF, SETSMF, SET SMF(to restart SMF)
*
EXT90T5  EQU   *                   SET SMF
EXT90T9  EQU   *                   IPL SMF
EXT90T13 EQU   *                   SETSMF
EXT90T15 EQU   *                   SET SMF (to restart SMF)
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF90DOF         Address data section
         USING SMF90T5,R5          Data section reference
         L     R6,W_SMFBAS         Address SMF record
         A     R6,SMF90ODA         Address data set section
         USING SMF90DSE,R6         Data set section reference
         LH    R7,SMF90NDA         Number of data set sections
         LTR   R7,R7               Any data set sections ?
         BNP   DAF0904             Exit - No criteria check
         L     R14,=A(T90TID)      Identifier
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF90TID),   Identifier                          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'Active_SMF_Recording_Dataset',28),         X
               MF=(E,W_WRK)
NXT90T5  LH    R1,SMF90LDA         Dataset length
         $VLM  W_DSN1,SMF90DSN,(R1) Dataset
         CALL  DAFCC               Check criteria
         L     R14,=A(T90TID)      Identifier
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF90TID),   Identifier                          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'Alternate_SMF_Recording_Dataset',31),      X
               MF=(E,W_WRK)
         AH    R6,SMF90LDA         Next DSN
         BCT   R7,NXT90T5          Any more ?
         B     DAF0904             Exit - No criteria check
*
**       Switch SMF, HALT EOD
*
EXT90T6  EQU   *                   Switch SMF
EXT90T7  EQU   *                   Halt EOD
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF90DOF         Address data section
         USING SMF90T6,R5          Data section reference
         CLI   SMF90SWO,C' '       Old DSN blank ?
         BE    E90SWN              Yes, check new DSN
         MVC   W_DSN1(10),SMF90SWO Old dataset 1
         L     R14,=A(T90TID)      Identifier
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF90TID),   Identifier                          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SWN=',SMF90SWN,10), New DSN                         X
               MF=(E,W_WRK)
         MVC   W_DSN2,SMF90SWN     New DSN
         CALL  DAFCC               Check criteria
E90SWN   EQU   *
         AIF   (NOT D'SMF90SND).NONEWDSN
         CLI   SMF90SND,C' '       New DSN blank ?
         BE    DAF0904             Yes, get out
         MVC   W_DSN1,SMF90SND     New dataset 1
         L     R14,=A(T90TID)      Identifier
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF90TID),   Identifier                          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SOD=',SMF90SOD), Old DSN                            X
               MF=(E,W_WRK)
         MVC   W_DSN2,SMF90SWO     Old DSN
         B     DAF0900             Return to caller
.NONEWDSN      ANOP
EXT90T26 EQU   *                   IPL LOGREC
         AIF   (NOT D'SMF90LOG).NOLOGREC
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF90DOF         Address data section
         USING SMF90T26,R5         Data section reference
         L     R14,=A(T90TID)      Identifier
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF90TID),   Identifier                          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'Original_Logrec_Dataset',23),              X
               MF=(E,W_WRK)
         MVC   W_DSN1,SMF90LOG     Dataset
         CALL  DAFCC               Check criteria
         L     R14,=A(T90TID)      Identifier
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF90TID),   Identifier                          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'New_Logrec_Dataset',18),                   X
               MF=(E,W_WRK)
         MVC   W_DSN1,SMF9026N     Dataset
         CALL  DAFCC               Check criteria
.NOLOGREC      ANOP
         B     DAF0904             Exit - No criteria check
         DROP  R3                  SMF record dereference
         DROP  R4                  Product section dereference
         DROP  R5                  Data section dereference
         DROP  R6                  Data set section dereference
DAF090   $EXIT                     Exit
         AIF   ('&RT_SMARTBATCH' EQ '000').NOSMARTBATCH1
         TITLE 'DAF091 - Extract SmartBatch Record'
DAF091   $ENTRY AMODE=31,RMODE=24 Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMFRCD91,R3         SMF record reference
*
**       Subtype Selection
*
         CLC   SMF91STP,=AL2(21)   Dataset Close ?
         BE    EXT91T21            . Yes
         B     DAF0914             Exit - No criteria check
*
**       Subtype 21 - Dataset Close
*
EXT91T21 EQU   *
         L     R4,W_SMFBAS         Address SMF record
         A     R4,SMF91GDO         Address general dataset section
         USING SMF91GD,R4          General dataset section reference
         MVC   W_DSN1,SMF91DSN     Dataset name
         MVC   W_DD,SMF91DDN       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'OPN=',SMF91OPN,8), Open time/date                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'OPN=',SMF91CLS,8), Close time/date                  X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
         DROP  R4                  General dataset section dereference
DAF091   $EXIT                     Exit
.NOSMARTBATCH1 ANOP
         AIF   ('&RT_USS' EQ '000').NOUSS1
         TITLE 'DAF092 - Extract SMF Record 92'
DAF092   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMFRCD92,R3         SMF record reference
*
**       Subtype Selection
*
         CLC   SMF92STP,=AL2(01)   File system mount
         BE    EXT92T01            Yes
         CLC   SMF92STP,=AL2(02)   File system quiesced
         BE    EXT92T02            Yes
         CLC   SMF92STP,=AL2(04)   File system unquiesced
         BE    EXT92T04            Yes
         CLC   SMF92STP,=AL2(05)   File system unmounted
         BE    EXT92T05            Yes
         CLC   SMF92STP,=AL2(06)   File system remounted
         BE    EXT92T06            Yes
         CLC   SMF92STP,=AL2(07)   File system move
         BE    EXT92T07            Yes
         B     DAF0924             Exit - No criteria check
*
**       Subtype 01 - File system mount
*
EXT92T01 EQU   *                   Subtype 01 - File system mount
         L     R4,W_SMFBAS         Address SMF record
         A     R4,SMF92IOF         Address identification section
         USING SMF92ID,R4          Identification section reference
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF92DOF         Address data section
         USING SMF92FSM,R5         Data section reference
         L     R6,W_SMFBAS         Address SMF record
         A     R6,SMF92MPF         Address path section
         USING SMF92FSP,R6         Path section reference
         MVC   W_JOB1,SMF92JBN     Job name
         MVC   W_USER,SMF92RUD     User identification
         MVC   W_DSN1,SMF92MFN     Dataset name 1
         MVC   W_DD,SMF92MDD       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         L     R14,=A(T92MFT)      FSType
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92MFT),   FSType                              X
               MF=(E,W_WRK)
         MVC   W_GROUP,SMF92RGD    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'MTN=',SMF92MTN,8), File system type name            X
               MF=(E,W_WRK)
         LH    R1,SMF92PPL         Path name length
         $VLM  W_DSN2,SMF92PPN,(R1) Path name
         CALL  DAFMC,              Move Comment                        X
               (=C'PATH=',W_DSN2,44), Path name                        X
               MF=(E,W_WRK)
         L     R14,=A(T92STP)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92STP),   Subtype                             X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'MBL=',SMF92MBL,4), File system block size           X
               MF=(E,W_WRK)
         DROP  R4                  Identification section dereference
         DROP  R5                  Data section dereference
         DROP  R6                  Path section dereference
         B     DAF0920             Exit - Criteria check
*
**       Subtype 02 - File system quiesced
*
EXT92T02 EQU   *                   Subtype 02 - File system quiesced
         L     R4,W_SMFBAS         Address SMF record
         A     R4,SMF92IOF         Address identification section
         USING SMF92ID,R4          Identification section reference
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF92DOF         Address data section
         USING SMF92FSS,R5         Data section reference
         MVC   W_JOB1,SMF92JBN     Job name
         MVC   W_USER,SMF92RUD     User identification
         MVC   W_DSN1,SMF92SFN     Dataset name 1
         MVC   W_DD,SMF92SDD       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         L     R14,=A(T92MFT)      FSType
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92SFT),   FSType                              X
               MF=(E,W_WRK)
         MVC   W_GROUP,SMF92RGD    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'STN=',SMF92STN,8), File system type name            X
               MF=(E,W_WRK)
         L     R14,=A(T92STP)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92STP),   Subtype                             X
               MF=(E,W_WRK)
         DROP  R4                  Identification section dereference
         DROP  R5                  Data section dereference
         B     DAF0920             Exit - Criteria check
*
**       Subtype 04 - File system unquiesced
*
EXT92T04 EQU   *                   Subtype 04 - File system unquiesced
         L     R4,W_SMFBAS         Address SMF record
         A     R4,SMF92IOF         Address identification section
         USING SMF92ID,R4          Identification section reference
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF92DOF         Address data section
         USING SMF92FSR,R5         Data section reference
         MVC   W_JOB1,SMF92JBN     Job name
         MVC   W_USER,SMF92RUD     User identification
         MVC   W_DSN1,SMF92RFN     Dataset name 1
         MVC   W_DD,SMF92RDD       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         L     R14,=A(T92MFT)      FSType
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92RFT),   FSType                              X
               MF=(E,W_WRK)
         MVC   W_GROUP,SMF92RGD    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RTN=',SMF92RTN,8), File system type name            X
               MF=(E,W_WRK)
         L     R14,=A(T92STP)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92STP),   Subtype                             X
               MF=(E,W_WRK)
         DROP  R4                  Identification section dereference
         DROP  R5                  Data section dereference
         B     DAF0920             Exit - Criteria check
*
**       Subtype 05 - File system unmounted
**       Subtype 06 - File system remounted
*
EXT92T05 EQU   *                   Subtype 05 - File system unmounted
EXT92T06 EQU   *                   Subtype 06 - File system remounted
         L     R4,W_SMFBAS         Address SMF record
         A     R4,SMF92IOF         Address identification section
         USING SMF92ID,R4          Identification section reference
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF92DOF         Address data section
         USING SMF92FSU,R5         Data section reference
         MVC   W_JOB1,SMF92JBN     Job name
         MVC   W_USER,SMF92RUD     User identification
         MVC   W_DSN1,SMF92UFN     Dataset name 1
         MVC   W_DD,SMF92UDD       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         L     R14,=A(T92MFT)      FSType
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92UFT),   FSType                              X
               MF=(E,W_WRK)
         MVC   W_GROUP,SMF92RGD    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'UTN=',SMF92UTN,8), File system type name            X
               MF=(E,W_WRK)
         L     R14,=A(T92STP)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92STP),   Subtype                             X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'UBL=',SMF92UBL,4), File system block size           X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'USR=',SMF92USR,4), File system read calls           X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'USW=',SMF92USW,4), File system write calls          X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'UDI=',SMF92UDI,4), File system directory blocks     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'UIR=',SMF92UIR,4), File system i/o blocks read      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'UIW=',SMF92UIW,4), File system i/o blocks written   X
               MF=(E,W_WRK)
         DROP  R4                  Identification section dereference
         DROP  R5                  Data section dereference
         B     DAF0920             Exit - Criteria check
*
**       Subtype 07 - File system move
*
EXT92T07 EQU   *                   Subtype 07 - File system move
         L     R4,W_SMFBAS         Address SMF record
         A     R4,SMF92IOF         Address identification section
         USING SMF92ID,R4          Identification section reference
         L     R5,W_SMFBAS         Address SMF record
         A     R5,SMF92DOF         Address data section
         USING SMF92FSV,R5         Data section reference
         MVC   W_JOB1,SMF92JBN     Job name
         MVC   W_USER,SMF92RUD     User identification
         MVC   W_DSN1,SMF92VNM     Dataset name 1
         MVC   W_DD,SMF92VDD       Data definition name
         CALL  DAFMC,              Move Comment                        X
               (=C'DD=',W_DD,8), Data definition name                  X
               MF=(E,W_WRK)
         L     R14,=A(T92MFT)      FSType
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92VFT),   FSType                              X
               MF=(E,W_WRK)
         MVC   W_GROUP,SMF92RGD    Group
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',W_GROUP,8), Group                           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'UTN=',SMF92VTN,8), File system type name            X
               MF=(E,W_WRK)
         L     R14,=A(T92STP)      Subtype
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF92STP),   Subtype                             X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'VBL=',SMF92VBL,4), File system block size           X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'VSR=',SMF92VSR,4), File system read calls           X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'VSW=',SMF92VSW,4), File system write calls          X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'VDI=',SMF92VDI,4), File system directory blocks     X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'VIR=',SMF92VIR,4), File system I/O blocks read      X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'VIW=',SMF92VIW,4), File system I/O blocks written   X
               MF=(E,W_WRK)
         DROP  R4                  Identification section dereference
         DROP  R5                  Data section dereference
         B     DAF0920             Exit - Criteria check
DAF092   $EXIT                     Exit
         DROP  R3                  SMF record dereference
.NOUSS1        ANOP
         AIF   ('&RT_TCPIP' EQ '000').NOTCPIP1
         TITLE 'DAF118 - Extract SMF Record 118'
DAF118   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
*
**       Subtype Selection
*
         CLC   SMFXXSTY,=AL2(03)   FTP Client
         BE    EXT76T03            Yes
         CLC   SMFXXSTY,=AL2(70)   FTP Server - APPEND
         BE    EXT76T70            Yes
         CLC   SMFXXSTY,=AL2(71)   FTP Server - DELETE
         BE    EXT76T71            Yes
         CLC   SMFXXSTY,=AL2(72)   FTP Server - Login Failure
         BE    EXT76T72            Yes
         CLC   SMFXXSTY,=AL2(73)   FTP Server - RENAME
         BE    EXT76T73            Yes
         CLC   SMFXXSTY,=AL2(74)   FTP Server - RETRIEVE
         BE    EXT76T74            Yes
         CLC   SMFXXSTY,=AL2(75)   FTP Server - STORE / STORE UNIQUE
         BE    EXT76T75            Yes
         CLC   SMFXXSTY,=AL2(&ST_FTP) FTP Server - Hardcoded Subtype
         BE    EXT76THC            Yes
         B     DAF1184             Exit - No criteria check
         DROP  R3                  SMF record dereference
*
**       Subtype FTP
*
EXT76T03 EQU   *                   FTP Client
EXT76T70 EQU   *                   FTP Server - APPEND
EXT76T71 EQU   *                   FTP Server - DELETE
EXT76T72 EQU   *                   FTP Server - Login Failure
EXT76T73 EQU   *                   FTP Server - RENAME
EXT76T74 EQU   *                   FTP Server - RETRIEVE
EXT76T75 EQU   *                   FTP Server - STORE / STORE UNIQUE
EXT76THC EQU   *                   FTP Server - Hardcoded Subtype
         L     R3,W_SMFBAS         Address SMF record
         USING SMFFTP76,R3         SMF record reference
         CLI   SMFFTDSN,C' '       DSN blank ?
         BE    DAF1184             Yes, get out
         MVC   W_JOB1,SMFFTSTC     Job name
         MVC   W_USER,SMFFTPSU     User identification
         MVC   W_DSN1,SMFFTDSN     Dataset name 1
         CLC   SMFFTMEM,=CL008' '  Member present ?
         BE    E76NOMEM            No
         MVC   W_MEMBER,SMFFTMEM   Member name
         CALL  DAFMC,              Move Comment                        X
               (=C'MEMBER=',W_MEMBER,8), Member name                   X
               MF=(E,W_WRK)
E76NOMEM EQU   *
         CALL  DAFMC,              Move Comment                        X
               (=C'PCM=',SMFFTPCM,4), FTP Subcommand                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'PTY=',SMFFTPTY,4), File system type name            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'PSA=',SMFFTPSA+0,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSA+1,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSA+2,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSA+3,1), FTP IP address                 X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'PSL=',SMFFTPSL+0,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSL+1,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSL+2,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSL+3,1), FTP IP address                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'PCF=',SMFFTPCF,2), File system type name            X
               MF=(E,W_WRK)
         L     R14,=A(TFTPFM)      FTP data format
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPFM),   FTP data format                     X
               MF=(E,W_WRK)
         L     R14,=A(TFTPMO)      FTP mode
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPMO),   FTP mode                            X
               MF=(E,W_WRK)
         L     R14,=A(TFTPST)      FTP structure
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPST),   FTP structure                       X
               MF=(E,W_WRK)
         L     R14,=A(TFTPDT)      FTP dataset type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPDT),   FTP dataset type                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'TBC=',SMFFTTBC,4), FTP byte count of transmission   X
               MF=(E,W_WRK)
         L     R14,=A(TFTPXD)      FTP id
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPXD),   FTP id                              X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SLR=',SMFFTSLR,3), FTP server - last reply          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RS2=',SMFFTRS2,8), FTP server - abnormal end info   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'MEM=',SMFFTMEM,8), FTP member name                  X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'MM2=',SMFFTMM2,8), FTP second member name           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'HST=',SMFFTHST,8), FTP TCPIP host name              X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SRP=',SMFFTSRP,2), FTP server remote port number    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SLP=',SMFFTSLP,2), FTP server local port number     X
               MF=(E,W_WRK)
         CLC   SMFFTPCM(3),=CL003'REN' Rename ?
         BNE   E76NOREN            No
         MVC   W_DSN2,SMFFTDS2     Dataset name 2
         CALL  DAFMC,              Move Comment                        X
               (=C'DS2=',SMFFTDS2,44), FTP second dataset name         X
               MF=(E,W_WRK)
         CALL  DAFCC               Check criteria
         L     R3,W_SMFBAS         Address SMF record
         USING SMFFTP76,R3         SMF record reference
         MVC   W_JOB1,SMFFTSTC     Job name
         MVC   W_USER,SMFFTPSU     User identification
         MVC   W_DSN1,SMFFTDS2     Dataset name 2
         CLC   SMFFTMEM,=CL008' '  Member present ?
         BE    E76NOMEM2           No
         MVC   W_MEMBER,SMFFTMEM   Member name
         CALL  DAFMC,              Move Comment                        X
               (=C'MEMBER=',W_MEMBER,8), Member name                   X
               MF=(E,W_WRK)
E76NOMEM2 EQU   *
         CALL  DAFMC,              Move Comment                        X
               (=C'PCM=',SMFFTPCM,4), FTP Subcommand                   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'PTY=',SMFFTPTY,4), File system type name            X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'PSA=',SMFFTPSA+0,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSA+1,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSA+2,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSA+3,1), FTP IP address                 X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'PSL=',SMFFTPSL+0,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSL+1,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSL+2,1), FTP IP address                 X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMC,              Move Comment                        X
               (=C'NONE',=C'.',1), FTP IP address                      X
               MF=(E,W_WRK)
         $DECR W_CMT@              Comment address
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'NONE',SMFFTPSL+3,1), FTP IP address                 X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'PCF=',SMFFTPCF,2), File system type name            X
               MF=(E,W_WRK)
         L     R14,=A(TFTPFM)      FTP data format
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPFM),   FTP data format                     X
               MF=(E,W_WRK)
         L     R14,=A(TFTPMO)      FTP mode
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPMO),   FTP mode                            X
               MF=(E,W_WRK)
         L     R14,=A(TFTPST)      FTP structure
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPST),   FTP structure                       X
               MF=(E,W_WRK)
         L     R14,=A(TFTPDT)      FTP dataset type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPDT),   FTP dataset type                    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'TBC=',SMFFTTBC,4), FTP byte count of transmission   X
               MF=(E,W_WRK)
         L     R14,=A(TFTPXD)      FTP id
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFFTPXD),   FTP id                              X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'SLR=',SMFFTSLR,3), FTP server - last reply          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RS2=',SMFFTRS2,8), FTP server - abnormal end info   X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'MEM=',SMFFTMEM,8), FTP member name                  X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'MM2=',SMFFTMM2,8), FTP second member name           X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'HST=',SMFFTHST,8), FTP TCPIP host name              X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SRP=',SMFFTSRP,2), FTP server remote port number    X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'SLP=',SMFFTSLP,2), FTP server local port number     X
               MF=(E,W_WRK)
         MVC   W_DSN2,SMFFTDSN     Dataset name 1
         CALL  DAFMC,              Move Comment                        X
               (=C'DSN=',SMFFTDSN,44), FTP second dataset name         X
               MF=(E,W_WRK)
E76NOREN EQU   *
         DROP  R3                  SMF record dereference
DAF118   $EXIT                     Exit
.NOTCPIP1      ANOP
         AIF   ('&RT_TCPIPX' EQ '000').NOTCPIPX1
         TITLE 'DAF119 - Extract SMF Record 119'
DAF119   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMF119Header,R3     SMF record reference
*
**       Subtype Selection
*
         CLC   SMF119HDSubType,=AL2(03) FTP Client Transfer ?
         BE    X119FTPC            . Yes
         CLC   SMF119HDSubType,=AL2(70) FTP Server Transfer ?
         BE    X119FTPS            . Yes
         B     DAF1194             Exit - No criteria check
         DROP  R3                  SMF record dereference
*
**       Subtype FTP Client Transfer Completion
*
X119FTPC EQU   *                   FTP Client Transfer Completion
         L     R4,W_SMFBAS         Address SMF record
         A     R4,28(R4)           Address TCPIP id section
         USING SMF119Ident,R4      TCPIP id section reference
         L     R5,W_SMFBAS         Address SMF record
         A     R5,36(R5)           Address FTP client section
         USING SMF119FT_FC,R5      FTP client section reference
         L     R6,W_SMFBAS         Address SMF record
         LH    R7,48(R6)           FTP client name length
         A     R6,44(R6)           Address FTP client name section
         USING SMF119FT_FCAN,R6    FTP client name section reference
         $VLM  W_DSN1,SMF119FT_FCFileName,(R7) Dataset 1
         MVC   W_JOB1,SMF119TI_ASName Job name
         MVC   W_USER,SMF119TI_UserID User identification
         CLC   SMF119FT_FCM1,=CL008' ' Member present ?
         BE    X119NMEM               . No
         MVC   W_MEMBER,SMF119FT_FCM1 Member name
         CALL  DAFMC,              Move Comment                        X
               (=C'MEMBER=',W_MEMBER,8), Member name                   X
               MF=(E,W_WRK)
X119NMEM EQU   *
         CALL  DAFMC,              Move Comment                        X
               (=C'CMD=',SMF119FT_FCCmd,4), FTP command                X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'FT=',SMF119FT_FCFType,4), Local file type           X
               MF=(E,W_WRK)
         L     R14,=A(TFTPFM)      FTP data format
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF119FT_FCType), Data format                    X
               MF=(E,W_WRK)
         L     R14,=A(TFTPMO)      FTP mode
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF119FT_FCMode), Transfer mode                  X
               MF=(E,W_WRK)
         L     R14,=A(TFTPST)      FTP structure
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF119FT_FCStruct), Structure                    X
               MF=(E,W_WRK)
         L     R14,=A(TFTPDT)      FTP dataset type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF119FT_FCDsType), Dataset type                 X
               MF=(E,W_WRK)
         CALL  DAFMB,              Move Binary Comment                 X
               (=C'TBC=',SMF119FT_FCBytes,8), Transmission byte count  X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'LR=',SMF119FT_FCLReply,4), Last server reply        X
               MF=(E,W_WRK)
         L     R14,=A(CTFTPSRC)    FTP Server Reply Code
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMF119FT_FCLReply), FTP Server Reply Code        X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RS=',SMF119FT_FCRS,8), Abnormal end info            X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'HN=',SMF119FT_FCHostname,8), Host name              X
               MF=(E,W_WRK)
         B     DAF1190             Exit
         DROP  R4                  TCPIP id section dereference
         DROP  R5                  FTP client section dereference
         DROP  R6                  FTP client name section dereference
*
**       Subtype FTP Server Transfer Completion
*
X119FTPS EQU   *                   FTP Server Transfer Completion
         B     DAF1194             Exit - No criteria check
*        DROP  R3                  SMF record dereference
DAF119   $EXIT                     Exit
.NOTCPIPX1     ANOP
         AIF   ('&RT_HSMFSR' EQ '000').NOHSMFSR1
         TITLE 'HSMFSR - Extract DFSMShsm SMF FSR Record'
**********************************************************************
*  Notes:          If full volume dump hex zeroes dsn - bypass       *
**********************************************************************
HSMFSR   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING D_SMFREC,R3         SMF record reference
         CLC   FSRTYPE,=AL1(13)    Full volume dump ?
         BNE   HSMFSRNOC           . No, do not check for valid dsn
         CLC   FSRDSN,=44X'00'     DSN null ?
         BE    HSMFSR4             . Yes, bypass the record
HSMFSRNOC EQU   *
         MVC   W_DSN1,FSRDSN       Dataset name
         MVC   W_JOB1,FSRJBN       Job name
         MVC   W_USER,FSRUID       User identification
         L     R14,=A(HSMTYPE)     Type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),FSRTYPE),    Type                                X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',FSRGRP,8), Group name                       X
               MF=(E,W_WRK)
         MVC   W_VOL1,FSRFVOL      From volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'FVOL=',W_VOL1,6), From volume serial                X
               MF=(E,W_WRK)
         MVC   W_VOL2,FSRTVOL      To volume serial
         CALL  DAFMC,              Move Comment                        X
               (=C'TVOL=',W_VOL2,6), To volume serial                  X
               MF=(E,W_WRK)
         CALL  DAFDSORG,           Process DSORG                       X
               (FSRDORG,W_DSORG),                                      X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DSORG=',W_DSORG,3), DSORG                           X
               MF=(E,W_WRK)
         CALL  DAFRECFM,           RECFM                               X
               (FSRRECFM,W_RECFM),                                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'RECFM=',W_RECFM),  RECFM                            X
               MF=(E,W_WRK)
         MVC   W_STORCLAS,FSRSCNAM Storage class name
         CALL  DAFMC,              Move Comment                        X
               (=C'STORCLAS=',W_STORCLAS,8),        Storage class name X
               MF=(E,W_WRK)
         MVC   W_MGMTCLAS,FSRMCNAM Management class name
         CALL  DAFMC,              Move Comment                        X
               (=C'MGMTCLAS=',W_MGMTCLAS,8),     Management class name X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
HSMFSR   $EXIT                     Exit
.NOHSMFSR1     ANOP
         AIF   ('&RT_RMMAUD' EQ '000').NORMMAUD1
         TITLE 'RMMAUD - Extract DFSMSrmm SMF Audit Record'
**********************************************************************
*  Notes:          If changed volume blank dsn - bypass              *
**********************************************************************
RMMAUD   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMFAR,R3            SMF record reference
         MVC   W_JOB1,SMFADJBN     Job name
         MVC   W_USER,SMFADUID     User identification
         L     R14,=A(RMMAUDAT)    Activity Type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFADACT),   Activity Type                       X
               MF=(E,W_WRK)
*
**       Subtype Selection
*
         CLI   SMFADREC,MDTYPEID   Dataset information ?
         BE    RMMAUDD             . Yes
         CLI   SMFADREC,MKTYPEID   VRS information ?
         BE    RMMAUDK             . Yes
         CLI   SMFADREC,MVTYPEID   Volume information ?
         BE    RMMAUDV             . Yes
         B     RMMAUD4             . No, exit - bypass the record
*
**       Subtype - Dataset information
*
RMMAUDD  EQU   *
         LA    R4,SMFADREC         Dataset information address
         USING MDREC,R4            Dataset information reference
         MVC   W_DSN1,MDDSNAME     Dataset name
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,MDVOLSER,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         MVC   W_MGMTCLAS,MDACSMC  Management class name
         CALL  DAFMC,              Move Comment                        X
               (=C'MGMTCLAS=',W_MGMTCLAS,8),     Management class name X
               MF=(E,W_WRK)
         MVC   W_STORCLAS,MDACSSC  Storage class name
         CALL  DAFMC,              Move Comment                        X
               (=C'STORCLAS=',W_STORCLAS,8),        Storage class name X
               MF=(E,W_WRK)
         MVC   W_DATACLAS,MDACSDC  Data class name
         CALL  DAFMC,              Move Comment                        X
               (=C'DATACLAS=',W_DATACLAS,8),           Data class name X
               MF=(E,W_WRK)
         DROP  R4                  Dataset information dereference
         B     RMMAUD0             Exit
*
**       Subtype - VRS information
*
RMMAUDK  EQU   *
         LA    R4,SMFADREC         VRS information address
         USING MKREC,R4            VRS information reference
         DROP  R4                  VRS information dereference
         B     RMMAUD0             Exit
*
**       Subtype - Volume information
*
RMMAUDV  EQU   *
         LA    R4,SMFADREC         Volume information address
         USING MVREC,R4            Volume information reference
         CLI   SMFADACT,C'C'       Record changed ?
         BNE   RMMAUDVNOC          . No, do not check for valid dsn
         CLC   MVDSN1,=CL044' '    First dataset name on tape blank ?
         BE    RMMAUD4             . Yes, exit - bypass the record
         CLC   MVDSNL,=CL044' '    Last dataset name on tape blank ?
         BE    RMMAUD4             . Yes, exit - bypass the record
RMMAUDVNOC EQU   *
         MVC   W_DSN1,MVDSN1       First dataset name on tape
         MVC   W_DSN2,MVDSNL       Last dataset name on tape
         CALL  DAFMC,              Move Comment                        X
               (=C'DSNL=',MVDSNL,44), Last dataset name on tape        X
               MF=(E,W_WRK)
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,MVVOLSER,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         DROP  R4                  Volume information dereference
         B     RMMAUD0             Exit
         DROP  R3                  SMF record dereference
RMMAUD   $EXIT                     Exit
.NORMMAUD1     ANOP
         AIF   ('&RT_RMMSEC' EQ '000').NORMMSEC1
         TITLE 'RMMSEC - Extract DFSMSrmm SMF Security Record'
RMMSEC   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,W_SMFBAS         Set SMF record base
         USING SMFSR,R3            SMF record reference
         MVC   W_DSN1,SMFSADSN     Dataset name
         MVC   W_JOB1,SMFSAJBN     Job name
         MVC   W_USER,SMFSAUID     User identification
         CALL  DAFPV,              Process Volume Serials              X
               (=F'1',4,SMFSAVOL,0,6), Process Volume Serials          X
               MF=(E,W_WRK)
         L     R14,=A(RMMSECAT)    Activity Type
         CALL  DAFPC,              Process Compare Table               X
               ((R14),SMFSAACT),   Activity Type                       X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'GROUP=',SMFSACGP,8), Group name                     X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'STP=',SMFSASTP,8), Security Type                    X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'UNT=',SMFSAUNT,8), Device Type                      X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'DSQ=',SMFSADSQ,8), Dataset Sequence Number          X
               MF=(E,W_WRK)
         CALL  DAFMC,              Move Comment                        X
               (=C'VSQ=',SMFSAVSQ,8), Volume Sequence Number           X
               MF=(E,W_WRK)
         DROP  R3                  SMF record dereference
RMMSEC   $EXIT                     Exit
.NORMMSEC1     ANOP
         TITLE 'DSOTYP - Process DSORG in SMF6XTYP'
**********************************************************************
*  Input:          Parameter list pointed to by R1                   *
*                  . 00(R1) - SMF6XTYP address (R3)                  *
*                  . 04(R1) - DSORG address    (R4)                  *
*  Output:         DSORG value moved to DSORG address                *
**********************************************************************
DSOTYP   $ENTRY AMODE=31,RMODE=24  Entry
         L     R3,0(R1)            SMF6XTYP address
         L     R4,4(R1)            DSORG address
         CLI   0(R3),C'A'          NONVSAM ?
         BE    DSOTYPX             . Yes - exit
         MVC   0(3,R4),=CL003'VS ' VSAM
DSOTYP   $EXIT                     Exit
         TITLE 'SMFSNAP - SNAP current SMF Record'
SMFSNAP  $ENTRY AMODE=31,RMODE=24  Entry
         L     R14,W_SMFBAS        Set SMF record base
         USING D_SMFREC,R14        SMF record reference
         XR    R3,R3               Clear
         LH    R3,SMFXXLEN         SMF record length
         DROP  R14                 SMF record reference
         L     R0,W_SMFSNAP        SMF SNAP storage address
         LR    R1,R3               SMF record length
         L     R14,W_SMFBAS        SMF record address
         LR    R15,R3              SMF record length
         MVCL  R0,R14              Copy SMF record
         L     R14,W_SMFSNAP       SMF SNAP storage address
         BCTR  R3,0                Decrement length
         AR    R3,R14              Determine SMF record ending address
         LR    R15,R3              Determine SMF record ending address
         MVC   W_STRHDR,=AL1(100)  SNAP storage header length
         MVC   W_SNAP(L_SNAP),T_SNAP Copy SNAP parameter list
         SNAP  DCB=DAFSNAP,STORAGE=((R14),(R15)),STRHDR=W_STRHDR,      X
               MF=(E,W_SNAP)
         LTR   R15,R15             OK ?
         BZ    SMFSNAPX            . Yes
         MVC   W_WTO(L_WTO),T_WTO  Copy WTO parameter list template
         MVC   W_WTOMSG,T_DAF801   Copy WTO message
         $HEX  W_WTOMSG+35,(R15),LEN=8 Return code
         MVC   W_WTOMSG+44(4),=CL004'SNAP' System macro name
         WTO   MF=(E,W_WTO)        Issue WTO
         ABEND 801,DUMP            User abend 801 (U0801)
SMFSNAP  $EXIT                     Exit
         TITLE 'Tables'
*
**       Dataset Name Table
*
TBLDSN   CSECT
         DC    256X'FF'            Assume all characters are invalid
         ORG   TBLDSN+C' ' x'40'   Blank ( ) is valid
         DC    1X'00'      x'40'   Blank ( ) is valid
         ORG   TBLDSN+C'.' x'4B'   Period (.) is valid
         DC    1X'00'      x'4B'   Period (.) is valid
         ORG   TBLDSN+C'$' x'5B'   Dollar sign ($) is valid
         DC    1X'00'      x'5B'   Dollar sign ($) is valid
         ORG   TBLDSN+C'*' x'5C'   Asterisk (*) is valid (RACF)
         DC    1X'00'      x'5C'   Asterisk (*) is valid (RACF)
         ORG   TBLDSN+C'-' x'60'   Dash (-) is valid (VSAM CATALOG)
         DC    1X'00'      x'60'   Dash (-) is valid (VSAM CATALOG)
         ORG   TBLDSN+C'/' x'61'   Slash (/) is valid (USS)
         DC    1X'00'      x'61'   Slash (/) is valid (USS)
         ORG   TBLDSN+C'%' x'6C'   Percent sign (%) is valid (RACF)
         DC    1X'00'      x'6C'   Percent sign (%) is valid (RACF)
         ORG   TBLDSN+C'_' x'6D'   Underscore (_) is valid (UNIX)
         DC    1X'00'      x'6D'   Underscore (_) is valid (UNIX)
         ORG   TBLDSN+C'?' x'6F'   Question mark (?) is valid (JES2)
         DC    1X'00'      x'6F'   Question mark (?) is valid (JES2)
         ORG   TBLDSN+C'#' x'7B'   Pound sign (#) is valid
         DC    1X'00'      x'7B'   Pound sign (#) is valid
         ORG   TBLDSN+C'@' x'7C'   At sign (@) is valid
         DC    1X'00'      x'7C'   At sign (@) is valid
         ORG   TBLDSN+C'a' x'8x'   Lowercase (abcdefghi) are valid
         DC    9X'00'      x'8x'   Lowercase (abcdefghi) are valid
         ORG   TBLDSN+C'j' x'9x'   Lowercase (jklmnopqr) are valid
         DC    9X'00'      x'9x'   Lowercase (jklmnopqr) are valid
         ORG   TBLDSN+C's' x'Ax'   Lowercase (stuvwxyz) are valid
         DC    8X'00'      x'Ax'   Lowercase (stuvwxyz) are valid
         ORG   TBLDSN+C'A' x'Cx'   Uppercase (ABCDEFGHI) are valid
         DC    9X'00'      x'Cx'   Uppercase (ABCDEFGHI) are valid
         ORG   TBLDSN+C'J' x'Dx'   Uppercase (JKLMNOPQR) are valid
         DC    9X'00'      x'Dx'   Uppercase (JKLMNOPQR) are valid
         ORG   TBLDSN+C'S' x'Ex'   Uppercase (STUVWXYZ) are valid
         DC    8X'00'      x'Ex'   Uppercase (STUVWXYZ) are valid
         ORG   TBLDSN+C'0' x'Fx'   Numbers (0123456789) are valid
         DC    10X'00'     x'Fx'   Numbers (0123456789) are valid
*
**       Hexadecimal Table
*
TBLHEX   CSECT
         DC    256X'00'            Assume all characters are invalid
         ORG   TBLHEX+X'F0'        0 is valid
         DC    1X'F0'              0 is valid
         ORG   TBLHEX+X'F1'        1 is valid
         DC    1X'F1'              1 is valid
         ORG   TBLHEX+X'F2'        2 is valid
         DC    1X'F2'              2 is valid
         ORG   TBLHEX+X'F3'        3 is valid
         DC    1X'F3'              3 is valid
         ORG   TBLHEX+X'F4'        4 is valid
         DC    1X'F4'              4 is valid
         ORG   TBLHEX+X'F5'        5 is valid
         DC    1X'F5'              5 is valid
         ORG   TBLHEX+X'F6'        6 is valid
         DC    1X'F6'              6 is valid
         ORG   TBLHEX+X'F7'        7 is valid
         DC    1X'F7'              7 is valid
         ORG   TBLHEX+X'F8'        8 is valid
         DC    1X'F8'              8 is valid
         ORG   TBLHEX+X'F9'        9 is valid
         DC    1X'F9'              9 is valid
         ORG   TBLHEX+X'FA'        A is valid
         DC    1X'C1'              A is valid
         ORG   TBLHEX+X'FB'        B is valid
         DC    1X'C2'              B is valid
         ORG   TBLHEX+X'FC'        C is valid
         DC    1X'C3'              C is valid
         ORG   TBLHEX+X'FD'        D is valid
         DC    1X'C4'              D is valid
         ORG   TBLHEX+X'FE'        E is valid
         DC    1X'C5'              E is valid
         ORG   TBLHEX+X'FF'        F is valid
         DC    1X'C6'              F is valid
*
**       Keyword Table
*
TBLKWD   CSECT                     Keyword table
         $KWD  CATALOG,                                                X
               T=DATASET,                                              X
               LENGTH=44,                                              X
               O1=O_CATALOG,                                           X
               FORMAT=C,                                               X
               D='Catalog name',                                       X
               ALIAS1=CAT
L_TBLKWD EQU   *-TBLKWD            Keyword table entry length
         $KWD  DATACLAS,                                               X
               T=GENERAL,                                              X
               LENGTH=8,                                               X
               O1=O_DATACLAS,                                          X
               FORMAT=C,                                               X
               D='Data class name',                                    X
               ALIAS1=DATACLASS
         $KWD  DATE,                                                   X
               T=GENERAL,                                              X
               LENGTH=7,                                               X
               O1=O_DATE,                                              X
               FORMAT=C,                                               X
               D='Date - yyyyddd'
         $KWD  DDNAME,                                                 X
               T=DATASET,                                              X
               LENGTH=8,                                               X
               O1=O_DD,                                                X
               FORMAT=C,                                               X
               D='Data definition name',                               X
               ALIAS1=DDN,                                             X
               ALIAS2=DD
         $KWD  DSNAME,                                                 X
               T=GENERAL,                                              X
               LENGTH=44,                                              X
               O1=O_DSN1,                                              X
               O2=O_DSN2,                                              X
               FORMAT=C,                                               X
               D='Dataset name',                                       X
               ALIAS1=DATASET,                                         X
               ALIAS2=DSN
         $KWD  DSORG,                                                  X
               T=GENERAL,                                              X
               LENGTH=3,                                               X
               O1=O_DSORG,                                             X
               FORMAT=C,                                               X
               D='Dataset organization'
         $KWD  DUP,                                                    X
               T=GENERAL,                                              X
               LENGTH=16,                                              X
               O1=O_DUP,                                               X
               FORMAT=F,                                               X
               D='Number of updates'
         $KWD  EXCP,                                                   X
               T=GENERAL,                                              X
               LENGTH=16,                                              X
               O1=O_EXCP,                                              X
               FORMAT=F,                                               X
               D='Execute Channel Program'
         $KWD  GROUP,                                                  X
               T=GENERAL,                                              X
               LENGTH=8,                                               X
               O1=O_GROUP,                                             X
               FORMAT=C,                                               X
               D='Group identification'
         $KWD  JOBNAME,                                                X
               T=GENERAL,                                              X
               LENGTH=8,                                               X
               O1=O_JOB1,                                              X
               O2=O_JOB2,                                              X
               O3=O_JOB3,                                              X
               O4=O_JOB4,                                              X
               O5=O_JOB5,                                              X
               FORMAT=C,                                               X
               D='Job name',                                           X
               ALIAS1=JOB
         $KWD  LOGSTREAM,                                              X
               T=GENERAL,                                              X
               LENGTH=26,                                              X
               O1=O_LOGSTREAM,                                         X
               FORMAT=C,                                               X
               D='Logstream name'
         $KWD  LRECL,                                                  X
               T=GENERAL,                                              X
               LENGTH=5,                                               X
               O1=O_LRECL,                                             X
               FORMAT=F,                                               X
               D='Logical record length'
         $KWD  MAJOR,                                                  X
               T=ENQUEUE,                                              X
               LENGTH=8,                                               X
               O1=O_MAJOR,                                             X
               FORMAT=C,                                               X
               D='Major enqueue name'
         $KWD  MGMTCLAS,                                               X
               T=GENERAL,                                              X
               LENGTH=8,                                               X
               O1=O_MGMTCLAS,                                          X
               FORMAT=C,                                               X
               D='Management class name',                              X
               ALIAS1=MANAGEMENTCLASS
         $KWD  MEMBER,                                                 X
               T=DATASET,                                              X
               LENGTH=8,                                               X
               O1=O_MEMBER,                                            X
               FORMAT=C,                                               X
               D='Member name',                                        X
               ALIAS1=MEM
         $KWD  MINOR,                                                  X
               T=ENQUEUE,                                              X
               LENGTH=44,                                              X
               O1=O_MINOR,                                             X
               FORMAT=C,                                               X
               D='Minor enqueue name'
         $KWD  NUP,                                                    X
               T=GENERAL,                                              X
               LENGTH=16,                                              X
               O1=O_NUP,                                               X
               FORMAT=F,                                               X
               D='Number of updates'
         $KWD  RECFM,                                                  X
               T=GENERAL,                                              X
               LENGTH=5,                                               X
               O1=O_RECFM,                                             X
               FORMAT=C,                                               X
               D='Record format'
         $KWD  RECORD,                                                 X
               T=GENERAL,                                              X
               LENGTH=3,                                               X
               O1=O_RTY,                                               X
               FORMAT=F,                                               X
               D='SMF Record type',                                    X
               ALIAS1=REC
         $KWD  SUBTYPE,                                                X
               T=GENERAL,                                              X
               LENGTH=3,                                               X
               O1=O_STY,                                               X
               FORMAT=F,                                               X
               D='SMF Record subtype',                                 X
               ALIAS1=STY
         $KWD  STORCLAS,                                               X
               T=GENERAL,                                              X
               LENGTH=8,                                               X
               O1=O_STORCLAS,                                          X
               FORMAT=C,                                               X
               D='Storage class name',                                 X
               ALIAS1=STORAGECLASS
         $KWD  SYSTEM,                                                 X
               T=GENERAL,                                              X
               LENGTH=4,                                               X
               O1=O_SYSTEM,                                            X
               FORMAT=C,                                               X
               D='System identification',                              X
               ALIAS1=SYSID
         $KWD  TIME,                                                   X
               T=GENERAL,                                              X
               LENGTH=11,                                              X
               O1=O_TIME,                                              X
               FORMAT=C,                                               X
               D='Time - hh.mm.ss.hh'
         $KWD  USERID,                                                 X
               T=GENERAL,                                              X
               LENGTH=8,                                               X
               O1=O_USER,                                              X
               FORMAT=C,                                               X
               D='User identification',                                X
               ALIAS1=USER
         $KWD  VOLUME,                                                 X
               T=GENERAL,                                              X
               LENGTH=6,                                               X
               O1=O_VOL1,                                              X
               O2=O_VOL2,                                              X
               O3=O_VOL3,                                              X
               O4=O_VOL4,                                              X
               O5=O_VOL5,                                              X
               O6=O_VOL6,                                              X
               O7=O_VOL7,                                              X
               O8=O_VOL8,                                              X
               O9=O_VOL9,                                              X
               OA=O_VOLA,                                              X
               FORMAT=C,                                               X
               D='Volume serial',                                      X
               ALIAS1=VOL,                                             X
               ALIAS2=VOLSER
         $KWD  VVDS,                                                   X
               T=DATASET,                                              X
               LENGTH=44,                                              X
               O1=O_VVDS,                                              X
               FORMAT=C,                                               X
               D='VSAM volume dataset name'
         $KWD  WTX,                                                    X
               T=GENERAL,                                              X
               LENGTH=4,                                               X
               O1=O_WTX,                                               X
               FORMAT=C,                                               X
               D='Wait Time Max'
@_TBLKWD EQU   *-TBLKWD            Keyword table size
#_TBLKWD EQU   (*-TBLKWD)/L_TBLKWD Keyword table count
         $KWD  DSECT=YES
*
**       Major Enqueue Table
*
TBLMAJOR CSECT                     Major Enqueue Table
         TBLMAJOR                  Major Enqueue Table
*
**       Module Table
*
TBLMOD   CSECT
         $MOD                      Module table generation
         DC    12X'FF'             End of module table
*
**       Message Table
*
TBLMSG   CSECT
*                           1         2         3         4         5
*                 0123456789012345678901234567890123456789012345678901
DAF000I  DC CL100'DAF000I '
DAF500I  DC CL133' DAF500I Valid keywords are:  '
DAF501I  DC CL133' DAF501I Valid operators are:  '
DAF502I  DC CL133' DAF502I Control Statements Follow:'
DAF503I  DC CL133' DAF503I No Control Statements Specified'
DAF504I  DC CL133' DAF504I '
DAF510I  DS 0CL133
         DC CL038' DAF510I SMF Dump Header  System=SSSS '
         DC CL095'Date=YYYYDDD Time=HH.MM.SS.HH '
DAF511I  DS 0CL133
         DC CL038' DAF511I SMF Dump Trailer System=SSSS '
         DC CL095'Date=YYYYDDD Time=HH.MM.SS.HH '
DAF512I  DS 0CL133
         DC CL038' DAF512I SMF Data Lost on System=SSSS '
         DC CL025'From=YYYYDDD/HH.MM.SS.HH '
         DC CL023'To=YYYYDDD/HH.MM.SS.HH '
         DC CL047'Count= '
DAF520I  DC CL133' DAF520I Beginning Processing - __________'
DAF521I  DC CL133' DAF521I Completed Processing - __________'
DAF530I  DS 0CL133
         DC CL047' DAF530I SMF on execution system not recording '
         DC CL086'Type=__________'
DAF540I  DC CL133' DAF540I DAFPV Vol=___ RRR YYYYDDD HH.MM.SS.HH DSN='
DAF550I  DS 0CL133
         DC CL048' DAF550I STORAGE OBTAIN   RC=__ ADDRESS=________'
         DC CL085' LENGTH=________ '
DAF551I  DS 0CL133
         DC CL048' DAF551I STORAGE RELEASE  RC=__ ADDRESS=________'
         DC CL085' LENGTH=________ '
DAF552I  DC CL133' DAF552I OPEN    xxxxxxxx RC=__ '
DAF553I  DC CL133' DAF553I CLOSE   xxxxxxxx RC=__ '
DAF554I  DS 0CL133
         DC CL016' DAF554I DAFSMF '
         DC CL049'DSN=                                             '
         DC CL010'DSORG=    '
         DC CL058'         '
DAF560I  DC CL133' DAF560I Executing on SMF    System ____'
DAF561I  DC CL133' DAF561I Executing on ______ ______ 00.00.00 '
DAF600I  DS 0CL133
         DC CL025' DAF600I Entering XXXXXX '
         DC CL108'R14=RRRRRRRR R15=RRRRRRRR '
DAF601I  DS 0CL133
         DC CL025' DAF601I Exiting  XXXXXX '
         DC CL108'R14=RRRRRRRR R15=RRRRRRRR '
DAF610I  DC CL133' DAF610I Invalid RRR YYYYDDD HH.MM.SS.HH DSN='
DAF611I  DC CL133' DAF611I Invalid DSN In DAFSMF Record'
DAF620I  DC CL133' DAF620I KWD=__________ OP=_____ VAL=__________'
DAF621I  DC CL133' DAF621I Original '
DAF622I  DC CL133' DAF622I Resolved '
DAF623I  DC CL133' DAF623I CS=__ CC=__ '
DAF624I  DC CL133' DAF624I CS=__ CC=__ RT=___ DSN=______'
DAF704W  DC CL133' DAF704W No DAFSMF Records Selected'
DAF708E  DC CL133' DAF708E No DAFSMF Records Provided'
DAF712S  DC CL133' DAF712S Control Statement Problem'
DAF716T  DC CL133' DAF716T Sort Problem'
*
**       Operator Table
*
TBLOP    CSECT                     Operator table
         $OP   EQ,L=0,E=1,H=0,DES='Equal to'
L_TBLOP  EQU   *-TBLOP             Operator table entry length
         $OP   GE,L=0,E=1,H=1,DES='Greater than or equal to'
         $OP   GT,L=0,E=0,H=1,DES='Greater than'
         $OP   LE,L=1,E=1,H=0,DES='Less than or equal to'
         $OP   LT,L=1,E=0,H=0,DES='Less than'
         $OP   NE,L=1,E=0,H=1,DES='Not equal to'
@_TBLOP  EQU    *-TBLOP            Operator table size
#_TBLOP  EQU   (*-TBLOP)/L_TBLOP   Operator table count
         $OP   DSECT=YES
*
**       SMF Table
*
TBLSMF   CSECT                     SMF table
    $SMF 002,DAF002,'Dump Header'
    $SMF 003,DAF003,'Dump Trailer'
    $SMF 007,DAF007,'Data Lost'
    $SMF 014,DAF014,'INPUT or RDBACK Data Set Activity'
    $SMF 015,DAF014,'OUTPUT UPDAT INOUT or OUTIN Data Set Activity'
         AIF   ('&RT_DFSORT' EQ '000').NODFSORT5
    $SMF 016,DAF016,'DFSORT Statistics'
.NODFSORT5     ANOP
    $SMF 017,DAF017,'Scratch Data Set Status'
    $SMF 018,DAF018,'Rename Non-VSAM Data Set Status'
    $SMF 022,DAF022,'Configuration'
    $SMF 024,DAF024,'JES2 Spool Offload'
    $SMF 036,DAF036,'Integrated Catalog Facility Catalog'
         AIF   ('&RT_DFSMS' EQ '000').NODFSMS5
    $SMF 042,DAF042,'DFSMS Statistics and Configuration'
.NODFSMS5      ANOP
         AIF   ('&RT_BDT' EQ '000').NOBDT5
    $SMF 059,DAF059,'MVS/BDT File-to-File Transmission'
.NOBDT5        ANOP
    $SMF 060,DAF060,'VSAM Volume Data Set Updated'
    $SMF 061,DAF061,'Integrated Catalog Facility Define Activity'
    $SMF 062,DAF062,'VSAM Component or Cluster Opened'
    $SMF 063,DAF063,'VSAM Catalog Entry Defined'
    $SMF 064,DAF064,'VSAM Component or Cluster Status'
    $SMF 065,DAF065,'Integrated Catalog Facility Delete Activity'
    $SMF 066,DAF066,'Integrated Catalog Facility Alter Activity'
    $SMF 067,DAF067,'VSAM Catalog Entry Deleted'
    $SMF 068,DAF068,'VSAM Catalog Entry Renamed'
    $SMF 069,DAF069,'VSAM Data Space Defined, Extended or Deleted'
         AIF   ('&RT_RMF' EQ '000').NORMF5
    $SMF 073,DAF073,'RMF Channel Path Activity'
    $SMF 074,DAF074,'RMF Activity of Several Resources'
    $SMF 075,DAF075,'RMF Page Data Set Activity'
    $SMF 077,DAF077,'RMF Enqueue Activity'
    $SMF 078,DAF078,'RMF Virtual Storage and I/O Queuing Activity'
    $SMF 079,DAF079,'RMF Monitor II Activity'
.NORMF5        ANOP
         AIF   ('&RT_RACFPROC' EQ '000').NORACFPROC5
    $SMF 080,DAF080,'Security Product Processing'
.NORACFPROC5   ANOP
         AIF   ('&RT_RACFPROC' EQ '000').NORACFINIT5
    $SMF 081,DAF081,'RACF Initialization'
.NORACFINIT5   ANOP
         AIF   ('&RT_ICSF' EQ '000').NOICSF5
    $SMF 082,DAF082,'ICSF Record'
.NOICSF5       ANOP
         AIF   ('&RT_RACFAUDIT' EQ '000').NORACFAUDIT5
    $SMF 083,DAF083,'RACF Audit Record for Data Sets'
.NORACFAUDIT5   ANOP
    $SMF 088,DAF088,'System Logger Data'
    $SMF 090,DAF090,'System Status'
         AIF   ('&RT_SMARTBATCH' EQ '000').NOSMARTBATCH5
    $SMF 091,DAF091,'BatchPipes/MVS Statistics'
.NOSMARTBATCH5 ANOP
         AIF   ('&RT_USS' EQ '000').NOUSS5
    $SMF 092,DAF092,'OpenMVS File System Activity'
.NOUSS5        ANOP
         AIF   ('&RT_TCPIP' EQ '000').NOTCPIP5
    $SMF 118,DAF118,'TCP/IP Statistics'
.NOTCPIP5      ANOP
         AIF   ('&RT_TCPIPX' EQ '000').NOTCPIPX5
    $SMF 119,DAF119,'TCP/IP Statistics'
.NOTCPIPX5     ANOP
         AIF   ('&RT_RMMAUD' EQ '000').NORMMAUD5
    $SMF &RT_RMMAUD,RMMAUD,'DFSMSrmm SMF Audit Record'
.NORMMAUD5     ANOP
         AIF   ('&RT_RMMSEC' EQ '000').NORMMSEC5
    $SMF &RT_RMMSEC,RMMSEC,'DFSMSrmm SMF Security Record'
.NORMMSEC5     ANOP
         AIF   ('&RT_HSMFSR' EQ '000').NOHSMFSR5
    $SMF &RT_HSMFSR,HSMFSR,'DFSMShsm SMF FSR Record'
.NOHSMFSR5     ANOP
@_TBLSMF EQU   *-TBLSMF            SMF table size
#_TBLSMF EQU   @_TBLSMF/L_TBLSMF   SMF table count
         $SMF DSECT=YES
*
**       HSMTYPE Compare Table
*
HSMTYPE  CSECT
         $COMP TYPE=INIT
         $COMP AL1(01),'Primary_to_level_1_migration'
         $COMP AL1(02),'Level_x_to_level_x_migration'
         $COMP AL1(03),'Primary_to_level_2_migration'
         $COMP AL1(04),'Recall_from_level_1_to_primary'
         $COMP AL1(05),'Recall_from_level_2_to_primary'
         $COMP AL1(06),'Delete_a_migrated_data_set'
         $COMP AL1(07),'Daily_backup'
         $COMP AL1(08),'Spill_backup'
         $COMP AL1(09),'Recovery'
         $COMP AL1(10),'Recycle_backup_volume'
         $COMP AL1(11),'Data_set_deletion_by_age'
         $COMP AL1(12),'Recycle_migration_volume'
         $COMP AL1(13),'Full_volume_dump'
         $COMP AL1(14),'Volume_or_data_set_restore'
         $COMP AL1(15),'ABACKUP_function'
         $COMP AL1(16),'ARECOVER_function'
         $COMP AL1(17),'Expire_primary_or_migrated_data_sets'
         $COMP AL1(18),'Partrel_function'
         $COMP AL1(19),'Expire_or_roll_off_incremental_backup_version'
         $COMP AL1(20),'(H)BDELETE_an_incremental_backup_version'
         $COMP AL1(21),'Fast_replication_backup_function'
         $COMP AL1(22),'Fast_replication_recover_function'
         $COMP AL1(23),'Fast_replication_delete_function'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=Function
*
**       SMFADACT Compare Table
*
RMMAUDAT CSECT
         $COMP TYPE=INIT
         $COMP CL001'C','Record_Changed'
         $COMP CL001'D','Record_Deleted'
         $COMP CL001'A','Record_Added'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=AUDAT
*
**       SMFSAACT Compare Table
*
RMMSECAT CSECT
         $COMP TYPE=INIT
         $COMP CL001'C','Dataset_Create'
         $COMP CL001'E','Dataset_Extend'
         $COMP CL001'U','Dataset_Update'
         $COMP CL001'R','Dataset_Read_Access'
         $COMP CL001'D','Dataset_Delete'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=SECAT
*
**       DSORG Compare Table
*
T14DSO   CSECT
         $COMP TYPE=INIT
         $COMP X'0008','VS'
         $COMP X'0009','VSU'
         $COMP X'0200','PO'
         $COMP X'0300','POU'
         $COMP X'2000','DA'
         $COMP X'2100','DAU'
         $COMP X'4000','PS'
         $COMP X'4100','PSU'
         $COMP X'8000','IS'
         $COMP X'8100','ISU'
         $COMP X'0000','Reserved'
         $COMP TYPE=BUILD,LENGTH=2,LABEL=DSORG
*
**       DISP Compare Table
*
T14DSP   CSECT
         $COMP TYPE=INIT
         $COMP X'08','Shr'
         $COMP X'40','Old'
         $COMP X'48','Shr'
         $COMP X'80','Mod'
         $COMP X'88','Shr'
         $COMP X'C0','New'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=DISP
*
**       Label Type Compare Table
*
T14LTP   CSECT
         $COMP TYPE=INIT
         $COMP X'01','NL'
         $COMP X'02','SL'
         $COMP X'04','NSL'
         $COMP X'0A','SUL'
         $COMP X'10','BLP'
         $COMP X'20','LTM'
         $COMP X'40','AL'
         $COMP X'48','AUL'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=LTYP
*
**       CTRI Compare Table
*
T14SPC   CSECT
         $COMP TYPE=INIT
         $COMP X'C0','CYL'
         $COMP X'80','TRK'
         $COMP X'40','BLK'
         $COMP X'00','ABSTR'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=CTRI
*
**       ICExxAMB TM Table (Access Method Flags)
*
T16AMB   CSECT
         DC    C'AMB='             Label
         $TM   CL032'EXCP'
         $TM   CL032'VSAM'
         $TM   CL032'BSAM'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       ICECSFLG TM Table (Control Statement Flags)
*
T16CSF   CSECT
         DC    C'CSF='             Label
         $TM   CL032'Altseq'
         $TM   CL032'Inrec'
         $TM   CL032'Include'
         $TM   CL032'Omit'
         $TM   CL032'Outrec'
         $TM   CL032'Sum'
         $TM   CL032'Outfil'
         $TM   CL032'Reserved'
*
**       ICExxFL1 TM Table (Flag Byte 1)
*
T16FL1   CSECT
         DC    C'FL1='             Label
         $TM   CL032'Batchpipes'
         $TM   CL032'Striped'
         $TM   CL032'Compressed'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       ICEFLBY2 TM Table (Type of Operation)
*
T16TOO   CSECT
         DC    C'TYPE='            Label
         $TM   CL032'Sort'
         $TM   CL032'Merge'
         $TM   CL032'Copy'
         $TM   CL032'Icetool'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF22FNC Compare Table
*
T22FNC   CSECT
         $COMP TYPE=INIT
         $COMP X'01','Activate'
         $COMP X'02','Recover'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=FNC
*
**       SMF24BCF TM Table
*
T24BCF   CSECT
         DC    C'BCF='             Label
         $TM   CL032'First'
         $TM   CL032'Continuation'
         $TM   CL032'Last'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF24EOJ TM Table
*
T24EOJ   CSECT
         DC    C'EOJ='             Label
         $TM   CL032'Completed_job'
         $TM   CL032'Completed_with_skipped'
         $TM   CL032'Uncompleted_job'
         $TM   CL032'Cancelled'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF24SUB Compare Table
*
T24SUB   CSECT
         $COMP TYPE=INIT
         $COMP X'0001','Job_transmitter'
         $COMP X'0002','Job_receiver'
         $COMP X'0003','SYSOUT_transmitter'
         $COMP X'0004','SYSOUT_receiver'
         $COMP TYPE=BUILD,LENGTH=2,LABEL=SUB
*
**       SMF36EIN Compare Table
*
T36EIN   CSECT
         $COMP TYPE=INIT
         $COMP C'AE','Aliases_were_exported'
         $COMP C'NE','No_aliases_exported'
         $COMP TYPE=BUILD,LENGTH=2,LABEL=EIN
*
**       S42FLAGS TM Table
*
T42FLAGS CSECT
         DC    C'ABEND='           Label
         $TM   CL032'B37'
         $TM   CL032'D37'
         $TM   CL032'E37'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF6xFNC Compare Table
*
T6XFNC   CSECT
         $COMP TYPE=INIT
         $COMP C'R','Rename'
         $COMP C'S','Scratch'
         $COMP C'U','Uncatalog'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=FNC
*
**       SMF6xIOD TM Table
*
T6XIOD   CSECT
         DC    C'IOD='             Label
         $TM   CL032'VSAM_cluster'
         $TM   CL032'VSAM_data'
         $TM   CL032'VSAM_index'
         $TM   CL032'VSAM_CATALOGg'
         $TM   CL032'NonVSAM'
         $TM   CL032'GDG'
         $TM   CL032'Alias'
         $TM   CL032'Reserved'
*
**       SMF6xSUB Compare Table
*
T6XSUB   CSECT
         $COMP TYPE=INIT
         $COMP C'DE','Delete'
         $COMP C'IN','Insert'
         $COMP C'UP','Update'
         $COMP TYPE=BUILD,LENGTH=2,LABEL=SUB
*
**       SMF6xTYP Compare Table
*
T6XTYP   CSECT
         $COMP TYPE=INIT
         $COMP C'A','NonVSAM_Dataset'
         $COMP C'B','GDG_Base'
         $COMP C'C','Cluster'
         $COMP C'D','Data'
         $COMP C'E','VSAM_Extension'
         $COMP C'F','Free_Space'
         $COMP C'G','Alternate_Index'
         $COMP C'H','Active_GDS'
         $COMP C'I','Index'
         $COMP C'J','GDG_Extension'
         $COMP C'K','VVR'
         $COMP C'L','Tape_Library'
         $COMP C'M','Mastercat'
         $COMP C'N','NonVSAM_Header'
         $COMP C'O','OAM'
         $COMP C'P','Page'
         $COMP C'Q','VVR_Header_Secondary'
         $COMP C'R','Path'
         $COMP C'T','True'
         $COMP C'U','Usercat'
         $COMP C'V','Volume'
         $COMP C'W','Tape_Volume'
         $COMP C'X','Alias'
         $COMP C'Y','Upgrade'
         $COMP C'Z','VVR_Header_Primary'
         $COMP X'00','NonVSAM'
         $COMP X'01','JES3'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=TYP
*
**       SMF62IND TM Table
*
T62IND   CSECT
         DC    C'IND='             Label
         $TM   CL032'Successfully_opened'
         $TM   CL032'Incorrect_password'
         $TM   CL032'Catalog_or_CRA'
         $TM   CL032'VVDS_or_ICF_CATALOGg'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       Record creator TM table
*
T63FDT   CSECT
         DC    C'FDT='             Label
         $TM   CL032'New_definition'
         $TM   CL032'Altered_definition'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Path_define/alter'
         $TM   CL032'AIX_define/alter'
*
**       SMF64DTY TM Table
*
T64DTY   CSECT
         DC    C'DTY='             Label
         $TM   CL032'Data'
         $TM   CL032'Index'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF64MC1 TM Table
*
T64MC1   CSECT
         DC    C'MC1='             Label
         $TM   CL032'Key_access'
         $TM   CL032'RBA_access'
         $TM   CL032'CI'
         $TM   CL032'Sequential'
         $TM   CL032'Direct'
         $TM   CL032'Input'
         $TM   CL032'Output'
         $TM   CL032'User_buffers'
*
**       SMF64MC2 TM Table
*
T64MC2   CSECT
         DC    C'MC2='             Label
         $TM   CL032'JES_output'
         $TM   CL032'Control_characters'
         $TM   CL032'Reserved'
         $TM   CL032'Skip_sequential'
         $TM   CL032'VTAM_LOGON'
         $TM   CL032'Set_to_empty'
         $TM   CL032'Shared_control_blocks'
         $TM   CL032'Path_AIX'
*
**       SMF64MC3 TM Table
*
T64MC3   CSECT
         DC    C'MC3='             Label
         $TM   CL032'Reserved'
         $TM   CL032'LSR'
         $TM   CL032'GSR'
         $TM   CL032'ICIP'
         $TM   CL032'Deferred_write'
         $TM   CL032'Sequential_insert'
         $TM   CL032'Fixed_control_blocks'
         $TM   CL032'31_bit_buffers'
*
**       SMF64RIN TM Table
*
T64RIN   CSECT
         DC    C'RIN='             Label
         $TM   CL032'Close'
         $TM   CL032'EOV'
         $TM   CL032'No_space'
         $TM   CL032'Catalog/CRA'
         $TM   CL032'Close/TYPE=T'
         $TM   CL032'Abend'
         $TM   CL032'CAT/VVDS'
         $TM   CL032'Reserved'
*
**       SMF67FDT TM Table
*
T67FDT   CSECT
         DC    C'FDT='             Label
         $TM   CL032'Uncataloged'
         $TM   CL032'Scratched'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Path_deleted'
         $TM   CL032'AIX_created'
*
**       SMF75FL2 TM Table
*
T75FL2   CSECT
         DC    C'FL2='             Label
         $TM   CL032'VIO'
         $TM   CL032'Multiple_exposure_device'
         $TM   CL032'Alternate_control_unit'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF75PST TM Table
*
T75PST   CSECT
         DC    C'PST='             Label
         $TM   CL032'PLPA'
         $TM   CL032'COMMON'
         $TM   CL032'DUPLEX'
         $TM   CL032'LOCAL'
         $TM   CL032'SWAP'
         $TM   CL032'Unusable'
         $TM   CL032'Brought_online'
         $TM   CL032'Brought_offline'
*
**       SMFFTPDT Compare Table
*
TFTPDT   CSECT
         $COMP TYPE=INIT
         $COMP CL001' ','Sequential'
         $COMP CL001'S','Sequential'
         $COMP CL001'P','PDS'
         $COMP CL001'H','HFS'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=PDT
*
**       SMFFTPFM Compare Table
*
TFTPFM   CSECT
         $COMP TYPE=INIT
         $COMP CL001'A','ASCII'
         $COMP CL001'E','EBCDIC'
         $COMP CL001'I','Image'
         $COMP CL001'B','DBCS'
         $COMP CL001'U','UCS-2'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=PFM
*
**       SMFFTPMO Compare Table          ????
*
T77XXX   CSECT
         $COMP TYPE=INIT
         $COMP XL1'01','APPEND'
         $COMP XL1'02','DELETE'
         $COMP XL1'03','RENAME'
         $COMP XL1'04','RETRIEVE'
         $COMP XL1'05','STORE'
         $COMP XL1'06','STORE_UNIQUE'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=PMX
*
**       SMFFTPMO Compare Table
*
TFTPMO   CSECT
         $COMP TYPE=INIT
         $COMP CL001'B','Block'
         $COMP CL001'C','Compressed'
         $COMP CL001'S','Stream'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=PMO
*
**       SMFFTPST Compare Table
*
TFTPST   CSECT
         $COMP TYPE=INIT
         $COMP CL001'F','File'
         $COMP CL001'R','Record'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=PST
*
**       SMFFTPXD Compare Table
*
TFTPXD   CSECT
         $COMP TYPE=INIT
         $COMP CL001'C','Client'
         $COMP CL001'S','Server'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=PXD
*
**       SMF77DFG TM Table
*
T77DFG   CSECT
         DC    C'DFG='             Label
         $TM   CL032'Resource_in_contention'
         $TM   CL032'Scope_of_system'
         $TM   CL032'Exclusive_owner'
         $TM   CL032'Waiting_job_1_exclusive_usage'
         $TM   CL032'Waiting_job_2_exclusive_usage'
         $TM   CL032'Global'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF80AAA TM Table
*
T80AAA   CSECT
         DC    C'ALLOWED='         Label
         $TM   CL032'ALTER'
         $TM   CL032'CONTROL'
         $TM   CL032'UPDATE'
         $TM   CL032'READ'
         $TM   CL032'EXECUTE'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'NONE'
*
**       SMF80AAR TM Table
*
T80AAR   CSECT
         DC    C'INTENT='          Label
         $TM   CL032'ALTER'
         $TM   CL032'CONTROL'
         $TM   CL032'UPDATE'
         $TM   CL032'READ'
         $TM   CL032'EXECUTE'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'NONE'
*
**       SMF80ATH TM Table
*
T80AUTH  CSECT
         DC    C'AUTHORITY='       Label
         $TM   CL032'NORMAL'
         $TM   CL032'SPECIAL'
         $TM   CL032'OPERATIONS'
         $TM   CL032'AUDITOR'
         $TM   CL032'EXIT'
         $TM   CL032'FAILSOFT'
         $TM   CL032'BYPASSED'
         $TM   CL032'TRUSTED'
*
**       SMF80DES TM Table
*
T80DES   CSECT
         DC    C'DESCRIPTOR='      Label
         $TM   CL032'VIOLATION'
         $TM   CL032'UNDEFINED'
         $TM   CL032'Reserved'
         $TM   CL032'WARNING'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF80EVT Compare Table
*
T80EVENT CSECT
         $COMP TYPE=INIT
         $COMP X'01','INITIATION'
         $COMP X'02','RESOURCE_ACCESS'
         $COMP X'03','ADDVOL/CHGVOL'
         $COMP X'04','RENAME_DATASET'
         $COMP X'05','DELETE_RESOURCE'
         $COMP X'06','DELVOL'
         $COMP X'07','DEFINE_RESOURCE'
         $COMP X'08','ADDSD_COMMAND'
         $COMP X'09','ADDGROUP_COMMAND'
         $COMP X'0A','ADDUSER_COMMAND'
         $COMP X'0B','ALTDSD_COMMAND'
         $COMP X'0C','ALTGROUP_COMMAND'
         $COMP X'0D','ALTUSER_COMMAND'
         $COMP X'0E','CONNECT_COMMAND'
         $COMP X'0F','DELDSD_COMMAND'
         $COMP X'10','DELGROUP_COMMAND'
         $COMP X'11','DELUSER_COMMAND'
         $COMP X'12','PASSWORD_COMMAND'
         $COMP X'13','PERMIT_COMMAND'
         $COMP X'14','RALTER_COMMAND'
         $COMP X'15','RDEFINE_COMMAND'
         $COMP X'16','RDELETE_COMMAND'
         $COMP X'17','REMOVE_COMMAND'
         $COMP X'18','SETROPTS_COMMAND'
         $COMP X'19','RVARY_COMMAND'
         $COMP X'1A','APPC_SESSION_ESTABLISHMENT'
         $COMP X'1B','GENERAL'
         $COMP X'1C','DIRECTORY_SEARCH'
         $COMP X'1D','CHECK_ACCESS_TO_DIRECTORY'
         $COMP X'1E','CHECK_ACCESS_TO_FILE'
         $COMP X'1F','CHAUDIT'
         $COMP X'20','CHDIR'
         $COMP X'21','CHMOD'
         $COMP X'22','CHOWN'
         $COMP X'23','CLEAR_SETID_BITS_FOR_FILE'
         $COMP X'24','EXEC_WITH_SETUID/SETGID'
         $COMP X'25','GETPSENT'
         $COMP X'26','INITIALIZE_OPENEDITION_PROCESS'
         $COMP X'27','OPENEDITION_PROCESS_COMPLETION'
         $COMP X'28','KILL'
         $COMP X'29','LINK'
         $COMP X'2A','MKDIR'
         $COMP X'2B','MKNOD'
         $COMP X'2C','MOUNT_FILE_SYSTEM'
         $COMP X'2D','OPEN_NEW_FILE'
         $COMP X'2E','PTRACE'
         $COMP X'2F','RENAME'
         $COMP X'30','RMDIR'
         $COMP X'31','SETEGID'
         $COMP X'32','SETEUID'
         $COMP X'33','SETGID'
         $COMP X'34','SETUID'
         $COMP X'35','SYMLINK'
         $COMP X'36','UNLINK'
         $COMP X'37','UNMOUNT_FILE_SYSTEM'
         $COMP X'38','CHECK_FILE_OWNER'
         $COMP X'39','CK_PRIV'
         $COMP X'3A','OPEN_SLAVE_TTY'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=EVENT
*
**       SMF80EVQ Compare Table
**       (Descriptions do not contain:  HAS/HAS BEEN/IS
*
T80QUAL  CSECT
         $COMP TYPE=INIT
         $COMP X'0100','SUCCESSFUL'
         $COMP X'0101','INVALID_PASSWORD'
         $COMP X'0102','INVALID_GROUP'
         $COMP X'0103','INVALID_OIDCARD'
         $COMP X'0104','INVALID_TERMINAL/CONSOLE'
         $COMP X'0105','INVALID_APPLICATION'
         $COMP X'0106','REVOKED_USER_ATTEMPTING_ACCESS'
         $COMP X'0107','USERID_AUTOMATICALLY_REVOKED'
         $COMP X'0108','SUCCESSFUL_TERMINATION'
         $COMP X'0109','UNDEFINED_USERID'
         $COMP X'010A','INSUFFICIENT_SECLABEL_AUTHORITY'
         $COMP X'010B','NOT_AUTHORIZED_TO_SECLABEL'
         $COMP X'010C','SUCCESSFUL_RACINIT_INITIATION'
         $COMP X'010D','SUCCESSFUL_RACINIT_DELETE'
         $COMP X'010E','SYSTEM_NOW_REQUIRES_MORE_AUTHORITY'
         $COMP X'010F','RJE_JOB_NOT_AUTHORIZED'
         $COMP X'0110','SURROGAT_CLASS_INACTIVE'
         $COMP X'0111','SUBMITTER_NOT_AUTHORIZED_BY_USER'
         $COMP X'0112','SUBMITTER_NOT_AUTHORIZED_TO_SECLABEL'
         $COMP X'0113','USER_NOT_AUTHORIZED_TO_JOB'
         $COMP X'0114','WARNING_INSUFFICIENT_SECLABEL_AUTHORITY'
         $COMP X'0115','WARNING_SECLABEL_MISSING_FROM_USER/JOB/PROFILE'
         $COMP X'0116','WARNING_NOT_AUTHORIZED_TO_SECLABEL'
         $COMP X'0117','SECLABELS_NOT_COMPATIBLE'
         $COMP X'0118','WARNING_SECLABELS_NOT_COMPATIBLE'
         $COMP X'0119','CURRENT_PASSWORD_EXPIRED'
         $COMP X'011A','INVALID_NEW_PASSWORD'
         $COMP X'011B','VERIFICATION_FAILED_BY_INSTALLATION'
         $COMP X'011C','GROUP_ACCESS_REVOKED'
         $COMP X'011D','OIDCARD_REQUIRED'
         $COMP X'011E','NJE_JOB_NOT_AUTHORIZED'
         $COMP X'011F','WARNING_UNKNOWN_USER_FROM_TRUSTED_NODE_PROPGTD'
         $COMP X'0120','SUCCESSFULL_INITIATION_USING_PASSTICKET'
         $COMP X'0121','ATTEMPTED_REPLAY_OF_PASSTICKET'
         $COMP X'0200','SUCCESSFUL'
         $COMP X'0201','INSUFFICIENT_AUTHORITY'
         $COMP X'0202','PROFILE_NOT_FOUND_RACFIND_SPECIFIED_ON_MACRO'
         $COMP X'0203','ACCESS_PERMITTED_DUE_TO_WARNING'
         $COMP X'0204','FAILED_DUE_TO_PROTECTALL'
         $COMP X'0205','WARNING_ISSUED_DUE_TO_PROTECTALL'
         $COMP X'0206','INSUFFICIENT_CATEGORY/SECLEVEL'
         $COMP X'0207','INSUFFICIENT_SECLABEL_AUTHORITY'
         $COMP X'0208','WARNING_SECLABEL_MISSING_FROM_JOB/USER/PROFILE'
         $COMP X'0209','WARNING_INSUFFICIENT_SECLABEL_AUTHORITY'
         $COMP X'020A','WARNING_DATASET_NOT_CATALOGGED'
         $COMP X'020B','DATASET_NOT_CATALOGGED'
         $COMP X'020C','PROFILE_NOT_FOUND_REQUIRED_FOR_AUTH_CHECKING'
         $COMP X'020D','WARNING_INSUFFICIENT_CATEGORY/SECLEVEL'
         $COMP X'0300','SUCCESSFUL'
         $COMP X'0301','INSUFFICIENT_AUTHORITY'
         $COMP X'0302','INSUFFICIENT_SECLABEL'
         $COMP X'0303','LESS_SPECIFIC_PROFILE_WITH_DIFFERENT_SECLABEL'
         $COMP X'0400','SUCCESSFUL'
         $COMP X'0401','INVALID_GROUP'
         $COMP X'0402','USER_NOT_IN_GROUP'
         $COMP X'0403','INSUFFICIENT_AUTHORITY'
         $COMP X'0404','RESOURCE_NAME_ALREADY_DEFINED'
         $COMP X'0405','USER_NOT_DEFINED_TO_RACF'
         $COMP X'0406','RESOURCE_NOT_PROTECTED'
         $COMP X'0407','WARNING_RESOURCE_NOT_PROTECTED'
         $COMP X'0408','USER_IN_SECOND_QUALIFIER_NOT_RACF_DEFINED'
         $COMP X'0409','LESS_SPECIFIC_PROFILE_WITH_DIFFERENT_SECLABEL'
         $COMP X'040A','INSUFFICIENT_SECLABEL_AUTHORITY'
         $COMP X'040B','RESOURCE_NOT_PROTECTED_BY_SECLABEL'
         $COMP X'040C','NEW_NAME_NOT_PROTECTED_BY_SECLABEL'
         $COMP X'040D','NEW_SECLABEL_MUST_DOMINATE_OLD_SECLABEL'
         $COMP X'040E','INSUFFICIENT_SECLABEL_AUTHORITY'
         $COMP X'040F','WARNING_RESOURCE_NOT_PROTECTED_BY_SECLABEL'
         $COMP X'0410','WARNING_NEW_NAME_NOT_PROTECTED_BY_SECLABEL'
         $COMP X'0411','WARNING_NEW_SECLABEL_MUST_DOMINATE_OLD_SECLABL'
         $COMP X'0500','SUCCESSFUL'
         $COMP X'0501','RESOURCE_NOT_FOUND'
         $COMP X'0502','INVALID_VOLUME_IDENTIFICATION'
         $COMP X'0600','SUCCESSFUL'
         $COMP X'0700','SUCCESSFUL'
         $COMP X'0701','GROUP_UNDEFINED'
         $COMP X'0702','USER_NOT_IN_GROUP'
         $COMP X'0703','INSUFFICIENT_AUTHORITY'
         $COMP X'0704','RESOURCE_NAME_ALREADY_DEFINED'
         $COMP X'0705','USER_NOT_DEFINED_TO_RACF'
         $COMP X'0706','RESOURCE_NOT_PROTECTED'
         $COMP X'0707','WARNING_RESOURCE_NOT_PROTECTED'
         $COMP X'0708','WARNING_SECLABEL_MISSING_FROM_JOB/USER/PROFILE'
         $COMP X'0709','WARNING_INSUFFICIENT_SECLABEL_AUTHORITY'
         $COMP X'070A','USER_IN_SECOND_QUALIFIER_NOT_RACF_DEFINED'
         $COMP X'070B','INSUFFICIENT_SECLABEL_AUTHORITY'
         $COMP X'070C','LESS_SPECIFIC_PROFILE_WITH_DIFFERENT_SECLABEL'
         $COMP X'0800','SUCCESSFUL'
         $COMP X'0801','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'0802','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'0803','SUCCESSFUL_RETRIEVAL_OF_DSNS_FOR_SECLABEL'
         $COMP X'0804','ERROR_DURING_RETRIEVAL_OF_DSNS_FOR_SECLABEL'
         $COMP X'0900','SUCCESSFUL'
         $COMP X'0901','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'0902','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'0A00','SUCCESSFUL'
         $COMP X'0A01','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'0A02','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'0B00','SUCCESSFUL'
         $COMP X'0B01','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'0B02','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'0B03','SUCCESSFUL_RETRIEVAL_OF_DSNS_FOR_SECLABEL'
         $COMP X'0B04','ERROR_DURING_RETRIEVAL_OF_DSNS_FOR_SECLABEL'
         $COMP X'0C00','SUCCESSFUL'
         $COMP X'0C01','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'0C02','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'0D00','SUCCESSFUL'
         $COMP X'0D01','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'0D02','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'0E00','SUCCESSFUL'
         $COMP X'0E01','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'0E02','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'0F00','SUCCESSFUL'
         $COMP X'0F01','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'0F02','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'0F03','SUCCESSFUL_RETRIEVAL_OF_DSNS_FOR_SECLABEL'
         $COMP X'0F04','ERROR_DURING_RETRIEVAL_OF_DSNS_FOR_SECLABEL'
         $COMP X'1000','SUCCESSFUL'
         $COMP X'1001','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1002','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1100','SUCCESSFUL'
         $COMP X'1101','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1102','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1200','SUCCESSFUL'
         $COMP X'1201','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1202','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1300','SUCCESSFUL'
         $COMP X'1301','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1302','INSUFFICIENT_AUTHORITY(PARTIAL_UPDATES)'
         $COMP X'1400','SUCCESSFUL'
         $COMP X'1401','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1402','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1500','SUCCESSFUL'
         $COMP X'1501','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1502','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1600','SUCCESSFUL'
         $COMP X'1601','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1602','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1700','SUCCESSFUL'
         $COMP X'1701','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1702','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1800','SUCCESSFUL'
         $COMP X'1801','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1802','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1900','SUCCESSFUL'
         $COMP X'1901','INSUFFICIENT_AUTHORITY(NO_UPDATES)'
         $COMP X'1902','KEYWORD_VIOLATIONS_DETECTED(PARTIAL_UPDATES)'
         $COMP X'1A00','APPCLU'
         $COMP X'1B00','GENERAL'
         $COMP TYPE=BUILD,LENGTH=2,LABEL=QUALIFIER
*
**       SMF80REA TM Table
*
T80REA   CSECT
         DC    C'REASON='          Label
         $TM   CL032'CLASS'
         $TM   CL032'USER'
         $TM   CL032'SPECIAL'
         $TM   CL032'RESOURCE'
         $TM   CL032'RACINIT'
         $TM   CL032'COMMAND'
         $TM   CL032'CMDVIOL'
         $TM   CL032'AUDITOR'
*
**       SMF80RE2 TM Table
*
T80RE2   CSECT
         DC    C'REASON='          Label
         $TM   CL032'SECAUDIT'
         $TM   CL032'VMAUDIT'
         $TM   CL032'LOGOPTIONS'
         $TM   CL032'SECLABELAUDIT'
         $TM   CL032'COMPATMODE'
         $TM   CL032'APPLAUDIT'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
*
**       SMF81D30 Compare Table
*
T81D30   CSECT
         $COMP TYPE=INIT
         $COMP X'80','Active_RACF_Dataset'
         $COMP X'C0','Backup_RACF_Dataset'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=NONE
*
**       SMF82VES TM Table
*
T82VES   CSECT
         DC    C'VES='             Label
         $TM   CL032'Special_security_mode_allowed'
         $TM   CL032'Special_security_mode_enabled'
         $TM   CL032'Reserved'
         $TM   CL032'Key_authentication'
         $TM   CL032'Reserved'
         $TM   CL032'Reserved'
         $TM   CL032'RACF_checking_supervisor_state'
         $TM   CL032'Reserved'
*
**       SMF90TID Compare Table
*
T90TID   CSECT
         $COMP TYPE=INIT
         $COMP H'5','SET_SMF'
         $COMP H'6','Switch_SMF'
         $COMP H'7','HALT_EOD'
         $COMP H'9','IPL_SMF'
         $COMP H'13','SETSMF'
         $COMP H'15','SET_SMF_(Restart_SMF)'
         $COMP H'26','IPL_LOGREC'
         $COMP TYPE=BUILD,LENGTH=2,LABEL=TID
*
**       SMF92MFT Compare Table
*
T92MFT   CSECT
         $COMP TYPE=INIT
         $COMP AL4(1),'MVS_Local_File_System'
         $COMP AL4(2),'Remote_File_System'
         $COMP AL4(3),'Pipe_File_System'
         $COMP AL4(4),'Socket_File_System'
         $COMP AL4(5),'Cross_System_PFS_(XPFS)'
         $COMP TYPE=BUILD,LENGTH=4,LABEL=MFT
*
**       SMF92STP Compare Table
*
T92STP   CSECT
         $COMP TYPE=INIT
         $COMP AL2(01),'File_system_mount'
         $COMP AL2(02),'File_system_quiesce'
         $COMP AL2(04),'File_system_unquiesce'
         $COMP AL2(05),'File_system_unmount'
         $COMP AL2(06),'File_system_remount'
         $COMP AL2(07),'File_system_move'
         $COMP AL2(10),'File_open'
         $COMP AL2(11),'File_close'
         $COMP TYPE=BUILD,LENGTH=2,LABEL=STP
*
**       FTP Server Reply Code Compare Table
*
CTFTPSRC CSECT
         $COMP TYPE=INIT
 $COMP C'110','Restart_marker_reply'
 $COMP C'120','Service_ready_in_nnn_minutes'
 $COMP C'125','Data_connection_already_open;_transfer_starting'
 $COMP C'150','File_status_okay;_about_to_open_data_connection'
 $COMP C'200','Command_okay'
 $COMP C'202','Command_not_implemented,_superfluous_at_this_site'
 $COMP C'211','System_status,_or_system_help_reply'
 $COMP C'212','Directory_status'
 $COMP C'213','File_status'
 $COMP C'214','Help_message'
 $COMP C'215','NAME_system_type'
 $COMP C'220','Service_ready_for_new_user'
 $COMP C'221','Service_closing_control_connection'
 $COMP C'225','Data_connection_open;_no_transfer_in_progress'
 $COMP C'226','Closing_data_connection;_requested_action_successful'
 $COMP C'227','Entering_Passive_Mode_(h1,h2,h3,h4,p1,p2)'
 $COMP C'230','User_logged_in,_proceed'
 $COMP C'250','Requested_file_action_okay,_completed'
 $COMP C'257','PATHNAME_created'
 $COMP C'331','User_name_okay,_need_password'
 $COMP C'332','Need_account_for_login'
 $COMP C'350','Requested_file_action_pending_further_information'
 $COMP C'421','Service_not_available,_closing_control_connection'
 $COMP C'425','Cannot_open_data_connection'
 $COMP C'426','Connection_closed;_transfer_aborted'
 $COMP C'450','Requested_file_action_not_taken;_file_busy'
 $COMP C'451','Requested_action_aborted:_local_error_in_processing'
 $COMP C'452','Requested_action_not_taken;_no_system_space'
 $COMP C'500','Syntax_error,_command_unrecognized'
 $COMP C'501','Syntax_error_in_parameters_or_arguments'
 $COMP C'502','Command_not_implemented'
 $COMP C'503','Bad_sequence_of_commands'
 $COMP C'504','Command_not_implemented_for_that_parameter'
 $COMP C'530','Not_logged_in'
 $COMP C'532','Need_account_for_storing_files'
 $COMP C'550','Requested_action_not_taken;_file_not_found/no_access'
 $COMP C'551','Requested_action_aborted:_page_type_unknown'
 $COMP C'552','Requested_file_action_aborted;_no_dir/file_space'
 $COMP C'553','Requested_action_not_taken;_file_name_not_allowed'
         $COMP TYPE=BUILD,LENGTH=3,LABEL=SRC
*
**       SMF119FT_FFReason Compare Table
*
T119LFR  CSECT
         $COMP TYPE=INIT
         $COMP AL1(01),'Password_is_not_valid'
         $COMP AL1(02),'Password_has_expired'
         $COMP AL1(03),'User_ID_has_been_revoked'
         $COMP AL1(04),'User_does_not_have_server_access'
         $COMP AL1(05),'FTCHKPWD_User_exit_reject_login'
         $COMP AL1(06),'Excessive_bad_passwords'
         $COMP AL1(07),'Group_ID_process_failed'
         $COMP AL1(08),'User_ID_is_unknown'
         $COMP TYPE=BUILD,LENGTH=1,LABEL=LFR
         TITLE 'Table Mapping'
*
**       Printer Control Table
*
D_PRTCTL DSECT                     Printer Control Table
D_PRTHDR DS    F                   Print header address
D_PRTPGE DS    PL003               Current page number
D_PRTLNE DS    PL002               Current line number
*        ABEND X'BAD',DUMP,,SYSTEM
         END
//LINK    EXEC PGM=HEWL,PARM='MAP,LET,LIST,EP=DAF'
//SYSLIN    DD DISP=(OLD,DELETE),DSN=&&OBJECT,
//             DCB=BUFNO=25
//SYSLMOD   DD DISP=SHR,DSN=ZTGP01.MJCUTIL.LINKLIB(DAFN) <=== Dest
//SYSUT1    DD UNIT=SYSDA,SPACE=(CYL,(5,5))
//SYSPRINT  DD SYSOUT=*,OUTPUT=*.JESDS
